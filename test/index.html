<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
<title>It's Rainbow in JavaScript!</title>
<!-- http://rocketnia.github.com/rainbow-js/test/index.html -->
<!--

Copyright (c) 2011 Ross Angle

This software is derived from Rainbow, software which is
copyright (c) 2011 Conan Dalton, distributed under the
Perl Foundation's Artistic License 2.0. In the sense described in
section (4)(c)(i) of that document, using its own terminology,
permission to use this "Modified Version" is granted under the
"Original License."

This software may also be derived from Arc, software which is
copyright (c) Paul Graham and Robert Morris, distributed under the
Perl Foundation's Artistic License 2.0. In the sense described in
section (4)(b) of that document, using its own terminology, this
"Modified Version" bears a name that is different from any name used
for Arc.

-->
<meta name="viewport" content=
   "initial-scale = 1.0, maximum-scale = 1.0, width = device-width" />
<style type="text/css">
html { font-family: sans-serif; }

body > pre { margin-left: 2em; }

#repl .scrollback {
    display: block;
    width: 95%;
    height: 200px;
    overflow: auto;
    resize: vertical;
    border: 2px solid black;
}
#repl .prompt { display: block; width: 95%; }
#repl .eval {}
</style>
<!--
<script type="text/javascript" src="index-first.js"></script>
<script type="text/javascript" src="../rainbow.js"></script>
<script type="text/javascript" src="index-last.js"></script>
-->
<script type="text/javascript" src="index-min.js"></script>
</head>
<body>
<p>This page loads Rainbow.js in as much of a minified form as I can
  bother to get now, which still comes to about 260 KB. It's the
  result of running the Closure Compiler using a command like
  this:</p>
<pre>
java -jar compiler.jar \
  --js index-first.js --js rainbow.js --js index-last.js \
  --js_output_file index.min.js
</pre>
<p>What I'd really like is to use this...</p>
<pre>
java -jar compiler.jar --compilation_level ADVANCED_OPTIMIZATIONS \
  --js index-first.js --js rainbow.js --js index-last.js \
  --js_output_file index.min.js
</pre>
<p>...but apparently it causes an internal compiler error. The Dean
Edwards packer at full power breaks too, simply because there's so
much code.</p>
<p>We don't load arc.arc or friends automatically yet, but you can
  load it yourself by just copying <a href=
  "https://github.com/conanite/rainbow/blob/92e07a98fd86f8e1985b32a7d2c265810eb76809/src/arc/arc.arc"
  >Java Rainbow's arc.arc source</a> (and any other files you want to
  load) and pasting the code into the REPL. Although I've successfully
  loaded all of Java Rainbow's automatically loaded files this
  way,<sup>*</sup> the utilities may not actually work when they're
  called. For instance, Rainbow.js doesn't implement file operations
  at all, so even though arc.arc defines <code>load</code>, it won't
  do us much good!</p>
<p><sup>*</sup> Namely, I've successfully loaded arc.arc, strings.arc,
  lib/bag-of-tricks.arc, rainbow.arc, pprint.arc, code.arc, html.arc,
  srv.arc, app.arc, prompt.arc, profile.arc, unit-test.arc, and
  parser.arc. Rainbow also automatically loads
  rainbow/rainbow-libs.arc in order to load some of these, but that
  file relies on <code>load</code>, so it won't work.</p>
<p>I've tested this page in Chrome, Firefox, Opera, and IE. To compare
  the browsers a bit, I pasted arc.arc surrounded by the following
  code...</p>
<pre>
(assign starttime (msec))

...

(- (msec) starttime)
</pre>
<p>...and got these results:</p>
<ul>
  <li>Chrome 13.0.782.112 m: <b>1429 ms</b></li>
  <li>Firefox 5.0: <b>2640 ms</b></li>
  <li>Opera 11.11: <b>4065 ms</b></li>
  <li>Internet Explorer 8.0.6001.18702: <b>40812 ms</b> (but this
    includes the time it took for me to dismiss four "Stop running
    this script?" dialogs)</li>
</ul>
<p>I was running all four browsers at the same time, so it was a
  pretty casual test. But hey, at least I wasn't <i>testing</i> them
  all at the same time. ^_^</p>
<p>Oh, but then Firefox and Opera updated, so I tested everything
  again:</p>
<ul>
  <li>Chrome 13.0.782.112 m: <b>1479 ms</b></li>
  <li>Firefox 6.0: <b>2835 ms</b></li>
  <li>Opera 11.50: <b>4173 ms</b></li>
  <li>Internet Explorer 8.0.6001.18702: <b>41453 ms</b> (but this
    includes the time it took for me to dismiss four "Stop running
    this script?" dialogs)</li>
</ul>
<div id="repl"></div>
</body>
</html>
