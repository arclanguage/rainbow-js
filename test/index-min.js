function makeInputAndOutput(){function b(){if(h!==null){var b=h,c=i;h=null;i=null;c(b)}}function c(b,c,j,o){if(d.length!==0){var w=d[0];if(d.length===1&&(w.type==="byte"||w.val.length<<1===f+1))return g?(c&&(d=[]),b(null,null),!0):(o||(h=b,i=j),!1);var t,j=0,o=f,m=w;if(m.type==="byte")j++,w=m.val;else{m=m.val;t=m.charCodeAt(o>>>1);if(o&1)return c&&(f++,m.length<<1<=f&&(d.shift(),f=0)),b(null,t),!0;w=t>>>8&255;o++;m.length<<1<=o&&(j++,o=0)}m=d[j];m.type==="byte"?(j++,t=m.val):(m=m.val,t=m.charCodeAt(o>>>
1),t=(o&1?t:t>>>8)&255,o++,m.length<<1<=o&&(j++,o=0));c&&(j&&d.shift(),f=o);b(null,w<<8|t);return!0}else return g?(b(null,null),!0):(o||(h=b,i=j),!1)}var d=[],f=0,g=!1,h=null,i=null,j={},l=j.readByteAsync=function(b,c){if(d.length!==0){var j=d[0];if(j.type==="byte")d.shift(),b(null,j.val);else{var j=j.val,o=j.charCodeAt(f>>>1),o=(f&1?o:o>>>8)&255;f++;j.length<<1<=f&&(d.shift(),f=0);b(null,o)}return!0}else return g?(b(null,null),!0):(c||(h=b,i=l),!1)},k=j.readCharCodeAsync=function(b,d){return c(b,
!0,k,d)},q=j.peekCharCodeAsync=function(b,d){return c(b,!1,q,d)};j.close=function(){};j.readStringAvailable=function(){var b=d.length,c=!1,g,h=[],j=0;if(f&1){var i=d[0].val,c=!0;g=i.charCodeAt(f>>>1)&255;f++;for(var m=f>>>1,u=i.length;m<u;m++){var n=i.charCodeAt(m);h.push(String.fromCharCode(g<<8|n>>>8&255));g=n&255}f=0;j++}else f&&(h.push(d[0].val.substring(f>>>1)),f=0,j++);for(b=d.length;j<b;j++)if(i=d[j],i.type==="byte")c?(h.push(String.fromCharCode(g<<8|i.val)),c=!1):(g=i.val,c=!0);else if(i=
i.val,c){m=0;for(u=i.length;m<u;m++)n=i.charCodeAt(m),h.push(String.fromCharCode(g<<8|n>>>8&255)),g=n&255}else h.push(i);d=c?[{type:"byte",val:g}]:[];return h.join("")};return{i:j,o:{writeString:function(c){!g&&c!==""&&(d.push({type:"string",val:c}),b())},writeByte:function(c){g||(d.push({type:"byte",val:c}),b())},close:function(){g=!0;b()},flush:function(){}}}}
var consoleIn=makeInputAndOutput("consoleIn"),rainbowStdin=makeInputAndOutput("rainbowStdin"),rainbowStdout=makeInputAndOutput("rainbowStdout"),rainbowStderr=makeInputAndOutput("rainbowStderr"),System_in=rainbowStdin.i,System_out=rainbowStdout.o,System_err=rainbowStderr.o;function System_out_print(b){System_out.writeString(""+b)}function System_out_println0(){System_out.writeString("\n")}function System_out_println(b){System_out.writeString(""+b+"\n")}function printStackTrace(b,c){void 0===c&&(c=System_err);for(c.writeString(""+b+"\n"+(b.stack||b)+"\n");b instanceof ArcError&&(b=b.getCause());)b instanceof ArcException&&(b=b.getOriginal()),c.writeString("Caused by: "+b+"\n"+(b.stack||b)+"\n")}var classes={};
function ArcError(b,c){Error.call(this,b);this.message=b;this.stack=Error().stack;this.e_=c;this.arcStack_=[]}ArcError.prototype=Error();ArcError.prototype.getMessage=function(){return this.message};ArcError.prototype.getCause=function(){return this.e_};function LexicalClosure(b,c){this.parent=c;this.bindings_=Array(~~b);this.count_=0}
LexicalClosure.prototype.add=function(b){if(this.bindings_.length<=this.count_)throw new ArcError("Can't add "+b+" to bindings: already full ("+this.count_+") "+Pair.buildFrom1(this.bindings_));this.bindings_[this.count_]=b;this.count_++};LexicalClosure.prototype.nth=function(b){return b===0?this:this.parent.nth(b-1)};
LexicalClosure.prototype.toString=function(){for(var b=[],c=0;c<this.bindings_.length;c++)b.push(c),b.push(" : "),b.push(this.bindings_[c]),b.push("\n");return b.join("")+"\nparent: "+(this.parent===null?"<none>":this.parent.toString())};LexicalClosure.prototype.at=function(b){return this.bindings_[b]};LexicalClosure.prototype.set=function(b,c){return this.bindings_[b]=c};LexicalClosure.prototype.finished=function(){return this.count_===this.bindings_.length};LexicalClosure.prototype.count=function(){return this.count_};
LexicalClosure.prototype.size=function(){return this.bindings_.length};function ParseException(){Error.call(this)}ParseException.prototype=Error();function ArcObject(){}ArcObject.prototype.implementsConditional=!1;ArcObject.prototype.className="ArcObject";ArcObject.prototype.literal=function(){return!1};ArcObject.prototype.addInstructions=function(){throw new ArcError("addInstructions not defined on "+this+", a "+this.className);};
ArcObject.prototype.invoke=function(b,c){var d=ArcObject.TYPE_DISPATCHER_TABLE.value();if(!(d instanceof Hash))throw new TypeError;d=d.value(this.type());if(d instanceof Nil)throw new ArcError("No handler for "+this.type()+" in call* table: called "+this+" with args "+c);d.invoke(b,new Pair(this,c))};ArcObject.prototype.invokef0=function(b){this.invoke(b,ArcObject.NIL)};ArcObject.prototype.invokef1=function(b,c){this.invoke(b,new Pair(c,ArcObject.NIL))};
ArcObject.prototype.invokef2=function(b,c,d){this.invoke(b,new Pair(c,new Pair(d,ArcObject.NIL)))};ArcObject.prototype.invokef3=function(b,c,d,f){this.invoke(b,new Pair(c,new Pair(d,new Pair(f,ArcObject.NIL))))};ArcObject.prototype.len=function(){throw new ArcError("len: expects one string, list or hash argument, got "+this.type());};ArcObject.prototype.scar=function(){throw new ArcError("Can't set car of "+this.type());};
ArcObject.prototype.sref=function(b,c){throw new ArcError("Can't sref "+this+"( a "+this.type()+"), other args were "+b+", "+c);};ArcObject.prototype.compareTo=function(){return 0};ArcObject.prototype.xcar=function(){return ArcObject.NIL};ArcObject.prototype.car=function(){throw new ArcError("Can't take car of "+this);};ArcObject.prototype.cdr=function(){throw new ArcError("Can't take cdr of "+this);};ArcObject.prototype.isCar=function(){return!1};ArcObject.prototype.type=void 0;
ArcObject.prototype.copy=function(){return this};ArcObject.prototype.unwrap=function(){return this};ArcObject.prototype.isSame=function(b){return this===b};ArcObject.prototype.copyTo=function(b){return b};ArcObject.prototype.isNotPair=function(){return!0};ArcObject.prototype.mustBePairOrNil=function(){throw new Pair.NotPair;};ArcObject.prototype.mustBeNil=function(){throw new ArcObject.NotNil;};ArcObject.prototype.or=function(){return this};
ArcObject.prototype.invokeAndWait=function(b,c){for(var d=c,f=0;!(c instanceof Nil);)b.pushA(c.car()),c=c.cdr(),f++;b.pushFrame(new ArcObject.ConvertError(d,b.getAp(),this));d=new Invoke_N.Other(f);d.belongsTo(this);b.pushFrame(d);d=new Literal(this);d.belongsTo(this);b.pushFrame(d)};ArcObject.prototype.hasLen=function(){throw new ArcError("has length: not a proper list: ends with "+this);};
ArcObject.prototype.longerThan=function(){throw new ArcError("longer than: not a proper list: ends with "+this);};ArcObject.prototype.nest=function(){return this};ArcObject.prototype.collectReferences=function(){};ArcObject.prototype.visit=function(){};ArcObject.prototype.replaceBoundSymbols=function(){return this};ArcObject.prototype.unassigned=function(){};ArcObject.prototype.assigned=function(){};ArcObject.prototype.assignedName=function(){return ArcObject.NIL};
ArcObject.prototype.profileName=function(){return this.assignedName().toString()};ArcObject.prototype.add=function(){throw new ArcError("add not implemented for "+this.type()+" "+this);};ArcObject.prototype.sqrt=function(){throw new ArcError("sqrt not implemented for "+this.type()+" "+this);};ArcObject.prototype.multiply=function(){throw new ArcError("multiply not implemented for "+this.type()+" "+this);};ArcObject.NotNil=function(){};ArcObject.prototype.reduce=function(){return this};
ArcObject.prototype.hasClosures=function(){return!1};ArcObject.prototype.inline5=function(){return this};ArcObject.prototype.inline3=function(){return this};ArcObject.prototype.assigns=function(){return!1};ArcObject.prototype.disp=function(){return this.toString()};
var ArcParser={isNonSymAtom:function(b){if(/^-?[01-9]+\/[01-9]+$/.test(b)||/^-?[01-9]+$/.test(b)||/^[-+]?[01-9]*\.?[01-9]+(e-?[01-9]+)?$/.test(b)||b==="+inf.0"||b==="-inf.0"||b==="+nan.0"||b==="+i"||b==="-i"||/^([-+]?[01-9]*\.?[01-9]+(?:e-?[01-9]+)?)([-+])([01-9]*\.?[01-9]+(?:e-?[01-9]+)?)?i$/.test(b)||/\\(?!\|)/.test(b))return!0;for(var c=0,d=b.length;c<d;c++){var f=b.charCodeAt(c);if(!(/^[-+$%&*\/<=>?^_~.!:01-9a-zA-Z]+$/.test(b.charAt(c))||128<=f&&f<65536))return!0}return!1}};
ArcParser.readFirstObjectFromString=function(b){var c=null;if(!ArcParser.readObjectAsync((new StringInputPort(b)).unwrap(),function(b,f){if(b)throw b;c=f},!0))throw new ParseException;return c};
ArcParser.readObjectAsync=function(b,c,d){function f(c){return b.peekCharCodeAsync(function(b,d){if(b)return void c(b);c(null,d===null?null:String.fromCharCode(d))},d)}function g(c){return b.readCharCodeAsync(function(b,d){if(b)return void c(b);c(null,d===null?null:String.fromCharCode(d))})}function h(b){for(var c=!0,d=!1;c&&!d;)d=!0,g(function(j,i){if(j)return void b(j);i===null||i==="\n"?b(null):i==="\r"?f(function(d,f){if(d)return void b(d);f==="\n"?g(function(c){if(c)return void b(c);b(null)})||
(c=!1):b(null)})||(c=!1):(d=!1,c||h(b))})||(c=!1);return c}function i(b){for(var c=!0,d=!1;c&&!d;)d=!0,f(function(f,j){function n(f){if(f)return void b(f);d=!1;c||i(b)}if(f)return void b(f);j===";"?h(n)||(c=!1):j===null||/[^ \t\r\n]/.test(j)?b(null):g(n)||(c=!1)})||(c=!1);return c}function j(b,c){function d(f){var g=b.length-1,h=b[g];b=typeof f==="string"&&h instanceof ArcString?b.slice(0,g).concat([ArcString.make(h.value()+f)]):typeof f==="string"?b.concat([ArcString.make(f)]):b.concat([f]);k=!1;
n||j(b,c)}function h(b){b===void 0&&(b=new ParseException);c(b)}function r(){x(function(b,c){if(b)return h(b);i(function(b){if(b)return h(b);g(function(b,f){if(b)return h(b);f===")"?d(c):h()})||(n=!1)})||(n=!1)})||(n=!1)}for(var n=!0,k=!1;n&&!k;)k=!0,g(function(j,i){if(j)return h(j);i===null?h():i==='"'?c(null,b):i==="\\"?g(function(b,c){if(b)return h(b);c==='"'?d('"'):c==="\\"?d("\\"):c==="n"?d("\n"):c==="r"?d("\r"):c==="t"?d("\t"):c==="#"?g(function(b,c){if(b)return h(b);c==="("?d("#("):h()})||
(n=!1):h()})||(n=!1):i==="#"?f(function(b,c){if(b)return h(b);if(c!=="(")return void d("#");g(function(b){if(b)return h(b);r()})||(n=!1)})||(n=!1):d(i)})||(n=!1);return n}function l(b,c){function d(b){c(null,ArcCharacter.makeFromCharCode(b))}for(var h=!0,j=!1;h&&!j;)j=!0,f(function(f,i){if(f)return void c(f);i===null||/[^01-9a-zA-Z]/.test(i)?b==="newline"?d("\n".charCodeAt(0)):b==="tab"?d("\t".charCodeAt(0)):b==="space"?d(" ".charCodeAt(0)):b==="return"?d("\r".charCodeAt(0)):b==="null"?d("\x00".charCodeAt(0)):
/^[01-9][01-9]+$/.test(b)?d(parseInt(b,10)):/^u[0-9a-f]+$/i.test(b)?d(parseInt(b.substring(1),16)):b.length===1?d(b.charCodeAt(0)):c(new ParseException):g(function(d,f){if(d)return void c(d);j=!1;b+=f;h||l(b,c)})||(h=!1)})||(h=!1);return h}function k(b,c){for(var d=!0,h=!1;d&&!h;)h=!0,f(function(f,j){if(f)return void c(f);if(j===null||/[^01-9a-fA-F]/.test(j)){if(b==="")return void c(new ParseException);c(null,Rational.make1(parseInt(b,16)))}else g(function(f,g){if(f)return void c(f);h=!1;b+=g;d||
k(b,c)})||(d=!1)})||(d=!1);return d}function q(b,c){for(var d=!0,f=!1;d&&!f;)f=!0,g(function(g,h){if(g)return void c(g);h===null?c(new ParseException):h==="|"?c(null,Symbol.make(b)):(f=!1,b+=h,d||q(b,c))})||(d=!1);return d}function r(b,c,d){for(var h=!0,j=!1;h&&!j;)j=!0,i(function(i){if(i)return void d(i);f(function(f,i){if(f)return void d(f);i===null?d(new ParseException):i===c?g(function(c){if(c)return void d(c);d(null,b)})||(h=!1):x(function(f,g){if(f)return void d(f);j=!1;b=b.concat([g]);h||r(b,
c,d)})||(h=!1)})||(h=!1)})||(h=!1);return h}function y(b,c){for(var d=!0,h=!1;d&&!h;)h=!0,f(function(f,j){if(f)return void c(f);var i=j!==null&&j.charCodeAt(0);if(j!==null&&(/^[-+$%&*\/<=>?^_~.!:01-9a-zA-Z]+$/.test(j)||128<=i&&i<65536))g(function(f,g){if(f)return void c(f);h=!1;b+=g;d||y(b,c)})||(d=!1);else if(j==="\\")g(function(f){if(f)return void c(f);g(function(f,g){if(f)return void c(f);g==="|"?(h=!1,b+="\\|",d||y(b,c)):c(new ParseException)})||(d=!1)})||(d=!1);else{var r;/^-?[01-9]+\/[01-9]+$/.test(b)?
c(null,Rational.parse(b)):/^-?[01-9]+$/.test(b)?c(null,Rational.make1(parseInt(b,10))):/^[-+]?[01-9]*\.?[01-9]+(e-?[01-9]+)?$/.test(b)?c(null,Real.parse(b)):b==="+inf.0"?c(null,Real.positiveInfinity()):b==="-inf.0"?c(null,Real.negativeInfinity()):b==="+nan.0"?c(null,Real.nan()):b==="+i"?c(null,new Complex(0,1)):b==="-i"?c(null,new Complex(0,-1)):(r=/^([-+]?[01-9]*\.?[01-9]+(?:e-?[01-9]+)?)([-+])([01-9]*\.?[01-9]+(?:e-?[01-9]+)?)?i$/.exec(b))?c(null,new Complex(Real.parse(r[1]).value(),Real.parse(r[2]+
(r[3]||"1")).value())):c(null,Symbol.make(b))}})||(d=!1);return d}function x(b){function c(){j([],function(c,d){if(c)return void b(c);d.length===0?b(null,ArcString.make("")):d.length===1?b(null,d[0]):b(null,Pair.buildFrom1([Symbol.make("string")].concat(d)))})||(p=!1)}function d(){q("",function(c,d){if(c)return void b(c);b(null,Symbol.make(d))})||(p=!1)}function h(){g(function(c,d){if(c)return void b(c);d!==null&&/x/i.test(d)?k("",b)||(p=!1):d==="\\"?g(function(c,d){if(c)return void b(c);if(/[^a-zA-Z]/.test(c))return void b(null,
ArcCharacter.makeFromCharCode(c.charCodeAt(0)));l(d,b)||(p=!1)})||(p=!1):b(new ParseException)})||(p=!1)}function u(c){x(function(d,f){if(d)return void b(d);f===null?b(new ParseException):b(null,Pair.buildFrom1([Symbol.mkSym(c),f]))})||(p=!1)}function n(){f(function(c,d){if(c)return void b(c);d===null?b(new ParseException):d==="@"?g(function(c){if(c)return void b(c);u("unquote-splicing")})||(p=!1):u("unquote")})||(p=!1)}function z(){r([],")",function(c,d){if(c)return void b(c);if(d.length===0)b(null,
ArcObject.EMPTY_LIST);else{try{var f=Pair.parse(d)}catch(g){return void b(g)}b(null,f)}})||(p=!1)}function A(){r([],"]",function(c,d){if(c)return void b(c);b(null,Pair.buildFrom1([Symbol.mkSym("fn"),Pair.buildFrom1([Symbol.mkSym("_")]),Pair.buildFrom1(d)]))})||(p=!1)}var p=!0;i(function(f){if(f)return void b(f);g(function(f,g){if(f)return void b(f);g===null?b(null,null):g==='"'?c():g==="|"?d():g==="#"?h():g==="'"?u("quote"):g===","?n():g==="`"?u("quasiquote"):g==="("?z():g==="["?A():y(g,b)||(p=!1)})||
(p=!1)})||(p=!1);return p}return x(c)};function Symbol(b,c){ArcObject.call(this);this.name_=b;this.parseableName_=c;this.hash_=b;this.coerceFrom_=this.value_=null}Symbol.prototype=new ArcObject;Symbol.prototype.className="Symbol";Symbol.prototype.addInstructions=function(b){b.push(new FreeSym(this))};Symbol.mkSym=function(b){var c=Symbol.make(b);if(c instanceof Symbol)return c;else throw new ArcError("can't make symbol from \""+b+'"');};
Symbol.make=function(b){return b==="t"?ArcObject.T:b==="nil"?ArcObject.NIL:Symbol.requiresPiping_.test(b)||ArcParser.isNonSymAtom(b)||b==="."?Symbol.nu(b,"|"+b+"|"):Symbol.hasEscapedPiping_.test(b)?Symbol.nu(b.replace(/\\\|/g,"|"),b):Symbol.nu(b,b)};Symbol.prototype.disp=function(){return this.name_};Symbol.prototype.toString=function(){return this.parseableName_};Symbol.nu=function(b,c){if(b in Symbol.map_)return Symbol.map_[b];var d=new Symbol(b,c);return Symbol.map_[b]=d};
Symbol.parse=function(b){return Symbol.make(b.substring(1,b.length-1))};Symbol.prototype.name=function(){return this.name_};Symbol.prototype.compareTo=function(b){if(!(b instanceof Symbol))throw new TypeError;return this.name_.localeCompare(b.name)};Symbol.prototype.type=function(){return Symbol.TYPE};Symbol.prototype.unwrap=function(){return this.name()};Symbol.prototype.hashCode=function(){return this.hash_};Symbol.prototype.equals=function(b){return this===b};
Symbol.is=function(b,c){return c instanceof Symbol&&c.name()===b};Symbol.prototype.setValue=function(b){var c=this.value_;this.value_=b;c!==null&&c.unassigned(this);b.assigned(this)};Symbol.prototype.value=function(){if(this.value_===null)throw new ArcError("Symbol "+this.name_+" is not bound");return this.value_};Symbol.prototype.bound=function(){return this.value_!==null};
Symbol.cast=function(b,c){try{if(!(b instanceof Symbol))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected a Symbol, got "+b);}};Symbol.prototype.addCoercion=function(b,c){if(this.coerceFrom_===null)this.coerceFrom_={};this.coerceFrom_[b.name()]=c};Symbol.prototype.getCoercion=function(b){return this.coerceFrom_[b]||null};Symbol.map_={};Symbol.requiresPiping_=/.*(["'; \t\n\)\(]|([^\\]|^)\|).*/;
Symbol.hasEscapedPiping_=/.*\\\|/;Symbol.TYPE=Symbol.mkSym("sym");Symbol.DOT=Symbol.mkSym(".");Symbol.BANG=Symbol.mkSym("!");function Pair(b,c){ArcObject.call(this);if(b===null)throw new ArcError("Can't create Pair with null car: use NIL instead");if(c===null)throw new ArcError("Can't create Pair with null cdr: use NIL instead");this.car_=b;this.cdr_=c}Pair.of=function(){var b=new Pair(void 0,void 0);b.real_=b.imaginary_=null;return b};Pair.prototype=new ArcObject;Pair.prototype.className="Pair";
Pair.prototype.invoke=function(b,c){var d=ArcNumber.cast(c.car(),this);b.pushA(this.nth(d.toInt()).car())};Pair.prototype.xcar=function(){return this.car_};Pair.prototype.car=function(){return this.car_};Pair.prototype.cdr=function(){return this.cdr_};Pair.prototype.mustBeNil=function(){if(this.car_!==null)throw new ArcObject.NotNil;};Pair.prototype.isNotPair=function(){return!1};Pair.prototype.scar=function(b){return this.car_=b};
Pair.prototype.sref=function(b,c){return this.nth(Rational.cast(c,this).toInt()).scar(b)};Pair.prototype.isCar=function(b){return b===this.car_};Pair.prototype.toString=function(){if(this.isSpecial()){var b=this.car(),b=Pair.specials_[b.name()],c=this.cdr();if(!(c instanceof Pair))throw new TypeError;return b+c.internalToString_()}else return"("+this.internalToString_()+")"};Pair.prototype.internalToString_=function(){return Pair.internalToString_(this)};
Pair.internalToString_=function(b){for(var c=[];!b.isNotPair();)c.push(b.car()),b.cdr().isNotPair()||c.push(" "),b=b.cdr();b instanceof Nil||c.push(" . ",b);return c.join("")};Pair.prototype.setCdr=function(b){this.cdr_=b};Pair.parse=function(b){return b===null||b.length===0?ArcObject.NIL:b[0]===Symbol.DOT?Pair.illegalDot_(b):new Pair(b[0],Pair.internalParse_(b.slice(1)))};
Pair.internalParse_=function(b){if(b.length===0)return ArcObject.NIL;if(b[0]===Symbol.DOT)if(b.length===2){b=b[1];if(!(b instanceof ArcObject))throw new TypeError;return b}else return Pair.illegalDot_(b);var c=b[0];if(!(c instanceof ArcObject))throw new TypeError;return new Pair(c,Pair.internalParse_(b.slice(1)))};Pair.illegalDot_=function(b){throw new ArcError('Error: illegal use of "." in '+b);};
Pair.buildFrom_=function(b,c,d){if(d===b.length)return c;else{var f=b[d];if(!(f instanceof ArcObject))throw new TypeError;return new Pair(f,Pair.buildFrom_(b,c,d+1))}};Pair.buildFrom2=function(b,c){return b===null||b.length===0?c:Pair.buildFrom_(b,c,0)};Pair.buildFrom1=function(b){return Pair.buildFrom2(b,ArcObject.NIL)};Pair.prototype.type=function(){return Pair.TYPE};Pair.prototype.len=function(){return this.size()};Pair.prototype.improperLen=function(){return Pair.improperLen(this)};
Pair.improperLen=function(b){for(var c=0;!b.isNotPair();)c++,b=b.cdr();return c};Pair.prototype.size=function(){if(this instanceof Nil)return 0;else{for(var b=1,c=this.cdr_;!(c instanceof Nil);){if(c.isNotPair())throw new ArcError("cannot take size: not a proper list: "+this);b++;c=c.cdr()}return b}};Pair.prototype.compareTo=function(){throw new ArcError("Pair.compareTo:unimplemented");};
Pair.prototype.copyTo=function(b){b.push(this.car());if(this.cdr()instanceof Nil)return b;else if(!(this.cdr()instanceof Pair))throw new ArcError("Not a list: "+this);this.cdr().copyTo(b);return b};Pair.prototype.equals=function(b){if(this===b)return!0;var c=this instanceof Nil;if(!(b instanceof ArcObject))throw new TypeError;var d=b instanceof Nil;return c!==d?!1:c&&d?!0:b instanceof Pair?(c=b.car_.equals(this.car_),b=b.cdr_.equals(this.cdr_),c&&b):!1};
Pair.prototype.hashCode=function(){return this.car().hashCode()+this.cdr().hashCode()};Pair.prototype.nth=function(b){try{var c=Pair.nth_(this,b);if(!(c instanceof Pair))throw new TypeError;return c}catch(d){if(!(d instanceof Pair.OOB))throw e;throw new ArcError("Error: index "+b+" too large for list "+this);}};Pair.nth_=function(b,c){for(;0<c;){if(b.cdr()instanceof Nil)throw new Pair.OOB;b=b.cdr();c--}return b};Pair.prototype.hasLen=function(b){return this.cdr().hasLen(b-1)};
Pair.prototype.longerThan=function(b){return b<0||this.cdr().longerThan(b-1)};Pair.prototype.profileName=function(){return"ref:"+this.type().toString()};Pair.OOB=function(){Error.call(this)};Pair.OOB.prototype=Error();Pair.prototype.isSpecial=function(){return this.car()instanceof Symbol&&this.car().name()in Pair.specials_&&this.cdr()instanceof Pair&&this.cdr().size()===1};Pair.prototype.copy=function(){return this instanceof Nil?this:new Pair(this.car(),this.cdr().copy())};
Pair.prototype.unwrap=function(){var b=[];Pair.unwrapList_(b,this);return b};Pair.prototype.isSame=function(b){return ArcObject.prototype.isSame.call(this,b)||this instanceof Nil&&b instanceof Nil};Pair.unwrapList_=function(b,c){if(!(c instanceof Nil)){b.push(c.car().unwrap());var d=c.cdr();if(!(d instanceof Pair))throw new TypeError;Pair.unwrapList_(b,d)}};Pair.prototype.toArray=function(){var b=Array(~~this.size());this.toArray_(b,0);return b};
Pair.prototype.toArray_=function(b,c){if(c<b.length){b[c]=this.car_;var d=this.cdr_;if(!(d instanceof Pair))throw new TypeError;d instanceof Nil||d.toArray_(b,c+1)}};Pair.cast=function(b,c){try{if(!(b instanceof Pair))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected a cons, got "+b);}};Pair.prototype.mustBePairOrNil=function(){};
Pair.append=function(b,c){if(b===null)return new Pair(c,ArcObject.NIL);else{for(var d=b;!(d.cdr_ instanceof Nil);)if(d=d.cdr_,!(d instanceof Pair))throw new TypeError;d.cdr_=new Pair(c,ArcObject.NIL)}return b};Pair.prototype.add=function(b){if(b instanceof Pair){var c=[];this.copyTo(c);b.copyTo(c);return Pair.buildFrom1(c)}else throw new ArcError("+ : expects cons, got "+b.type()+" "+b);};Pair.prototype.rev=function(){return null};
Pair.prototype.visit=function(b){b.acceptPair(this);for(var c=this;!c.isNotPair();)c.car().visit(b),c=c.cdr();c instanceof Nil||c.visit(b);b.endPair(this)};Pair.prototype.isProper=function(){return Pair.isProper(this)};Pair.isProper=function(b){for(;!b.isNotPair();)b=b.cdr();return b instanceof Nil};Pair.prototype.isProper=function(){return Pair.isProper(this)};Pair.NotPair=function(){};Pair.TYPE=Symbol.mkSym("cons");Pair.specials_={quasiquote:"`",quote:"'",unquote:",","unquote-splicing":",@"};
function Nil(b){this.car_=this.cdr_=null;this.rep_=b}Nil.prototype=Pair.of();Nil.prototype.className="Nil";Nil.prototype.addInstructions=function(b){b.push(new Literal(Nil.NIL))};Nil.prototype.invoke=function(b,c){throw new ArcError("Function dispatch on inappropriate object: "+this+" with args "+c);};Nil.prototype.mustBePairOrNil=function(){};Nil.prototype.literal=function(){return!0};Nil.prototype.len=function(){return 0};Nil.prototype.isNotPair=function(){return!0};Nil.prototype.mustBeNil=function(){};
Nil.prototype.toString=function(){return this.rep_};Nil.prototype.xcar=function(){return this};Nil.prototype.car=function(){return this};Nil.prototype.cdr=function(){return this};Nil.prototype.isCar=function(){return!1};Nil.prototype.setCar=function(){throw Error("can't set the car of "+this);};Nil.prototype.setCdr=function(){throw Error("can't set the cdr of "+this);};Nil.prototype.size=function(){return 0};Nil.prototype.copyTo=function(b){return b};Nil.prototype.type=function(){return Nil.TYPE};
Nil.prototype.hashCode=function(){return"nil"};Nil.prototype.equals=function(b){if(this===b)return!0;if(!(b instanceof ArcObject))throw new TypeError;return b instanceof Nil};Nil.prototype.unwrap=function(){return!1};Nil.prototype.isSame=function(b){return b instanceof Nil};Nil.prototype.or=function(b){return b};Nil.prototype.hasLen=function(b){return b===0};Nil.prototype.longerThan=function(b){return b<0};Nil.TYPE=Symbol.TYPE;Nil.NIL=new Nil("nil");Nil.EMPTY_LIST=new Nil("()");
function Truth(){Symbol.call(this,this.name_,this.parseableName_);if(Truth.T!==void 0)throw Error();}Truth.prototype=new Symbol("t","t");Truth.prototype.className="Truth";Truth.prototype.literal=function(){return!0};Truth.prototype.addInstructions=function(b){b.push(new Literal(Truth.T))};Truth.prototype.toString=function(){return"t"};Truth.prototype.compareTo=function(){throw new ArcError("Truth.compareTo:unimplemented");};Truth.prototype.type=function(){return Symbol.TYPE};
Truth.valueOf=function(b){return b?Truth.T:ArcObject.NIL};Truth.prototype.hashCode=function(){return"t"};Truth.prototype.equals=function(b){return this===b};Truth.prototype.unwrap=function(){return!0};Truth.prototype.setValue=function(){throw new ArcError("error: can't rebind t!");};Truth.prototype.value=function(){return this};Truth.T=new Truth;function Instruction(){ArcObject.call(this);this.owner_=null}Instruction.prototype=new ArcObject;Instruction.prototype.implementsFinally=!1;
Instruction.prototype.implementsOnError=!1;Instruction.prototype.implementsInvoke=!1;Instruction.prototype.implementsAsync=!1;Instruction.prototype.className="Instruction";Instruction.prototype.type=function(){return Symbol.mkSym("instruction")};Instruction.prototype.toStringWithLc=function(){return this.toString()};Instruction.prototype.toString=function(){return"("+this.className+")"};Instruction.prototype.symValue=function(b){return b.bound()?""+b.value():"#unbound#"};
Instruction.prototype.operate=void 0;Instruction.prototype.belongsTo=function(b){this.owner_=b};Instruction.prototype.visit=function(b){b.acceptInstruction(this)};Instruction.prototype.owner=function(){return this.owner_};ArcObject.ConvertError=function(b,c,d){Instruction.call(this);this.orig_=b;this.ap_=c;this.belongsTo(d)};ArcObject.ConvertError.prototype=new Instruction;ArcObject.ConvertError.prototype.implementsOnError=!0;ArcObject.ConvertError.prototype.className="ArcObject.ConvertError";
ArcObject.ConvertError.prototype.catches=function(b){return b instanceof Error};ArcObject.ConvertError.prototype.operate=function(b){var c=b.error();if(c!==null)throw b.clearError(),b.setAp(this.ap_),new ArcError("error invoking "+this.owner()+" with args "+this.orig_+": "+c,c);};ArcObject.TYPE_DISPATCHER_TABLE=Symbol.mkSym("call*");ArcObject.NIL=Nil.NIL;ArcObject.EMPTY_LIST=Nil.EMPTY_LIST;ArcObject.T=Truth.T;function LiteralObject(){ArcObject.call(this)}LiteralObject.prototype=new ArcObject;
LiteralObject.prototype.className="LiteralObject";LiteralObject.prototype.literal=function(){return!0};LiteralObject.prototype.addInstructions=function(b){b.push(new Literal(this))};LiteralObject.prototype.profileName=function(){return"ref:"+this.type().toString()};function ArcCharacter(b){LiteralObject.call(this);this.value_=b;ArcCharacter.chars_[b]=this}ArcCharacter.prototype=new LiteralObject;ArcCharacter.prototype.className="ArcCharacter";
ArcCharacter.makeFromCharCode=function(b){return ArcCharacter.chars_[b]===void 0?new ArcCharacter(b):ArcCharacter.chars_[b]};
ArcCharacter.makeFromString=function(b){if(b.length===3)return ArcCharacter.makeFromCharCode(b.charCodeAt(2));if(/^#\\U/i.test(b))return ArcCharacter.makeFromCharCode(parseInt(b.substring(3),16));for(var c=0;c<ArcCharacter.named_.length;c++)if(ArcCharacter.named_[c].is_(b))return ArcCharacter.named_[c];try{var d=ArcCharacter.parseInt_(b);return make(d)}catch(f){if(!(f instanceof Error))throw f;throw new ArcError("Can't make character from "+b);}};
ArcCharacter.parseInt_=function(b){return parseInt(b.substring(2),8)};ArcCharacter.prototype.literal=function(){return!0};ArcCharacter.prototype.toString=function(){return"#\\"+String.fromCharCode(this.value_)};ArcCharacter.prototype.is_=function(b){return this.toString()===b};ArcCharacter.prototype.compareTo=function(b){if(!(b instanceof ArcCharacter))throw new TypeError;return this.value_-other.value_};ArcCharacter.prototype.type=function(){return ArcCharacter.TYPE};
ArcCharacter.prototype.unwrap=function(){return this.value()};ArcCharacter.prototype.value=function(){return this.value_};ArcCharacter.prototype.disp=function(){return String.fromCharCode(this.value_)};ArcCharacter.prototype.hashCode=function(){return this.disp()};ArcCharacter.prototype.equals=function(b){return this===b||b instanceof ArcCharacter&&b.value_===this.value_};
ArcCharacter.cast=function(b,c){try{if(!(b instanceof ArcCharacter))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected a character, got "+b);}};ArcCharacter.TYPE=Symbol.mkSym("char");ArcCharacter.chars_=Array(65536);ArcCharacter.Anon_NULL_=function(){ArcCharacter.call(this,0)};ArcCharacter.Anon_NULL_.prototype=new ArcCharacter(0);ArcCharacter.Anon_NULL_.prototype.className="ArcCharacter.Anon_NULL_";
ArcCharacter.Anon_NULL_.prototype.toString=function(){return"#\\null"};ArcCharacter.NULL=new ArcCharacter.Anon_NULL_;ArcCharacter.Anon_named_1_=function(){ArcCharacter.call(this,"\n".charCodeAt(0))};ArcCharacter.Anon_named_1_.prototype=new ArcCharacter("\n".charCodeAt(0));ArcCharacter.Anon_named_1_.prototype.className="ArcCharacter.Anon_named_1_";ArcCharacter.Anon_named_1_.prototype.toString=function(){return"#\\newline"};ArcCharacter.Anon_named_2_=function(){ArcCharacter.call(this,"\t".charCodeAt(0))};
ArcCharacter.Anon_named_2_.prototype=new ArcCharacter("\t".charCodeAt(0));ArcCharacter.Anon_named_2_.prototype.className="ArcCharacter.Anon_named_2_";ArcCharacter.Anon_named_2_.prototype.toString=function(){return"#\\tab"};ArcCharacter.Anon_named_3_=function(){ArcCharacter.call(this,"\r".charCodeAt(0))};ArcCharacter.Anon_named_3_.prototype=new ArcCharacter("\r".charCodeAt(0));ArcCharacter.Anon_named_3_.prototype.className="ArcCharacter.Anon_named_3_";
ArcCharacter.Anon_named_3_.prototype.toString=function(){return"#\\return"};ArcCharacter.Anon_named_4_=function(){ArcCharacter.call(this," ".charCodeAt(0))};ArcCharacter.Anon_named_4_.prototype=new ArcCharacter(" ".charCodeAt(0));ArcCharacter.Anon_named_4_.prototype.className="ArcCharacter.Anon_named_4_";ArcCharacter.Anon_named_4_.prototype.toString=function(){return"#\\space"};
ArcCharacter.named_=[ArcCharacter.NULL,new ArcCharacter.Anon_named_1_,new ArcCharacter.Anon_named_2_,new ArcCharacter.Anon_named_3_,new ArcCharacter.Anon_named_4_];function ArcString(b){LiteralObject.call(this);this.value_=b}ArcString.prototype=new LiteralObject;ArcString.prototype.className="ArcString";
ArcString.prototype.invoke=function(b,c){Builtin.checkMaxArgCount(c,this.className,1);var d=Rational.cast(c.car(),this);if(!d.isInteger())throw new ArcError("string-ref: expects exact integer: got "+d);d=~~d.toInt();if(!(0<=d||d<this.value.length()))throw new ArcError("string-ref: index "+d+" out of range [0, "+(this.value_.length-1)+"] for string "+this.toString());b.pushA(ArcCharacter.makeFromCharCode(this.value_.charCodeAt(d)))};ArcString.prototype.value=function(){return this.value_};
ArcString.prototype.disp=function(){return this.value_};ArcString.prototype.toString=function(){return this.escape_(this.value_)};ArcString.prototype.escape_=function(b){var c=[];c.push('"');for(var d=0;d<b.length;d++)switch(b.charAt(d)){case '"':c.push('\\"');break;case "\\":c.push("\\\\");break;case "\n":c.push("\\n");break;case "\r":c.push("\\r");break;default:c.push(b.charAt(d))}c.push('"');return c.join("")};
ArcString.prototype.compareTo=function(b){if(!(b instanceof ArcString))throw new TypeError;return this.value_.localeCompare(b.value_)};ArcString.prototype.len=function(){return this.value_.length};ArcString.prototype.scar=function(b){var c=[ArcCharacter.cast(b,this).disp()];c.push(this.value().substring(1));this.setValue(c.join(""));return b};ArcString.prototype.sref=function(b,c){var d=ArcCharacter.cast(b,ArcCharacter);this.srefChar(Rational.cast(c,this),d);return b};ArcString.prototype.type=function(){return ArcString.TYPE};
ArcString.prototype.unwrap=function(){return this.value()};ArcString.make=function(b){return new ArcString(b)};ArcString.prototype.setValue=function(b){this.value_=b};ArcString.prototype.hashCode=function(){return this.value_};ArcString.prototype.equals=function(b){return this===b||b instanceof ArcString&&b.value_===this.value_};
ArcString.prototype.srefChar=function(b,c){b=b.toInt();if(!(0<=b&&b<this.value_.length))throw new RangeError;this.value_=this.value_.substring(0,b-1)+String.fromCharCode(c.value())+this.value_.substring(b+1)};ArcString.prototype.isSame=function(b){return this.equals(b)};
ArcString.prototype.add=function(b){var c=[this.value_];if(!(b instanceof ArcString)){var d=b.type();if(!(d instanceof Symbol))throw new TypeError;d=Typing.STRING.getCoercion(d);if(!(d instanceof Typing.Coercion))throw new TypeError;b=d.coerce1(b);if(!(b instanceof ArcString))throw new TypeError;}c.push(b.value());return ArcString.make(c.join(""))};
ArcString.cast=function(b,c){try{if(!(b instanceof ArcString))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected a string, got "+b);}};ArcString.TYPE=Symbol.mkSym("string");function ArcException(b,c,d){LiteralObject.call(this);this.operating_=c;this.original_=b;this.stackTrace_=d}ArcException.prototype=new LiteralObject;ArcException.prototype.className="ArcException";ArcException.prototype.type=function(){return ArcException.TYPE};
ArcException.prototype.message=function(){return this.original_!==null?ArcString.make(this.original_.message):ArcException.NO_MESSAGE_};ArcException.prototype.toString=function(){return this.message().toString()};ArcException.prototype.getOriginal=function(){return this.original_};
ArcException.cast=function(b,c){try{if(!(b instanceof ArcException))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected an exception, got "+b);}};ArcException.prototype.getStackTrace=function(){return this.stackTrace_};ArcException.prototype.getOperating=function(){return this.operating_};ArcException.TYPE=Symbol.mkSym("exn");ArcException.NO_MESSAGE_=ArcString.make("no message");
function ArcNumber(){LiteralObject.call(this)}ArcNumber.prototype=new LiteralObject;ArcNumber.prototype.className="ArcNumber";ArcNumber.prototype.isInteger=void 0;ArcNumber.prototype.toDouble=void 0;ArcNumber.prototype.toInt=void 0;ArcNumber.prototype.negate=void 0;ArcNumber.prototype.round=void 0;ArcNumber.prototype.roundJava=function(){throw new ArcError("round[closest] not implemented for "+this.className+"("+this+")");};ArcNumber.prototype.literal=function(){return!0};
ArcNumber.prototype.compareTo=function(b){if(!(b instanceof ArcNumber))throw new TypeError;b=b.toDouble()-this.toDouble();return b<0?1:b===0?0:-1};ArcNumber.prototype.type=function(){return this.isInteger()?ArcNumber.INT_TYPE:ArcNumber.NUM_TYPE};ArcNumber.prototype.isSame=function(b){return this.equals(b)};
ArcNumber.cast=function(b,c){try{if(!(b instanceof ArcNumber))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected a number, got "+b);}};ArcNumber.prototype.mod=function(){throw new ArcError("mod: not implemented for "+this.className+"("+this+")");};ArcNumber.INT_TYPE=Symbol.mkSym("int");ArcNumber.NUM_TYPE=Symbol.mkSym("num");function ArcThreadLocal(){LiteralObject.call(this);this.value_=null}ArcThreadLocal.prototype=new LiteralObject;
ArcThreadLocal.prototype.className="ArcThreadLocal";ArcThreadLocal.prototype.set=function(b){this.value_=b};ArcThreadLocal.prototype.get=function(){return this.value_};ArcThreadLocal.prototype.type=function(){return ArcThreadLocal.TYPE};ArcThreadLocal.cast=function(b,c){try{if(!(b instanceof ArcThreadLocal))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected a thread-local, got "+b);}};ArcThreadLocal.TYPE=Symbol.mkSym("thread-local");
function Complex(b,c){ArcNumber.call(this);this.real_=b;this.imaginary_=c}Complex.prototype=new ArcNumber;Complex.prototype.className="Complex";Complex.parse=function(){var b;if(soFar==="+i")return new Complex(0,1);else if(soFar==="-i")return new Complex(0,-1);else if(b=/^([-+]?[01-9]*\.?[01-9]+(?:e-?[01-9]+)?)([-+])([01-9]*\.?[01-9]+(?:e-?[01-9]+)?)?i$/.exec(soFar))return new Complex(Real.parse(b[1]).value(),Real.parse(b[2]+(b[3]||"1")).value());else throw new ParseException;};
Complex.prototype.isInteger=function(){return this.imaginary_===0&&Math.floor(this.real_)===real};Complex.prototype.toDouble=function(){throw new ArcError("Cannot convert complex to double");};Complex.prototype.toInt=function(){throw new ArcError("Cannot convert complex to int");};Complex.prototype.negate=function(){return new Complex(-this.real_,-this.imaginary_)};
Complex.prototype.toString=function(){return(new Real(this.real_)).toString()+(this.imaginary_<0?"":"+")+(new Real(this.imaginary_)).toString()+"i"};Complex.cast=function(b,c){try{if(!(b instanceof Complex))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected a complex number, got "+b);}};Complex.prototype.round=function(){return new ArcError("Can't convert "+this+" to integer")};Complex.prototype.imaginaryPart=function(){return new Real(this.imaginary_)};
Complex.prototype.realPart=function(){return new Real(this.real_)};Complex.prototype.multiplyByNumber=function(){var b=argument.toDouble();return new Complex(this.real_*b,this.imaginary_*b)};Complex.prototype.multiply=function(b){if(b instanceof Complex)return this.timesComplex(b);else{if(!(b instanceof ArcNumber))throw new TypeError;b=b.toDouble();return new Complex(this.real_*b,this.imaginary_*b)}};
Complex.prototype.timesComplex=function(b){var c=this.real_,d=b.real_,f=this.imaginary_,b=b.imaginary_;return new Complex(c*d-f*b,c*b+d*f)};Complex.prototype.plusComplex=function(b){return new Complex(this.real_+b.real_,this.imaginary_+b.imaginary_)};Complex.prototype.plusRational=function(b){return new Complex(this.real_+b.toDouble(),this.imaginary_)};Complex.prototype.plusReal=function(b){return new Complex(this.real_+b.toDouble(),this.imaginary_)};
Complex.prototype.add=function(b){if(b instanceof Complex)return this.plusComplex(b);else if(b instanceof Rational)return this.plusRational(b);else if(b instanceof Real)return this.plusReal(b);else throw new ArcError("+: expects a number, got "+b.type()+" "+b);};Complex.prototype.inverse=function(){var b=this.real_*this.real_+this.imaginary_*this.imaginary_;return new Complex(this.real_/b,-this.imaginary_/b)};
Complex.prototype.timesDouble=function(b){return new Complex(this.real_*b,this.imaginary_*b)};Complex.prototype.radius=function(){return Math.sqrt(this.real_*this.real_+this.imaginary_*this.imaginary_)};Complex.prototype.theta=function(){return Math.atan2(this.imaginary_,this.real_)};Complex.prototype.log=function(){return new Complex(Math.log(this.radius()),this.theta())};Complex.prototype.expt=function(b){return b instanceof Complex?this.log().timesComplex(b).exp():this.log().timesDouble(b.toDouble()).exp()};
Complex.prototype.sqrt=function(){return this.expt(Real.make(0.5))};Complex.prototype.exp=function(){var b=Math.exp(this.real_);return new Complex(b*Math.cos(this.imaginary_),b*Math.sin(this.imaginary_))};Complex.prototype.compareTo=function(){throw new ArcError("Compare: complex numbers are unordered and cannot be compared");};
Complex.make=function(b){if(b instanceof Complex)return b;else if(b instanceof ArcNumber)return new Complex(b.toDouble(),0);else throw new ArcError("Can't make complex number from "+b);};Complex.prototype.isSame=function(b){return b instanceof Complex?b.real_===this.real_&&b.imaginary_===this.imaginary_:b instanceof ArcNumber&&this.imaginary_===0&&b.toDouble()===this.real_};Complex.ZERO=new Complex(0,0);
function Rational(b,c){ArcNumber.call(this);if(c===0&&b!==0)throw new ArcError("/: division by zero");var d=this.gcd_(b,c);this.numerator_=b/d;this.denominator_=c/d}Rational.prototype=new ArcNumber;Rational.prototype.className="Rational";Rational.parse=function(b){b=b.split("/");return Rational.make2(parseInt(b[0],10),parseInt(b[1],10))};Rational.parseHex=function(b){b=b.substring(2);return new Rational(parseInt(b,16),1)};Rational.make1=function(b){return new Rational(b,1)};
Rational.make2=function(b,c){return new Rational(b,c)};Rational.prototype.toString=function(){return this.numerator_+(this.denominator_===1?"":"/"+this.denominator_)};Rational.prototype.isInteger=function(){return this.denominator_===1};Rational.prototype.toDouble=function(){return this.numerator_/this.denominator_};Rational.prototype.toInt=function(){if(this.numerator_===0)return 0;else{var b=this.numerator_/this.denominator_;return b<0?Math.ceil(b):Math.floor(b)}};
Rational.prototype.gcd_=function(b,c){return c===0?b:this.gcd_(c,b%c)};Rational.prototype.mod=function(b){if(!this.isInteger()||!b.isInteger())throw new ArcError("modulo: expects integer, got ("+this+" "+b+")");var b=b.toInt(),c=this.numerator_%b;c<0&&(c+=b);return Rational.make1(c)};Rational.prototype.times=function(b){return new Rational(this.numerator_*b.numerator_,this.denominator_*b.denominator_)};
Rational.prototype.plus=function(b){return Rational.make2(this.numerator_*b.denominator_+b.numerator_*this.denominator_,this.denominator_*b.denominator_)};Rational.prototype.negate=function(){return Rational.make2(-this.numerator_,this.denominator_)};Rational.prototype.invert=function(){return new Rational(this.denominator_,this.numerator_)};Rational.prototype.unwrap=function(){return this.isInteger()?this.toInt():this.toDouble()};
Rational.prototype.hashCode=function(){return this.isInteger()?this.toInt():this.toDouble()};Rational.prototype.hashCode=function(){return 37*this.numerator_+this.denominator_+""};Rational.prototype.equals=function(b){return b instanceof Rational&&this.sameValue_(b)};Rational.prototype.sameValue_=function(b){return this.numerator_===b.numerator_&&this.denominator_===b.denominator};
Rational.cast=function(b,c){try{if(!(b instanceof Rational))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected a Rational, got "+b);}};Rational.prototype.round=function(){if(this.denominator_===1)return this;else if(this.denominator_===2){var b=this.numerator_/this.denominator_,b=b<0?Math.ceil(b):Math.floor(b);return Rational.make1(b+(b%2===1?1:0))}else return Rational.make1(Math.round(this.numerator_/this.denominator_))};
Rational.prototype.roundJava=function(){return this.denominator_===1?this:Rational.make1(Math.round(this.numerator_/this.denominator_))};Rational.prototype.stringify=function(b){var c=this.numerator_.toString(b.toInt());return this.isInteger()?ArcString.make(c):(b=this.denominator_.toString(b.toInt()),ArcString.make(c+"/"+b))};Rational.prototype.sqrt=function(){var b=Math.sqrt(this.numerator_/this.denominator_);return Math.floor(b)===b?Rational.make1(b):Real.make(b)};
Rational.prototype.multiply=function(b){if(b instanceof Complex)return b.multiplyByNumber(this);else if(b instanceof Real)return b.multiplyNumber(this);else if(b instanceof Rational)return this.times(b);else throw new ArcError("*: expects a number, got "+b.type()+" "+b);};
Rational.prototype.add=function(b){if(b instanceof Complex)return b.plusRational(this);else if(b instanceof Real)return b.plus(this);else if(b instanceof Rational)return this.plus(b);else throw new ArcError("+: expects a number, got "+b.type()+" "+b);};Rational.ZERO=Rational.make1(0);Rational.ONE=Rational.make1(1);Rational.TEN=Rational.make1(10);function Real(b){ArcNumber.call(this);this.value_=b}Real.prototype=new ArcNumber;Real.prototype.className="Real";
Real.positiveInfinity=function(){return new Real(1/0)};Real.negativeInfinity=function(){return new Real(-1/0)};Real.nan=function(){return new Real(0/0)};Real.parse=function(b){return Real.make(parseFloat(b))};Real.make=function(b){return new Real(b)};Real.prototype.toString=function(){return this.value_===-1/0?"-inf.0":this.value_===1/0?"+inf.0":this.value_!==this.value_?"+nan.0":""+this.value_};Real.prototype.unwrap=function(){this.isInteger();return this.value()};Real.prototype.type=function(){return ArcNumber.NUM_TYPE};
Real.prototype.value=function(){return this.value_};Real.prototype.isInteger=function(){return Math.floor(this.value_)===this.value_};Real.prototype.toDouble=function(){return this.value_};Real.prototype.toInt=function(){return this.value_<0?Math.ceil(this.value_):Math.floor(this.value_)};Real.prototype.negate=function(){return Real.make(-this.value_)};Real.prototype.hashCode=function(){return""+this.value_};
Real.prototype.equals=function(b){return b instanceof Complex?b.isSame(this):this===b||b instanceof Real&&this.value_===b.value_};Real.prototype.round=function(){var b=Math.round(this.value_);return Math.abs(this.value_-b)===0.5&&b%2==1?b<this.value_?Rational.make1(b+1):Rational.make1(b-1):Rational.make1(b)};Real.prototype.roundJava=function(){return Rational.make1(Math.round(this.value_))};Real.prototype.plus=function(b){return Real.make(this.value_+b.toDouble())};Real.prototype.sqrt=function(){return Real.make(Math.sqrt(this.value_))};
Real.prototype.multiplyNumber=function(b){return Real.make(this.value_*b.toDouble())};Real.prototype.multiply=function(b){if(b instanceof Complex)return b.multiplyByNumber(this);else if(b instanceof ArcNumber)return this.multiplyNumber(b);else throw new ArcError("*: expects a number, got "+b.type()+" "+b);};
Real.prototype.add=function(b){if(b instanceof Complex)return b.plusReal(this);else if(b instanceof Rational)return this.plus(b);else if(b instanceof Real)return this.plus(b);else throw new ArcError("+: expects a number, got "+b.type()+" "+b);};function Tagged(b,c){LiteralObject.call(this);this.type_=b;this.rep_=c}Tagged.prototype=new LiteralObject;Tagged.prototype.className="Tagged";
Tagged.prototype.invoke=function(b,c){var d=ArcObject.TYPE_DISPATCHER_TABLE.value();if(!(d instanceof Hash))throw new TypeError;return d.value(this.type_).invoke(b,new Pair(this.rep_,c))};Tagged.prototype.getType=function(){return this.type_};Tagged.prototype.getRep=function(){return this.rep_};Tagged.prototype.compareTo=function(){return 0};Tagged.prototype.type=function(){return this.type_};Tagged.hasTag=function(b,c){return b instanceof Tagged&&b.getType().toString()===c};
Tagged.ifTagged=function(b,c){return Tagged.hasTag(b,c)?b.getRep():null};Tagged.rep=function(b){return b instanceof Tagged?b.rep_:b};Tagged.prototype.toString=function(){return this.stringify_()};Tagged.prototype.defaultToString=function(){return"#<tagged "+this.type_+" "+this.rep_+">"};
Tagged.prototype.stringify_=function(){var b=Tagged.TAGGED_WRITE_FN_;if(!b.bound())return this.defaultToString();b=b.value();if(!(b instanceof Hash))throw new TypeError;b=b.value(this.type_);if(b instanceof Nil)return this.defaultToString();var c=new VM;b.invoke(c,Pair.buildFrom1([rep]));var d;if(!c.threadAsync(function(b,c){if(b)throw b;d=c},!0))throw new ArcError("An asynchronous operation was attempted during a toString().");return""+JavaObject.unwrap(d)};
Tagged.cast=function(b,c){try{if(!(b instanceof Tagged))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected a Tagged, got "+b);}};Tagged.TAGGED_WRITE_FN_=Symbol.mkSym("tagged-writers");function JavaObject(b){LiteralObject.call(this);this.object_=b}JavaObject.prototype=new LiteralObject;JavaObject.prototype.className="JavaObject";JavaObject.prototype.invoke=function(b,c){return JavaObject.invokeMethod_(this.object_,b,c)};
JavaObject.prototype.type=function(){return JavaObject.TYPE};JavaObject.prototype.unwrap=function(){return this.object_};JavaObject.prototype.toString=function(){return""+this.object_};JavaObject.cast=function(b,c){try{if(!(b instanceof JavaObject))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected a java-object, got "+b);}};
JavaObject.invokeMethod_=function(b,c,d){var f=Object(b)[c];if(Object.prototype.toString.call(f)!=="[object Function]")throw new ArcError("Field "+c+" is not a method on "+b);return f.call(b,JavaObject.unwrapList1_(d))};JavaObject.unwrapList1_=function(b){JavaObject.unwrapList2_([],b)};JavaObject.unwrapList2_=function(b,c){b.push(JavaObject.unwrap(c.car()));if(!(c.cdr()instanceof Nil)){var d=c.cdr();if(!(d instanceof Pair))throw new TypeError;JavaObject.unwrapList2_(b,d)}};JavaObject.unwrap=function(b){return b.unwrap()};
JavaObject.prototype.close=function(){throw new ArcError("close: unexpected object: "+this);};function Hash(){LiteralObject.call(this);this.name_=ArcObject.NIL;this.map_={};this.lastEntry_=this.firstEntry_=null;this.naming_=new Hash.DontName;this.len_=0}Hash.prototype=new LiteralObject;Hash.prototype.className="Hash";Hash.prototype.unassigned=function(b){if(this.name_===b)this.name_=ArcObject.NIL,this.naming_=new Hash.DontName};Hash.prototype.assigned=function(b){this.name_=b;this.naming_=new Hash.DoName(this)};
Hash.prototype.assignedName=function(){return this.name_};Hash.prototype.invoke=function(b,c){b.pushA(this.value(c.car()).or(c.cdr().car()))};Hash.prototype.toString=function(){return"#hash"+this.toList()};Hash.prototype.toList=function(){for(var b=[],c=this.firstEntry_;c!==null;c=c.next){var d=c.key,d=new Pair(d,new Pair(this.value(d),ArcObject.NIL));b.push(d)}return Pair.buildFrom2(b,ArcObject.EMPTY_LIST)};Hash.prototype.len=function(){return this.size()};
Hash.prototype.sref=function(b,c){if(b instanceof Nil){var d=this.value(c);this.unref(c);this.naming_.unname(d,c)}else{for(var d=c.hashCode(),d=this.map_[d]||(this.map_[d]=[]),f=null,g=0,h=d.length;g<h;g++){var i=d[g];if(c.equals(i.key)){f=i;break}}f===null?(f=this.lastEntry_,this.lastEntry_={key:c,value:b,prev:f,next:null},f===null?this.firstEntry_=this.lastEntry_:f.next=this.lastEntry_,d.push(this.lastEntry_),this.len_++):f.value=b;this.naming_.name(b,c)}return b};
Hash.prototype.unref=function(b){var c=this.map_[b.hashCode()];if(c)for(var d=0,f=c.length;d<f;d++){var g=c[d];if(b.equals(g.key)){c.splice(d,1);if(g.prev)g.prev.next=g.next;if(g.next)g.next.prev=g.prev;if(this.firstEntry_===g)this.firstEntry_=g.next;if(this.lastEntry_===g)this.lastEntry_=g.prev;this.len--;break}}};Hash.prototype.value=function(b){var c=this.map_[b.hashCode()];if(!c)return ArcObject.NIL;for(var d=0,f=c.length;d<f;d++){var g=c[d];if(b.equals(g.key))return g.value}return ArcObject.NIL};
Hash.prototype.compareTo=function(){return 0};Hash.prototype.type=function(){return Hash.TYPE};Hash.prototype.size=function(){return this.len_};Hash.cast=function(b,c){try{if(!(b instanceof Hash))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected a hash, got "+b+", a "+b.type());}};Hash.Naming=function(){};Hash.Naming.prototype.name=void 0;Hash.Naming.prototype.unname=void 0;
Hash.DoName=function(b){Hash.Naming.call(this);this.this_Hash_=b};Hash.DoName.prototype=new Hash.Naming;Hash.DoName.prototype.name=function(b,c){b.assigned(new Pair(c,this.this_Hash_))};Hash.DoName.prototype.unname=function(b,c){b.unassigned(new Pair(c,this.this_Hash_))};Hash.DontName=function(){Hash.Naming.call(this)};Hash.DontName.prototype=new Hash.Naming;Hash.DontName.prototype.name=function(){};Hash.DontName.prototype.unname=function(){};Hash.TYPE=Symbol.mkSym("table");
function VM(){ArcObject.call(this);this.threadId=VM.threadCount_++;this.args=Array(100);this.ap=-1;this.params=[];this.lcs=Array(100);this.ins=Array(100);this.ip=-1;this.error_=this.currentParams=this.currentLc=null;this.interceptor_=VMInterceptor.NULL;this.dead_=!1;this.ipThreshold=0;this.profileData=null;this.debug_target_frame=0;this.operating_=null}VM.prototype=new ArcObject;VM.prototype.className="VM";
VM.prototype.threadAsync=function(b,c){var d=this.ipThreshold;this.ipThreshold=this.ip;var f=this,g=this.loopAsync_(function(){f.ipThreshold=d;if(f.error_===null)f.interceptor_.end(f),b(null,f.popA());else{var c=f.error_;f.error_=null;var g=c.getStackTrace(),j="\nAt instruction "+c.getOperating();if(g!==null)for(var l=0,k=g.length;l<k;l++)j+="\n"+g[l].profileName();b(new ArcError("Unhandled exception on thread#"+f.threadId+": "+c.getOriginal().message+j,c.getOriginal()))}},c);if(c&&!g)this.ipThreshold=
d;return g};
VM.prototype.loopAsync_=function(b,c){function d(){for(;f.ipThreshold<=f.ip;)try{if(f.ins[f.ip]instanceof Nil)f.ip--;else{f.currentLc=f.lcs[f.ip];f.currentParams=f.params[f.ip];var h=f.ins[f.ip].car();if(!(h instanceof Instruction))throw new TypeError;f.operating_=h;var i=f.ins[f.ip].cdr();if(!(i instanceof Pair))throw new TypeError;f.ins[f.ip]=i;if(f.operating_.implementsAsync){var j=!0,j=f.operating_.operateAsync(f,function(b){b?f.handleError_(b):f.interceptor_.check(f);j||d()},c);if(!j){g=!1;return}}else f.operating_.operate(f),
f.interceptor_.check(f)}}catch(l){f.handleError_(l)}b()}this.interceptor_.check(this);var f=this,g=!0;d();return g};VM.prototype.loadCurrentContext=function(){this.currentLc=this.peekL();this.currentParams=this.params[this.ip]};VM.prototype.hasInstructions=function(){return this.ipThreshold<=this.ip};VM.prototype.lastCommonAncestor=function(b){for(var c=0;c<this.ip;c++)if(this.ins[c]!==b.ins[c])return c-1;return this.ip};
VM.prototype.gatherFinallies=function(b){for(var c=[],d=[];b<this.ip;)this.peekI().car().implementsFinally&&(c.push(this.peekI()),d.push(this.peekL())),this.popFrame();return[c,d]};
VM.prototype.handleError_=function(b){for(var c=[],d=[],f=[];this.ipThreshold<=this.ip;){var g=this.peekI().car();if(g.implementsOnError&&g.catches(b))break;g=this.peekI().car();g.implementsFinally&&(d.push(this.peekI()),f.push(this.peekL()));g instanceof Instruction&&(g=this.peekI().car().owner(),g!==null&&c.push(g));this.popFrame()}this.error_=new ArcException(b,this.operating_,c);for(b=d.length-1;0<=b;b--)this.pushInvocation2(f[b],d[b])};
VM.prototype.die=function(){this.dead_=!0;for(var b=[],c=[];0<=this.ip;)this.peekI().car().implementsFinally&&(b.push(this.peekI()),c.push(this.peekL())),this.popFrame();for(var d=b.length-1;0<=d;d--)this.pushInvocation2(c[d],b[d])};VM.prototype.error=function(){return this.error_};
VM.prototype.show=function(){System_out_println("Thread Dump for thread#"+threadId);System_out_println(""+(this.ap+1)+" args");this.showArgs_();System_out_println();var b=this.ip+1;if(this.ins[this.ip]instanceof Nil)b=this.ip;System_out_println(""+b+" instruction frames");this.showInstructions_()};VM.prototype.popFrame=function(){this.ip--};
VM.prototype.pushFrame=function(b){this.ipThreshold<=this.ip&&this.peekI()instanceof Nil||(this.ip++,0<=this.ip&&this.ip<this.ins.length||(this.newInstructionArray_(this.ins.length*2),this.newClosureArray_(this.lcs.length*2),this.newParamsArray_(this.params.length*2)));this.ins[this.ip]=new Pair(b,ArcObject.NIL)};
VM.prototype.pushInvocation2=function(b,c){this.ipThreshold<=this.ip&&this.peekI()instanceof Nil||(this.ip++,0<=this.ip&&this.ip<this.ins.length||(this.newInstructionArray_(this.ins.length*2),this.newClosureArray_(this.lcs.length*2),this.newParamsArray_(this.params.length*2)));this.ins[this.ip]=c;this.lcs[this.ip]=b};
VM.prototype.pushInvocation3=function(b,c,d){this.ipThreshold<=this.ip&&this.peekI()instanceof Nil||(this.ip++,0<=this.ip&&this.ip<this.ins.length||(this.newInstructionArray_(this.ins.length*2),this.newClosureArray_(this.lcs.length*2),this.newParamsArray_(this.params.length*2)));this.ins[this.ip]=c;this.lcs[this.ip]=b;this.params[this.ip]=d};
VM.prototype.pushConditional=function(b){this.ipThreshold<=this.ip&&this.peekI()instanceof Nil?this.ins[this.ip]=b:(this.ip++,0<=this.ip&&this.ip<this.ins.length||(this.newInstructionArray_(this.ins.length*2),this.newClosureArray_(this.lcs.length*2),this.newParamsArray_(this.params.length*2)),this.ins[this.ip]=b,this.lcs[this.ip]=this.currentLc,this.params[this.ip]=this.currentParams)};VM.prototype.peekI=function(){return this.ins[this.ip]};VM.prototype.peekL=function(){return this.lcs[this.ip]};
VM.prototype.param=function(b){return this.currentParams[b]};VM.prototype.pushParam=function(b){this.ap++;0<=this.ap&&this.ap<this.args.length||this.newArgArray_(this.args.length*2);this.args[this.ap]=this.currentParams[b]};VM.prototype.pushA=function(b){this.ap++;0<=this.ap&&this.ap<this.args.length||this.newArgArray_(this.args.length*2);this.args[this.ap]=b};VM.prototype.peekA=function(){return this.args[this.ap]};VM.prototype.popA=function(){return this.args[this.ap--]};
VM.prototype.popArgs=function(b){for(var c=ArcObject.EMPTY_LIST,d=0;d<b;d++)c=new Pair(this.args[this.ap-d],c);this.ap-=b;return c};VM.prototype.showArgs_=function(){for(var b=5<this.ap?this.ap-5:0;b<this.ap+1;b++)System_out_println(""+b+". "+this.args[b])};VM.prototype.showInstructions_=function(){for(var b=20<this.ip?this.ip-20:0,c=this.ip;b<=c;c--)this.ins[c]instanceof Nil||this.showFrame_(c)};
VM.prototype.showFrame_=function(b){var c=this.ins[b],d=this.lcs[b],f=this.params[b];for(System_out_print("\nInstruction Frame "+b+":");!(c instanceof Nil);){b=c.car();if(!(b instanceof Instruction))throw new TypeError;c=c.cdr();if(!(newInstructions instanceof Pair))throw new TypeError;System_out_print(b.toStringWithLc(d));System_out_print(" ")}System_out_print("[");b=0;for(c=f.length;b<c;b++)System_out_print(""+f[b]+" ");System_out_print("]");System_out_println0()};VM.prototype.lc=function(){return this.currentLc};
VM.prototype.clearError=function(){this.error_=null};VM.prototype.getAp=function(){return this.ap};VM.prototype.setAp=function(b){this.ap=b};VM.prototype.setInterceptor=function(b){this.interceptor_=b;b.install(this)};VM.prototype.type=function(){return VM.TYPE};VM.prototype.copy=function(){var b=new VM;this.copyTo(b);return b};
VM.prototype.copyTo=function(b){b.ap=this.ap;b.ip=this.ip;b.ins.length<this.ins.length?(b.ins=this.ins.slice(),b.lcs=this.lcs.slice(),b.params=this.params.slice()):(this.copyArray_(this.ins,b.ins),this.copyArray_(this.lcs,b.lcs),this.copyArray_(this.params,b.params));b.args.length!==this.args.length?b.args=this.args.slice():this.copyArray_(this.args,b.args);b.currentLc=this.currentLc;b.error_=this.error_;b.interceptor_=this.interceptor_;b.dead_=this.dead_;b.ipThreshold=this.ipThreshold};
VM.prototype.dead=function(){return this.dead_};VM.prototype.toString=function(){return"[thread#"+this.threadId+": instruction stack "+this.ip+"; arg stack "+this.ap+"]"};VM.prototype.newArgArray_=function(b){b=Array(~~b);this.copyArray_(this.args,b);this.args=b};VM.prototype.newClosureArray_=function(b){b=Array(~~b);this.copyArray_(this.lcs,b);this.lcs=b};VM.prototype.newInstructionArray_=function(b){b=Array(~~b);this.copyArray_(this.ins,b);this.ins=b};
VM.prototype.newParamsArray_=function(b){b=Array(~~b);this.copyArray_(this.params,b);this.params=b};VM.prototype.copyArray_=function(b,c){for(var d=0,f=b.length;d<f;d++)c[d]=b[d]};VM.prototype.nextInstruction=function(){if(!this.hasInstructions())return null;return this.ins[this.ip]instanceof Nil?(this.ip--,this.nextInstruction()):this.ins[this.ip].car()};VM.TYPE=Symbol.mkSym("thread");VM.threadCount_=0;function ListBuilder(){ArcObject.call(this);this.list_=[];this.last_=ArcObject.NIL}
ListBuilder.prototype=new ArcObject;ListBuilder.prototype.className="ListBuilder";ListBuilder.prototype.append=function(b){this.list_.push(b)};ListBuilder.prototype.appendAll=function(b){b.copyTo(this.list_)};ListBuilder.prototype.last=function(b){this.last_=b};ListBuilder.prototype.list=function(){return Pair.buildFrom2(this.list_,this.last_)};ListBuilder.prototype.type=function(){return Symbol.mkSym("list-builder")};ListBuilder.prototype.toString=function(){return"ListBuilder:"+this.list().toString()};
function Append(){Instruction.call(this)}Append.prototype=new Instruction;Append.prototype.className="Append";Append.prototype.operate=function(b){var c=b.popA(),b=b.peekA();if(!(b instanceof ListBuilder))throw new TypeError;b.append(c)};Append.prototype.toString=function(){return"(append)"};function AppendAll(){Instruction.call(this)}AppendAll.prototype=new Instruction;AppendAll.prototype.className="AppendAll";
AppendAll.prototype.operate=function(b){var c=b.popA(),b=b.peekA();if(!(b instanceof ListBuilder))throw new TypeError;if(!(c instanceof Pair))throw new TypeError;b.appendAll(c)};AppendAll.prototype.toString=function(){return"(append-all)"};function AppendDot(){Instruction.call(this)}AppendDot.prototype=new Instruction;AppendDot.prototype.className="AppendDot";AppendDot.prototype.operate=function(b){var c=b.popA(),b=b.peekA();if(!(b instanceof ListBuilder))throw new TypeError;b.last(c)};
AppendDot.prototype.toString=function(){return"(append-dot)"};function Catch(b,c){Instruction.call(this);this.onerr_=b;this.ap_=c}Catch.prototype=new Instruction;Catch.prototype.implementsOnError=!0;Catch.prototype.className="Catch";Catch.prototype.catches=function(){return!0};Catch.prototype.operate=function(b){var c=b.error();c!==null&&(b.clearError(),b.setAp(this.ap_),this.onerr_.invoke(b,Pair.buildFrom1([c])))};Catch.prototype.toString=function(){return"(catch "+this.onerr_+")"};
function Close_Instruction(b){Instruction.call(this);this.ifn_=b}Close_Instruction.prototype=new Instruction;Close_Instruction.prototype.className="Close_Instruction";Close_Instruction.prototype.operate=function(b){b.pushA(new Closure(this.ifn_,b.lc()))};Close_Instruction.prototype.toString=function(){return"(close "+this.ifn_+")"};function FinallyInvoke(b){Instruction.call(this);this.after_=b}FinallyInvoke.prototype=new Instruction;FinallyInvoke.prototype.implementsFinally=!0;
FinallyInvoke.prototype.className="FinallyInvoke";FinallyInvoke.prototype.operate=function(b){this.after_.invoke(b,ArcObject.NIL)};FinallyInvoke.prototype.toString=function(){return"(finally:"+this.after_+")"};function FinishList(){Instruction.call(this)}FinishList.prototype=new Instruction;FinishList.prototype.className="FinishList";FinishList.prototype.operate=function(b){var c=b.popA();if(!(c instanceof ListBuilder))throw new TypeError;b.pushA(c.list())};FinishList.prototype.toString=function(){return"(finish-list)"};
function FreeSym(b){Instruction.call(this);this.sym_=b}FreeSym.prototype=new Instruction;FreeSym.prototype.className="FreeSym";FreeSym.prototype.operate=function(b){b.pushA(this.sym_.value())};FreeSym.prototype.toString=function(){return"(free-sym "+this.sym_+")"};FreeSym.prototype.toStringWithLc=function(){return"(free-sym "+this.sym_+" -> "+this.symValue(sym)+")"};function LexSym(b){Instruction.call(this);this.sym_=b}LexSym.prototype=new Instruction;LexSym.prototype.className="LexSym";
LexSym.prototype.operate=function(b){b.pushA(this.sym_.interpret(b.lc()))};LexSym.prototype.toString=function(){return"(lex-sym "+this.sym_+")"};LexSym.prototype.toStringWithLc=function(b){return"(lex-sym "+this.sym_+" -> "+this.sym_.interpret(b)+")"};function Listify(b){Instruction.call(this);this.size_=b}Listify.prototype=new Instruction;Listify.prototype.className="Listify";Listify.prototype.operate=function(b){b.pushA(b.popArgs(this.size_))};
Listify.prototype.toString=function(){return"(listify "+this.size_+")"};function Literal(b){Instruction.call(this);this.arg_=b}Literal.prototype=new Instruction;Literal.prototype.className="Literal";Literal.prototype.operate=function(b){b.pushA(this.arg_)};Literal.prototype.toString=function(){return"(literal "+this.arg_+")"};function NewList(){Instruction.call(this)}NewList.prototype=new Instruction;NewList.prototype.className="NewList";NewList.prototype.operate=function(b){b.pushA(new ListBuilder)};
NewList.prototype.toString=function(){return"(new-list)"};function PopArg(b){Instruction.call(this);this.name_=b}PopArg.prototype=new Instruction;PopArg.prototype.className="PopArg";PopArg.prototype.operate=function(b){b.popA()};PopArg.prototype.toString=function(){return"(pop-arg:"+this.name_+")"};function SetThreadLocal(b,c){Instruction.call(this);this.tl_=b;this.value_=c}SetThreadLocal.prototype=new Instruction;SetThreadLocal.prototype.implementsFinally=!0;SetThreadLocal.prototype.className="SetThreadLocal";
SetThreadLocal.prototype.operate=function(){this.tl_.value=this.value_};function StackSym(b,c){Instruction.call(this);this.sym_=b;this.index_=c}StackSym.prototype=new Instruction;StackSym.prototype.className="StackSym";StackSym.prototype.operate=function(b){b.pushParam(this.index_)};StackSym.prototype.toString=function(){return"(stack-bound symbol:"+this.sym_+")"};function TableMapper(b){Instruction.call(this);this.fn_=b}TableMapper.prototype=new Instruction;TableMapper.prototype.className="TableMapper";
TableMapper.prototype.operate=function(b){var c=b.popA();if(!(c instanceof Pair))throw new TypeError;if(!(c instanceof Nil)){b.pushA(c.cdr());b.pushFrame(this);c=c.car();if(!(c instanceof Pair))throw new TypeError;var d=new PopArg("map-table-iterator");d.belongsTo(this);b.pushFrame(d);this.fn_.invoke(b,c)}};TableMapper.prototype.toString=function(){return"(table-mapper "+this.fn_+")"};function Assign_Lex(b){Instruction.call(this);this.name=b}Assign_Lex.prototype=new Instruction;
Assign_Lex.prototype.className="Assign_Lex";Assign_Lex.addInstructions=function(b,c,d,f){d instanceof BoundSymbol?Assign_Lex_Lex.addInstructions(b,c,d,f):d instanceof StackSymbol?Assign_Lex_Stack.addInstructions(b,c,d,f):d instanceof Symbol?Assign_Lex_Free.addInstructions(b,c,d,f):d.literal()?Assign_Lex_Literal.addInstructions(b,c,d,f):d instanceof Quotation?Assign_Lex_Literal.addInstructions(b,c,d.quoted(),f):Assign_Lex_Other.addInstructions(b,c,d,f)};
function Assign_Lex_Free(b,c){Assign_Lex.call(this,b);this.value=c}Assign_Lex_Free.prototype=new Assign_Lex;Assign_Lex_Free.prototype.className="Assign_Lex_Free";Assign_Lex_Free.prototype.operate=function(b){var c=this.value.value();this.name.setSymbolValue(b.lc(),c);b.pushA(c)};Assign_Lex_Free.addInstructions=function(b,c,d,f){f?b.push(new Assign_Lex_Free(c,d)):b.push(new Assign_Lex_Free.Intermediate(c,d))};
Assign_Lex_Free.prototype.toString=function(){return"(assign-lex "+this.name+" "+this.value+")"};Assign_Lex_Free.Intermediate=function(b,c){Assign_Lex_Free.call(this,b,c)};Assign_Lex_Free.Intermediate.prototype=new Assign_Lex_Free;Assign_Lex_Free.Intermediate.prototype.className="Assign_Lex_Free.Intermediate";Assign_Lex_Free.Intermediate.prototype.operate=function(b){this.name.setSymbolValue(b.lc(),this.value.value())};function Assign_Lex_Lex(b,c){Assign_Lex.call(this,b);this.value=c}
Assign_Lex_Lex.prototype=new Assign_Lex;Assign_Lex_Lex.prototype.className="Assign_Lex_Lex";Assign_Lex_Lex.prototype.operate=function(b){var c=this.value.interpret(b.lc());this.name.setSymbolValue(b.lc(),c);b.pushA(c)};Assign_Lex_Lex.addInstructions=function(b,c,d,f){f?b.push(new Assign_Lex_Lex(c,d)):b.push(new Assign_Lex_Lex.Intermediate(c,d))};Assign_Lex_Lex.prototype.toString=function(){return"(assign-lex "+this.name+" "+this.value+")"};
Assign_Lex_Lex.prototype.toStringWithLc=function(b){return"(assign-lex "+this.name+"--\>"+this.name.interpret(b)+this.value+"--\>"+this.value.interpret(b)+")"};Assign_Lex_Lex.Intermediate=function(b,c){Assign_Lex_Lex.call(this,b,c)};Assign_Lex_Lex.Intermediate.prototype=new Assign_Lex_Lex;Assign_Lex_Lex.Intermediate.prototype.className="Assign_Lex_Lex.Intermediate";Assign_Lex_Lex.Intermediate.prototype.operate=function(b){this.name.setSymbolValue(b.lc(),this.value.interpret(b.lc()))};
function Assign_Lex_Literal(b,c){Assign_Lex.call(this,b);this.expr=c}Assign_Lex_Literal.prototype=new Assign_Lex;Assign_Lex_Literal.prototype.className="Assign_Lex_Literal";Assign_Lex_Literal.prototype.operate=function(b){this.name.setSymbolValue(b.lc(),this.expr);b.pushA(this.expr)};Assign_Lex_Literal.addInstructions=function(b,c,d,f){f?b.push(new Assign_Lex_Literal(c,d)):b.push(new Assign_Lex_Literal.Intermediate(c,d))};
Assign_Lex_Literal.prototype.toString=function(){return"(assign-lex "+this.name+" "+this.expr+")"};Assign_Lex_Literal.Intermediate=function(b,c){Assign_Lex_Literal.call(this,b,c)};Assign_Lex_Literal.Intermediate.prototype=new Assign_Lex_Literal;Assign_Lex_Literal.Intermediate.prototype.className="Assign_Lex_Literal.Intermediate";Assign_Lex_Literal.Intermediate.prototype.operate=function(b){this.name.setSymbolValue(b.lc(),this.expr)};function Assign_Lex_Other(b){Assign_Lex.call(this,b)}
Assign_Lex_Other.prototype=new Assign_Lex;Assign_Lex_Other.prototype.className="Assign_Lex_Other";Assign_Lex_Other.prototype.operate=function(b){this.name.setSymbolValue(b.lc(),b.peekA())};Assign_Lex_Other.prototype.toString=function(){return"(assign-lex "+this.name+")"};Assign_Lex_Other.prototype.toStringWithLc=function(b){return"(assign-lex "+this.name+" -> "+this.name.interpret(b)+")"};Assign_Lex_Other.addInstructions=function(b,c,d,f){d.addInstructions(b);f?b.push(new Assign_Lex_Other(c)):b.push(new Assign_Lex_Other.Intermediate(c))};
Assign_Lex_Other.Intermediate=function(b){Assign_Lex_Other.call(this,b)};Assign_Lex_Other.Intermediate.prototype=new Assign_Lex_Other;Assign_Lex_Other.Intermediate.prototype.className="Assign_Lex_Other.Intermediate";Assign_Lex_Other.Intermediate.prototype.operate=function(b){this.name.setSymbolValue(b.lc(),b.popA())};function Assign_Lex_Stack(b,c){Assign_Lex.call(this,b);this.value=c}Assign_Lex_Stack.prototype=new Assign_Lex;Assign_Lex_Stack.prototype.className="Assign_Lex_Stack";
Assign_Lex_Stack.prototype.operate=function(b){var c=this.value.get(b);this.name.setSymbolValue(b.lc(),c);b.pushA(c)};Assign_Lex_Stack.addInstructions=function(b,c,d,f){f?b.push(new Assign_Lex_Stack(c,d)):b.push(new Assign_Lex_Stack.Intermediate(c,d))};Assign_Lex_Stack.prototype.toString=function(){return"(assign-lex "+this.name+" "+this.value+")"};Assign_Lex_Stack.prototype.toStringWithLc=function(b){return"(assign-lex "+this.name+"--\>"+this.name.interpret(b)+" <-- "+this.value+")"};
Assign_Lex_Stack.Intermediate=function(b,c){Assign_Lex_Stack.call(this,b,c)};Assign_Lex_Stack.Intermediate.prototype=new Assign_Lex_Stack;Assign_Lex_Stack.Intermediate.prototype.className="Assign_Lex_Stack.Intermediate";Assign_Lex_Stack.Intermediate.prototype.operate=function(b){this.name.setSymbolValue(b.lc(),this.value.get(b))};function Assign_Free(b){Instruction.call(this);this.name=b}Assign_Free.prototype=new Instruction;Assign_Free.prototype.className="Assign_Free";
Assign_Free.addInstructions=function(b,c,d,f){d instanceof BoundSymbol?Assign_Free_Lex.addInstructions(b,c,d,f):d instanceof StackSymbol?Assign_Free_Stack.addInstructions(b,c,d,f):d instanceof Symbol?Assign_Free_Free.addInstructions(b,c,d,f):d.literal()?Assign_Free_Literal.addInstructions(b,c,d,f):d instanceof Quotation?Assign_Free_Literal.addInstructions(b,c,d.quoted(),f):Assign_Free_Other.addInstructions(b,c,d,f)};function Assign_Free_Free(b,c){Assign_Free.call(this,b);this.value=c}
Assign_Free_Free.prototype=new Assign_Free;Assign_Free_Free.prototype.className="Assign_Free_Free";Assign_Free_Free.prototype.operate=function(b){var c=this.value.value();this.name.setValue(c);b.pushA(c)};Assign_Free_Free.addInstructions=function(b,c,d,f){f?b.push(new Assign_Free_Free(c,d)):b.push(new Assign_Free_Free.Intermediate(c,d))};Assign_Free_Free.prototype.toString=function(){return"(assign-free-free "+this.name+" "+this.value+")"};
Assign_Free_Free.Intermediate=function(b,c){Assign_Free_Free.call(this,b,c)};Assign_Free_Free.Intermediate.prototype=new Assign_Free_Free;Assign_Free_Free.Intermediate.prototype.className="Assign_Free_Free.Intermediate";Assign_Free_Free.Intermediate.prototype.operate=function(){this.name.setValue(this.value.value())};function Assign_Free_Lex(b,c){Assign_Free.call(this,b);this.value=c}Assign_Free_Lex.prototype=new Assign_Free;Assign_Free_Lex.prototype.className="Assign_Free_Lex";
Assign_Free_Lex.prototype.operate=function(b){var c=this.value.interpret(b.lc());this.name.setValue(c);b.pushA(c)};Assign_Free_Lex.addInstructions=function(b,c,d,f){f?b.push(new Assign_Free_Lex(c,d)):b.push(new Assign_Free_Lex.Intermediate(c,d))};Assign_Free_Lex.prototype.toString=function(){return"(assign-free-lex "+this.name+" "+this.value+")"};Assign_Free_Lex.Intermediate=function(b,c){Assign_Free_Lex.call(this,b,c)};Assign_Free_Lex.Intermediate.prototype=new Assign_Free_Lex;
Assign_Free_Lex.Intermediate.prototype.className="Assign_Free_Lex.Intermediate";Assign_Free_Lex.Intermediate.prototype.operate=function(b){this.name.setValue(this.value.interpret(b.lc()))};function Assign_Free_Literal(b,c){Assign_Free.call(this,b);this.expr=c}Assign_Free_Literal.prototype=new Assign_Free;Assign_Free_Literal.prototype.className="Assign_Free_Literal";Assign_Free_Literal.prototype.operate=function(b){this.name.setValue(this.expr);b.pushA(this.expr)};
Assign_Free_Literal.addInstructions=function(b,c,d,f){f?b.push(new Assign_Free_Literal(c,d)):b.push(new Assign_Free_Literal.Intermediate(c,d))};Assign_Free_Literal.prototype.toString=function(){return"(assign-free-literal "+this.name+" "+this.expr+")"};Assign_Free_Literal.Intermediate=function(b,c){Assign_Free_Literal.call(this,b,c)};Assign_Free_Literal.Intermediate.prototype=new Assign_Free_Literal;Assign_Free_Literal.Intermediate.prototype.className="Assign_Free_Literal.Intermediate";
Assign_Free_Literal.Intermediate.prototype.operate=function(){this.name.setValue(this.expr)};function Assign_Free_Other(b){Assign_Free.call(this,b)}Assign_Free_Other.prototype=new Assign_Free;Assign_Free_Other.prototype.className="Assign_Free_Other";Assign_Free_Other.prototype.operate=function(b){this.name.setValue(b.peekA())};Assign_Free_Other.prototype.toString=function(){return"(assign-free-other "+this.name+")"};
Assign_Free_Other.prototype.toStringWithLc=function(){return"(assign-free-other "+this.name+" -> "+this.symValue(name)+")"};Assign_Free_Other.addInstructions=function(b,c,d,f){d.addInstructions(b);f?b.push(new Assign_Free_Other(c)):b.push(new Assign_Free_Other.Intermediate(c))};Assign_Free_Other.Intermediate=function(b){Assign_Free_Other.call(this,b)};Assign_Free_Other.Intermediate.prototype=new Assign_Free_Other;Assign_Free_Other.Intermediate.prototype.className="Assign_Free_Other.Intermediate";
Assign_Free_Other.Intermediate.prototype.operate=function(b){this.name.setValue(b.popA())};function Assign_Free_Stack(b,c){Assign_Free.call(this,b);this.value=c}Assign_Free_Stack.prototype=new Assign_Free;Assign_Free_Stack.prototype.className="Assign_Free_Stack";Assign_Free_Stack.prototype.operate=function(b){v=this.value.get(b);this.name.setValue(v);b.pushA(v)};Assign_Free_Stack.addInstructions=function(b,c,d,f){f?b.push(new Assign_Free_Stack(c,d)):b.push(new Assign_Free_Stack.Intermediate(c,d))};
Assign_Free_Stack.prototype.toString=function(){return"(assign-free-stack "+this.name+" "+this.value+")"};Assign_Free_Stack.Intermediate=function(b,c){Assign_Free_Stack.call(this,b,c)};Assign_Free_Stack.Intermediate.prototype=new Assign_Free_Stack;Assign_Free_Stack.Intermediate.prototype.className="Assign_Free_Stack.Intermediate";Assign_Free_Stack.Intermediate.prototype.operate=function(b){this.name.setValue(this.value.get(b))};function Assign_Stack(b){Instruction.call(this);this.name=b}
Assign_Stack.prototype=new Instruction;Assign_Stack.prototype.className="Assign_Stack";
Assign_Stack.addInstructions=function(b,c,d,f){d instanceof BoundSymbol?Assign_Stack_Lex.addInstructions(b,c,d,f):d instanceof StackSymbol?Assign_Stack_Stack.addInstructions(b,c,d,f):d instanceof Symbol?Assign_Stack_Free.addInstructions(b,c,d,f):d.literal()?Assign_Stack_Literal.addInstructions(b,c,d,f):d instanceof Quotation?Assign_Stack_Literal.addInstructions(b,c,d.quoted(),f):Assign_Stack_Other.addInstructions(b,c,d,f)};function Assign_Stack_Free(b,c){Assign_Stack.call(this,b);this.value=c}
Assign_Stack_Free.prototype=new Assign_Stack;Assign_Stack_Free.prototype.className="Assign_Stack_Free";Assign_Stack_Free.prototype.operate=function(b){var c=this.value.value();this.name.set(b,c);b.pushA(c)};Assign_Stack_Free.addInstructions=function(b,c,d,f){f?b.push(new Assign_Stack_Free(c,d)):b.push(new Assign_Stack_Free.Intermediate(c,d))};Assign_Stack_Free.prototype.toString=function(){return"(assign-free "+this.name+" "+this.value+")"};
Assign_Stack_Free.Intermediate=function(b,c){Assign_Stack_Free.call(this,b,c)};Assign_Stack_Free.Intermediate.prototype=new Assign_Stack_Free;Assign_Stack_Free.Intermediate.prototype.className="Assign_Stack_Free.Intermediate";Assign_Stack_Free.Intermediate.prototype.operate=function(b){this.name.set(b,this.value.value())};function Assign_Stack_Lex(b,c){Assign_Stack.call(this,b);this.value=c}Assign_Stack_Lex.prototype=new Assign_Stack;Assign_Stack_Lex.prototype.className="Assign_Stack_Lex";
Assign_Stack_Lex.prototype.operate=function(b){var c=this.value.interpret(b.lc());this.name.set(b,c);b.pushA(c)};Assign_Stack_Lex.addInstructions=function(b,c,d,f){f?b.push(new Assign_Stack_Lex(c,d)):b.push(new Assign_Stack_Lex.Intermediate(c,d))};Assign_Stack_Lex.prototype.toString=function(){return"(assign-free "+this.name+" "+this.value+")"};Assign_Stack_Lex.Intermediate=function(b,c){Assign_Stack_Lex.call(this,b,c)};Assign_Stack_Lex.Intermediate.prototype=new Assign_Stack_Lex;
Assign_Stack_Lex.Intermediate.prototype.className="Assign_Stack_Lex.Intermediate";Assign_Stack_Lex.Intermediate.prototype.operate=function(b){this.name.set(b,this.value.interpret(b.lc()))};function Assign_Stack_Literal(b,c){Assign_Stack.call(this,b);this.value=c}Assign_Stack_Literal.prototype=new Assign_Stack;Assign_Stack_Literal.prototype.className="Assign_Stack_Literal";Assign_Stack_Literal.prototype.operate=function(b){this.name.set(b,this.value);b.pushA(this.value)};
Assign_Stack_Literal.addInstructions=function(b,c,d,f){f?b.push(new Assign_Stack_Literal(c,d)):b.push(new Assign_Stack_Literal.Intermediate(c,d))};Assign_Stack_Literal.prototype.toString=function(){return"(assign-free "+this.name+" "+this.value+")"};Assign_Stack_Literal.Intermediate=function(b,c){Assign_Stack_Literal.call(this,b,c)};Assign_Stack_Literal.Intermediate.prototype=new Assign_Stack_Literal;Assign_Stack_Literal.Intermediate.prototype.className="Assign_Stack_Literal.Intermediate";
Assign_Stack_Literal.Intermediate.prototype.operate=function(b){this.name.set(b,this.value)};function Assign_Stack_Other(b){Assign_Stack.call(this,b)}Assign_Stack_Other.prototype=new Assign_Stack;Assign_Stack_Other.prototype.className="Assign_Stack_Other";Assign_Stack_Other.prototype.operate=function(b){this.name.set(b,b.peekA())};Assign_Stack_Other.prototype.toString=function(){return"(assign-stack "+this.name+")"};
Assign_Stack_Other.addInstructions=function(b,c,d,f){d.addInstructions(b);f?b.push(new Assign_Stack_Other(c)):b.push(new Assign_Stack_Other.Intermediate(c))};Assign_Stack_Other.Intermediate=function(b){Assign_Stack_Other.call(this,b)};Assign_Stack_Other.Intermediate.prototype=new Assign_Stack_Other;Assign_Stack_Other.Intermediate.prototype.className="Assign_Stack_Other.Intermediate";Assign_Stack_Other.Intermediate.prototype.operate=function(b){this.name.set(b,b.popA())};
function Assign_Stack_Stack(b,c){Assign_Stack.call(this,b);this.value=c}Assign_Stack_Stack.prototype=new Assign_Stack;Assign_Stack_Stack.prototype.className="Assign_Stack_Stack";Assign_Stack_Stack.prototype.operate=function(b){var c=this.value.get(b);this.name.set(b,c);b.pushA(c)};Assign_Stack_Stack.addInstructions=function(b,c,d,f){f?b.push(new Assign_Stack_Stack(c,d)):b.push(new Assign_Stack_Stack.Intermediate(c,d))};
Assign_Stack_Stack.prototype.toString=function(){return"(assign-free "+this.name+" "+this.value+")"};Assign_Stack_Stack.Intermediate=function(b,c){Assign_Stack_Stack.call(this,b,c)};Assign_Stack_Stack.Intermediate.prototype=new Assign_Stack_Stack;Assign_Stack_Stack.Intermediate.prototype.className="Assign_Stack_Stack.Intermediate";Assign_Stack_Stack.Intermediate.prototype.operate=function(b){this.name.set(b,this.value.get(b))};
function Cond(b,c){Instruction.call(this);this.thenExpr_=b;this.thenInstructions_=Cond.instructionsFor(b);this.elseExpr_=c;this.elseInstructions_=Cond.instructionsFor(c)}Cond.prototype=new Instruction;Cond.prototype.className="Cond";Cond.instructionsFor=function(b){var c=[];b.addInstructions(c);return Pair.buildFrom1(c)};Cond.prototype.operate=function(b){b.pushConditional(b.popA()instanceof Nil?this.elseInstructions_:this.thenInstructions_)};
Cond.prototype.visit=function(b){Instruction.prototype.visit.call(this,b);this.thenInstructions_.visit(b);this.elseInstructions_.visit(b)};Cond.prototype.toString=function(){return"(cond then:"+this.thenExpr_+", else:"+this.elseExpr_+")"};function If_bound_bound_literal(b,c,d){Instruction.call(this);this.ifExpr_=b;this.thenExpr_=c;this.elseExpr_=d}classes["rainbow.vm.instructions.cond.optimise.If_bound_bound_literal"]=If_bound_bound_literal;If_bound_bound_literal.prototype=new Instruction;
If_bound_bound_literal.prototype.className="If_bound_bound_literal";If_bound_bound_literal.prototype.operate=function(b){this.ifExpr_.interpret(b.lc())instanceof Nil?b.pushA(this.elseExpr_):b.pushA(this.thenExpr_.interpret(b.lc()))};
If_bound_bound_literal.addInstructions=function(b,c,d,f){if(!(c instanceof BoundSymbol))throw new TypeError;if(!(d instanceof BoundSymbol))throw new TypeError;if(!(f instanceof Else))throw new TypeError;c.isSameBoundSymbol(d)?f.ifExpression instanceof Nil?c.addInstructions(b):b.push(new If_bound_bound_literal.Or(c,f.ifExpression)):b.push(new If_bound_bound_literal(c,d,f.ifExpression))};
If_bound_bound_literal.prototype.toString=function(){return"(if "+this.ifExpr_+" "+this.thenExpr_+" "+this.elseExpr_+")"};If_bound_bound_literal.Or=function(b,c){Instruction.call(this);this.a_=b;this.elseExpr_=c};If_bound_bound_literal.Or.prototype=new Instruction;If_bound_bound_literal.Or.prototype.className="If_bound_bound_literal.Or";If_bound_bound_literal.Or.prototype.operate=function(b){var c=this.a_.interpret(b.lc());c instanceof Nil?b.pushA(this.elseExpr_):b.pushA(c)};
If_bound_bound_literal.Or.prototype.toString=function(){return"(if[bbl$or] "+a+" "+a+" "+elseExpr+")"};function If_bound_bound_other(b,c,d){Instruction.call(this);this.ifExpr_=b;this.thenExpr_=c;this.elseInstructions_=Cond.instructionsFor(d);this.elseExpr_=d}classes["rainbow.vm.instructions.cond.optimise.If_bound_bound_other"]=If_bound_bound_other;If_bound_bound_other.prototype=new Instruction;If_bound_bound_other.prototype.className="If_bound_bound_other";
If_bound_bound_other.prototype.operate=function(b){this.ifExpr_.interpret(b.lc())instanceof Nil?b.pushConditional(this.elseInstructions_):b.pushA(this.thenExpr_.interpret(b.lc()))};If_bound_bound_other.addInstructions=function(b,c,d,f){if(!(c instanceof BoundSymbol))throw new TypeError;if(!(d instanceof BoundSymbol))throw new TypeError;c.isSameBoundSymbol(d)?b.push(new If_bound_bound_other.Or(c,f)):b.push(new If_bound_bound_other(c,d,f))};
If_bound_bound_other.prototype.visit=function(b){Instruction.prototype.visit.call(this,b);this.elseInstructions_.visit(b)};If_bound_bound_other.prototype.toString=function(){return"(if "+this.ifExpr_+" "+this.thenExpr_+" "+this.elseExpr_+")"};If_bound_bound_other.Or=function(b,c){Instruction.call(this);this.a_=b;this.elseInstructions_=Cond.instructionsFor(c);this.elseExpr_=c};If_bound_bound_other.Or.prototype=new Instruction;If_bound_bound_other.Or.prototype.className="If_bound_bound_other.Or";
If_bound_bound_other.Or.prototype.operate=function(b){var c=this.a_.interpret(b.lc());c instanceof Nil?b.pushConditional(this.elseInstructions_):b.pushA(c)};If_bound_bound_other.Or.prototype.visit=function(b){Instruction.prototype.visit.call(this,b);this.elseInstructions_.visit(b)};If_bound_bound_other.Or.prototype.toString=function(){return"(if "+a+" "+a+" "+elseExpr+")"};function If_bound_literal_literal(b,c,d){Instruction.call(this);this.ifExpr_=b;this.thenExpr_=c;this.elseExpr_=d}
classes["rainbow.vm.instructions.cond.optimise.If_bound_literal_literal"]=If_bound_literal_literal;If_bound_literal_literal.prototype=new Instruction;If_bound_literal_literal.prototype.className="If_bound_literal_literal";If_bound_literal_literal.prototype.operate=function(b){this.ifExpr_.interpret(b.lc())instanceof Nil?b.pushA(this.elseExpr_):b.pushA(this.thenExpr_)};If_bound_literal_literal.prototype.toString=function(){return"(if "+this.ifExpr_+" "+this.thenExpr_+" "+this.elseExpr_+")"};
If_bound_literal_literal.addInstructions=function(b,c,d,f){if(!(f instanceof Else))throw new TypeError;if(!(c instanceof BoundSymbol))throw new TypeError;b.push(new If_bound_literal_literal(c,d,f.ifExpression))};function If_bound_other_literal(b,c,d){Instruction.call(this);this.ifExpr_=b;this.thenExpr_=c;this.thenInstructions_=Cond.instructionsFor(c);this.elseExpr_=d}classes["rainbow.vm.instructions.cond.optimise.If_bound_other_literal"]=If_bound_other_literal;If_bound_other_literal.prototype=new Instruction;
If_bound_other_literal.prototype.className="If_bound_other_literal";If_bound_other_literal.prototype.operate=function(b){this.ifExpr_.interpret(b.lc())instanceof Nil?b.pushA(this.elseExpr_):b.pushConditional(this.thenInstructions_)};If_bound_other_literal.prototype.toString=function(){return"(if "+this.ifExpr_+" "+this.thenExpr_+" "+this.elseExpr_+")"};If_bound_other_literal.prototype.visit=function(b){Instruction.prototype.visit.call(this,b);this.thenInstructions_.visit(b)};
If_bound_other_literal.addInstructions=function(b,c,d,f){if(!(c instanceof BoundSymbol))throw new TypeError;if(!(f instanceof Else))throw new TypeError;b.push(new If_bound_other_literal(c,d,f.ifExpression))};function If_bound_other_other(b,c,d){Instruction.call(this);this.ifExpr_=b;this.thenExpr_=c;this.thenInstructions_=Cond.instructionsFor(c);this.elseExpr_=d;this.elseInstructions_=Cond.instructionsFor(d)}classes["rainbow.vm.instructions.cond.optimise.If_bound_other_other"]=If_bound_other_other;
If_bound_other_other.prototype=new Instruction;If_bound_other_other.prototype.className="If_bound_other_other";If_bound_other_other.prototype.operate=function(b){this.ifExpr_.interpret(b.lc())instanceof Nil?b.pushConditional(this.elseInstructions_):b.pushConditional(this.thenInstructions_)};If_bound_other_other.prototype.toString=function(){return"(if "+this.ifExpr_+" "+this.thenExpr_+" "+this.elseExpr_+")"};
If_bound_other_other.prototype.visit=function(b){Instruction.prototype.visit.call(this,b);this.thenInstructions_.visit(b)};If_bound_other_other.addInstructions=function(b,c,d,f){if(!(c instanceof BoundSymbol))throw new TypeError;b.push(new If_bound_other_other(c,d,f))};function If_other_bound_other(b,c){Instruction.call(this);this.elseInstructions_=Cond.instructionsFor(c);this.thenExpr_=b;this.elseExpr_=c}classes["rainbow.vm.instructions.cond.optimise.If_other_bound_other"]=If_other_bound_other;
If_other_bound_other.prototype=new Instruction;If_other_bound_other.prototype.className="If_other_bound_other";If_other_bound_other.prototype.operate=function(b){b.popA()instanceof Nil?b.pushConditional(this.elseInstructions_):b.pushA(this.thenExpr_.interpret(b.lc()))};If_other_bound_other.prototype.toString=function(){return"(if ? "+this.thenExpr_+" "+this.elseExpr_+")"};If_other_bound_other.prototype.visit=function(b){Instruction.prototype.visit.call(this,b);this.elseInstructions_.visit(b)};
If_other_bound_other.addInstructions=function(b,c,d,f){c.addInstructions(b);if(!(d instanceof BoundSymbol))throw new TypeError;b.push(new If_other_bound_other(d,f))};function If_other_other_literal(b,c){Instruction.call(this);this.thenInstructions_=Cond.instructionsFor(b);this.thenExpr_=b;this.elseExpr_=c}classes["rainbow.vm.instructions.cond.optimise.If_other_other_literal"]=If_other_other_literal;If_other_other_literal.prototype=new Instruction;If_other_other_literal.prototype.className="If_other_other_literal";
If_other_other_literal.prototype.operate=function(b){b.popA()instanceof Nil?b.pushA(this.elseExpr_):b.pushConditional(this.thenInstructions_)};If_other_other_literal.prototype.toString=function(){return"(if ? "+this.thenExpr_+" "+this.elseExpr_+")"};If_other_other_literal.prototype.visit=function(b){Instruction.prototype.visit.call(this,b);this.thenInstructions_.visit(b)};
If_other_other_literal.addInstructions=function(b,c,d,f){if(!(f instanceof Else))throw new TypeError;c.addInstructions(b);b.push(new If_other_other_literal(d,f.ifExpression))};function If_other_stack_literal(b,c){Instruction.call(this);this.thenExpr_=b;this.elseExpr_=c}classes["rainbow.vm.instructions.cond.optimise.If_other_stack_literal"]=If_other_stack_literal;If_other_stack_literal.prototype=new Instruction;If_other_stack_literal.prototype.className="If_other_stack_literal";
If_other_stack_literal.prototype.operate=function(b){b.popA()instanceof Nil?b.pushA(this.elseExpr_):b.pushA(this.thenExpr_.get(b))};If_other_stack_literal.prototype.toString=function(){return"(if ? "+this.thenExpr_+" "+this.elseExpr_+")"};If_other_stack_literal.addInstructions=function(b,c,d,f){if(!(f instanceof Else))throw new TypeError;c.addInstructions(b);if(!(d instanceof StackSymbol))throw new TypeError;b.push(new If_other_stack_literal(d,f.ifExpression))};
function If_other_stack_other(b,c){Instruction.call(this);this.thenExpr_=b;this.elseInstructions_=Cond.instructionsFor(c);this.elseExpr_=c}classes["rainbow.vm.instructions.cond.optimise.If_other_stack_other"]=If_other_stack_other;If_other_stack_other.prototype=new Instruction;If_other_stack_other.prototype.className="If_other_stack_other";If_other_stack_other.prototype.operate=function(b){b.popA()instanceof Nil?b.pushConditional(this.elseInstructions_):b.pushA(this.thenExpr_.get(b))};
If_other_stack_other.prototype.toString=function(){return"(if ? "+this.thenExpr_+" "+this.elseExpr_+")"};If_other_stack_other.prototype.visit=function(b){Instruction.prototype.visit.call(this,b);this.elseInstructions_.visit(b)};If_other_stack_other.addInstructions=function(b,c,d,f){c.addInstructions(b);if(!(d instanceof StackSymbol))throw new TypeError;b.push(new If_other_stack_other(d,f))};function If_stack_literal_free(b,c,d){this.ifExpr_=b;this.thenExpr_=c;this.elseExpr_=d}
classes["rainbow.vm.instructions.cond.optimise.If_stack_literal_free"]=If_stack_literal_free;If_stack_literal_free.prototype=new Instruction;If_stack_literal_free.prototype.className="If_stack_literal_free";If_stack_literal_free.prototype.operate=function(b){this.ifExpr_.get(b)instanceof Nil?b.pushA(this.elseExpr_.value()):b.pushA(this.thenExpr_)};If_stack_literal_free.prototype.toString=function(){return"(if "+this.ifExpr_+" "+this.thenExpr_+" "+this.elseExpr_+")"};
If_stack_literal_free.addInstructions=function(b,c,d,f){if(!(c instanceof StackSymbol))throw new TypeError;if(!(f instanceof Else))throw new TypeError;f=f.ifExpression;if(!(f instanceof Symbol))throw new TypeError;b.push(new If_stack_literal_free(c,d,f))};function If_stack_stack_literal(b,c,d){Instruction.call(this);this.ifExpr_=b;this.thenExpr_=c;this.elseExpr_=d}classes["rainbow.vm.instructions.cond.optimise.If_stack_stack_literal"]=If_stack_stack_literal;If_stack_stack_literal.prototype=new Instruction;
If_stack_stack_literal.prototype.className="If_stack_stack_literal";If_stack_stack_literal.prototype.operate=function(b){this.ifExpr_.get(b)instanceof Nil?b.pushA(this.elseExpr_):b.pushA(this.thenExpr_.get(b))};If_stack_stack_literal.prototype.toString=function(){return"(if "+this.ifExpr_+" "+this.thenExpr_+" "+this.elseExpr_+")"};
If_stack_stack_literal.addInstructions=function(b,c,d,f){if(!(c instanceof StackSymbol))throw new TypeError;if(!(d instanceof StackSymbol))throw new TypeError;if(!(f instanceof Else))throw new TypeError;c.isSameStackSymbol(d)?f.ifExpression instanceof Nil?c.addInstructions(b):b.push(new If_stack_stack_literal.Or(c,f.ifExpression)):b.push(new If_stack_stack_literal(c,d,f.ifExpression))};If_stack_stack_literal.Or=function(b,c){Instruction.call(this);this.a_=b;this.elseExpr_=c};
If_stack_stack_literal.Or.prototype=new Instruction;If_stack_stack_literal.Or.prototype.className="If_stack_stack_literal.Or";If_stack_stack_literal.Or.prototype.operate=function(b){var c=this.a_.get(b);c instanceof Nil?b.pushA(this.elseExpr_):b.pushA(c)};If_stack_stack_literal.Or.prototype.toString=function(){return"(if[ssl$or] "+a+" "+a+" "+elseExpr+")"};var Invoke_0={};
Invoke_0.addInstructions=function(b,c){c instanceof BoundSymbol?b.push(new Invoke_0.Lex(c)):c instanceof Symbol?b.push(new Invoke_0.Free(c)):(c.addInstructions(b),b.push(new Invoke_0.Other))};Invoke_0.Lex=function(b){Instruction.call(this);this.fn=b};Invoke_0.Lex.prototype=new Instruction;Invoke_0.Lex.prototype.implementsInvoke=!0;Invoke_0.Lex.prototype.className="Invoke_0.Lex";Invoke_0.Lex.prototype.operate=function(b){this.fn.interpret(b.lc()).invoke(b,ArcObject.NIL)};
Invoke_0.Lex.prototype.toString=function(){return"(invoke "+this.fn+")"};Invoke_0.Lex.prototype.getInvokee=function(b){return this.fn.interpret(b.lc())};Invoke_0.Free=function(b){Instruction.call(this);this.fn=b};Invoke_0.Free.prototype=new Instruction;Invoke_0.Free.prototype.implementsInvoke=!0;Invoke_0.Free.prototype.className="Invoke_0.Free";Invoke_0.Free.prototype.operate=function(b){this.fn.value().invoke(b,ArcObject.NIL)};
Invoke_0.Free.prototype.toString=function(){return"(invoke "+this.fn+")"};Invoke_0.Free.prototype.getInvokee=function(){return this.fn.value()};Invoke_0.Other=function(){Instruction.call(this)};Invoke_0.Other.prototype=new Instruction;Invoke_0.Other.prototype.implementsInvoke=!0;Invoke_0.Other.prototype.className="Invoke_0.Other";Invoke_0.Other.prototype.operate=function(b){b.popA().invoke(b,ArcObject.NIL)};Invoke_0.Other.prototype.toString=function(){return"(invoke <0>)"};
Invoke_0.Other.prototype.getInvokee=function(b){return b.peekA()};var Invoke_1={};Invoke_1.addInstructions=function(b,c,d){d.addInstructions(b);c instanceof BoundSymbol?b.push(new Invoke_1.Lex(c)):c instanceof Symbol?b.push(new Invoke_1.Free(c)):(c.addInstructions(b),b.push(new Invoke_1.Other))};Invoke_1.Lex=function(b){Instruction.call(this);this.fn=b};Invoke_1.Lex.prototype=new Instruction;Invoke_1.Lex.prototype.implementsInvoke=!0;Invoke_1.Lex.prototype.className="Invoke_1.Lex";
Invoke_1.Lex.prototype.operate=function(b){this.fn.interpret(b.lc()).invoke(b,new Pair(b.popA(),ArcObject.NIL))};Invoke_1.Lex.prototype.toString=function(){return"(invoke "+this.fn+" <1>)"};Invoke_1.Lex.prototype.getInvokee=function(b){return this.fn.interpret(b.lc())};Invoke_1.Free=function(b){Instruction.call(this);this.fn=b};Invoke_1.Free.prototype=new Instruction;Invoke_1.Free.prototype.implementsInvoke=!0;Invoke_1.Free.prototype.className="Invoke_1.Free";
Invoke_1.Free.prototype.operate=function(b){this.fn.value().invoke(b,new Pair(b.popA(),ArcObject.NIL))};Invoke_1.Free.prototype.toString=function(){return"(invoke "+this.fn+" <1>)"};Invoke_1.Free.prototype.getInvokee=function(){return this.fn.value()};Invoke_1.Other=function(){Instruction.call(this)};Invoke_1.Other.prototype=new Instruction;Invoke_1.Other.prototype.implementsInvoke=!0;Invoke_1.Other.prototype.className="Invoke_1.Other";
Invoke_1.Other.prototype.operate=function(b){b.popA().invoke(b,new Pair(b.popA(),ArcObject.NIL))};Invoke_1.Other.prototype.toString=function(){return"(invoke <1>)"};Invoke_1.Other.prototype.getInvokee=function(b){return b.peekA()};var Invoke_2={};Invoke_2.addInstructions=function(b,c,d,f){d.addInstructions(b);f.addInstructions(b);c instanceof BoundSymbol?b.push(new Invoke_2.Lex(c)):c instanceof Symbol?b.push(new Invoke_2.Free(c)):(c.addInstructions(b),b.push(new Invoke_2.Other))};
Invoke_2.Lex=function(b){Instruction.call(this);this.fn=b};Invoke_2.Lex.prototype=new Instruction;Invoke_2.Lex.prototype.implementsInvoke=!0;Invoke_2.Lex.prototype.className="Invoke_2.Lex";Invoke_2.Lex.prototype.operate=function(b){var c=b.popA(),d=b.popA();this.fn.interpret(b.lc()).invoke(b,new Pair(d,new Pair(c,ArcObject.NIL)))};Invoke_2.Lex.prototype.toString=function(){return"(invoke "+this.fn+" <2>)"};
Invoke_2.Lex.prototype.toStringWithLc=function(b){return"(invoke "+this.fn+" -> "+this.fn.interpret(b)+" <2>)"};Invoke_2.Lex.prototype.getInvokee=function(b){return this.fn.interpret(b.lc())};Invoke_2.Free=function(b){Instruction.call(this);this.fn=b};Invoke_2.Free.prototype=new Instruction;Invoke_2.Free.prototype.implementsInvoke=!0;Invoke_2.Free.prototype.className="Invoke_2.Free";
Invoke_2.Free.prototype.operate=function(b){var c=b.popA(),d=b.popA();this.fn.value().invoke(b,new Pair(d,new Pair(c,ArcObject.NIL)))};Invoke_2.Free.prototype.toString=function(){return"(invoke_2:free "+this.fn+" <2>)"};Invoke_2.Free.prototype.toStringWithLc=function(){return"(invoke_2:free "+this.fn+" -> "+this.fn.value()+" <2>)"};Invoke_2.Free.prototype.getInvokee=function(){return this.fn.value()};Invoke_2.Other=function(){Instruction.call(this)};Invoke_2.Other.prototype=new Instruction;
Invoke_2.Other.prototype.implementsInvoke=!0;Invoke_2.Other.prototype.className="Invoke_2.Other";Invoke_2.Other.prototype.operate=function(b){var c=b.popA(),d=b.popA(),f=b.popA();try{c.invoke(b,new Pair(f,new Pair(d,ArcObject.NIL)))}catch(g){if(!(g instanceof Error))throw g;printStackTrace(g)}};Invoke_2.Other.prototype.toString=function(){return"(invoke <2>)"};Invoke_2.Other.prototype.getInvokee=function(b){return b.peekA()};var Invoke_3={};
Invoke_3.addInstructions=function(b,c,d,f,g){d.addInstructions(b);f.addInstructions(b);g.addInstructions(b);c instanceof BoundSymbol?b.push(new Invoke_3.Lex(c)):c instanceof Symbol?b.push(new Invoke_3.Free(c)):(c.addInstructions(b),b.push(new Invoke_3.Other))};Invoke_3.Lex=function(b){Instruction.call(this);this.fn=b};Invoke_3.Lex.prototype=new Instruction;Invoke_3.Lex.prototype.implementsInvoke=!0;Invoke_3.Lex.prototype.className="Invoke_3.Lex";
Invoke_3.Lex.prototype.operate=function(b){var c=b.popA(),d=b.popA(),f=b.popA();this.fn.interpret(b.lc()).invoke(b,new Pair(f,new Pair(d,new Pair(c,ArcObject.NIL))))};Invoke_3.Lex.prototype.toString=function(){return"(invoke "+this.fn+" <3>)"};Invoke_3.Lex.prototype.getInvokee=function(b){return this.fn.interpret(b.lc())};Invoke_3.Free=function(b){Instruction.call(this);this.fn=b};Invoke_3.Free.prototype=new Instruction;Invoke_3.Free.prototype.implementsInvoke=!0;
Invoke_3.Free.prototype.className="Invoke_3.Free";Invoke_3.Free.prototype.operate=function(b){var c=b.popA(),d=b.popA(),f=b.popA();this.fn.value().invoke(b,new Pair(f,new Pair(d,new Pair(c,ArcObject.NIL))))};Invoke_3.Free.prototype.toString=function(){return"(invoke_3:free "+this.fn+" <3>)"};Invoke_3.Free.prototype.getInvokee=function(){return this.fn.value()};Invoke_3.Other=function(){Instruction.call(this)};Invoke_3.Other.prototype=new Instruction;Invoke_3.Other.prototype.implementsInvoke=!0;
Invoke_3.Other.prototype.className="Invoke_3.Other";Invoke_3.Other.prototype.operate=function(b){var c=b.popA(),d=b.popA(),f=b.popA(),g=b.popA();c.invoke(b,new Pair(g,new Pair(f,new Pair(d,ArcObject.NIL))))};Invoke_3.Other.prototype.toString=function(){return"(invoke <3>)"};Invoke_3.Other.prototype.getInvokee=function(b){return b.peekA()};var Invoke_N={};
Invoke_N.addInstructions=function(b,c,d){for(var f=d.len();!(d instanceof Nil);)if(d.car().addInstructions(b),d=d.cdr(),!(d instanceof Pair))throw new TypeError;c instanceof BoundSymbol?b.push(new Invoke_N.Lex(c,f)):c instanceof Symbol?b.push(new Invoke_N.Free(c,f)):(c.addInstructions(b),b.push(new Invoke_N.Other(f)))};Invoke_N.Lex=function(b,c){Instruction.call(this);this.fn=b;this.argCount=c};Invoke_N.Lex.prototype=new Instruction;Invoke_N.Lex.prototype.implementsInvoke=!0;
Invoke_N.Lex.prototype.className="Invoke_N.Lex";Invoke_N.Lex.prototype.operate=function(b){this.fn.interpret(b.lc()).invoke(b,b.popArgs(this.argCount))};Invoke_N.Lex.prototype.toString=function(){return"(invoke "+this.fn+" <"+this.argCount+">)"};Invoke_N.Lex.prototype.getInvokee=function(b){return this.fn.interpret(b.lc())};Invoke_N.Free=function(b,c){Instruction.call(this);this.fn=b;this.argCount=c};Invoke_N.Free.prototype=new Instruction;Invoke_N.Free.prototype.implementsInvoke=!0;
Invoke_N.Free.prototype.className="Invoke_N.Free";Invoke_N.Free.prototype.operate=function(b){this.fn.value().invoke(b,b.popArgs(this.argCount))};Invoke_N.Free.prototype.toString=function(){return"(invoke "+this.fn+" <"+this.argCount+">)"};Invoke_N.Free.prototype.getInvokee=function(){return this.fn.value()};Invoke_N.Other=function(b){Instruction.call(this);this.argCount=b};Invoke_N.Other.prototype=new Instruction;Invoke_N.Other.prototype.implementsInvoke=!0;Invoke_N.Other.prototype.className="Invoke_N.Other";
Invoke_N.Other.prototype.operate=function(b){b.popA().invoke(b,b.popArgs(this.argCount))};Invoke_N.Other.prototype.toString=function(){return"(invoke <"+this.argCount+">)"};Invoke_N.Other.prototype.getInvokee=function(b){return b.peekA()};function StackSymbol(b,c){ArcObject.call(this);this.name=b;this.index_=c}StackSymbol.prototype=new ArcObject;StackSymbol.prototype.className="StackSymbol";StackSymbol.prototype.get=function(b){return b.param(this.index_)};
StackSymbol.prototype.set=function(b,c){b.params[b.ip][this.index_]=c};StackSymbol.prototype.addInstructions=function(b){b.push(new StackSym(this.name,this.index_))};StackSymbol.prototype.type=function(){return Symbol.mkSym("stack-symbol")};StackSymbol.prototype.toString=function(){return this.name.toString()};StackSymbol.prototype.isSameStackSymbol=function(b){return this.name===b.name&&this.index_===b.index_};
StackSymbol.prototype.inline3=function(b,c,d){return this.isSameStackSymbol(b)?c:d<this.index_?new StackSymbol(this.name,this.index-1):this};function BoundSymbol(b,c,d){ArcObject.call(this);this.nesting=c;this.index=d;this.name=b}BoundSymbol.prototype=new ArcObject;BoundSymbol.prototype.className="BoundSymbol";BoundSymbol.make=function(b,c,d){return new BoundSymbol(b,c,d)};BoundSymbol.prototype.setSymbolValue=function(b,c){b.nth(this.nesting).set(this.index,c)};
BoundSymbol.prototype.interpret=function(b){for(var c=this.nesting;0<c;)b=b.parent,c--;return b.at(this.index)};BoundSymbol.prototype.addInstructions=function(b){b.push(new LexSym(this))};BoundSymbol.prototype.type=function(){return BoundSymbol.TYPE};BoundSymbol.prototype.toString=function(){return this.name.toString()};BoundSymbol.prototype.isSameBoundSymbol=function(b){return this.nesting===b.nesting&&this.name===b.name&&this.index===b.index};
BoundSymbol.prototype.nest=function(b){return b<=this.nesting?BoundSymbol.make(this.name,this.nesting+1,this.index):this};BoundSymbol.prototype.unnest=function(){return BoundSymbol.make(this.name,this.nesting-1,this.index)};
BoundSymbol.prototype.inline5=function(b,c,d,f,g){if(this.isSameBoundSymbol(b))return c;else if(d){if(this.nesting===0)throw new ArcError("can't unnest "+this+", looking for "+b+" to inline with "+c);return this.unnest()}else return f===this.nesting&&g<this.index?BoundSymbol.make(this.name,this.nesting,this.index-1):this};BoundSymbol.prototype.visit=function(b){b.acceptBoundSymbol(this)};
BoundSymbol.prototype.replaceBoundSymbols=function(b){b=b[this.name.name()];if(b===void 0)return this.unnest();else if(b===this.index)return new StackSymbol(this.name,b);else throw new ArcError("error: parameter index mismatch: expected "+b+", got "+this.index);};BoundSymbol.TYPE=Symbol.mkSym("bound-symbol");function SingleAssignment(b){ArcObject.call(this);this.expression=this.name=null;this.next_=b}SingleAssignment.prototype=new ArcObject;SingleAssignment.prototype.className="SingleAssignment";
SingleAssignment.prototype.take=function(b){if(this.name===null)if(b instanceof Symbol||b instanceof BoundSymbol)this.name=b;else throw new ArcError("assign: can't assign to "+b);else this.expression===null?this.expression=b:this.next_.take(b)};SingleAssignment.prototype.toString=function(){return""+this.name+" "+this.expression};SingleAssignment.prototype.addInstructions=function(b){this.addMyInstructions(b,!1);this.next_.addInstructions(b)};
SingleAssignment.prototype.addMyInstructions=function(b,c){if(this.name instanceof BoundSymbol)Assign_Lex.addInstructions(b,this.name,this.expression,c);else if(this.name instanceof StackSymbol)Assign_Stack.addInstructions(b,this.name,this.expression,c);else if(this.name instanceof Symbol)Assign_Free.addInstructions(b,this.name,this.expression,c);else throw new ArcError("what kind of symbol is "+this.name+"??");};SingleAssignment.prototype.type=function(){return Symbol.mkSym("assignment")};
SingleAssignment.prototype.assigns=function(){return!0};SingleAssignment.prototype.hasClosures=function(){return this.expression instanceof InterpretedFunction?this.expression.requiresClosure()||this.next_.hasClosures():this.expression.hasClosures()||this.next_.hasClosures()};
SingleAssignment.prototype.inline5=function(b,c,d,f,g){var h=new SingleAssignment(null);if(this.name instanceof BoundSymbol&&b.isSameBoundSymbol(this.name))throw new ArcError("Can't inline "+b+" -> "+c+"; assignment");h.name=this.name;h.expression=this.expression.inline5(b,c,d,f,g);h.next_=this.next_inline5(b,c,d,f,g);return h};
SingleAssignment.prototype.inline3=function(b,c,d){var f=new SingleAssignment(null);if(this.name instanceof StackSymbol&&b.isSameStackSymbol(this.name))throw new ArcError("Can't inline "+b+" -> "+c+"; assignment");f.name=this.name;f.expression=this.expression.inline3(b,c,d);f.next_=this.next_inline3(b,c,d);return f};SingleAssignment.prototype.nest=function(b){var c=new SingleAssignment(null);c.name=this.name.nest(b);c.expression=this.expression.nest(b);c.next_=this.next_.nest(b);return c};
SingleAssignment.prototype.replaceBoundSymbols=function(b){var c=new SingleAssignment(null);c.name=this.name.replaceBoundSymbols(b);c.expression=this.expression.replaceBoundSymbols(b);b=this.next_.replaceBoundSymbols(b);if(!(b instanceof SingleAssignment))throw new TypeError;c.next_=b;return c};SingleAssignment.prototype.visit=function(b){b.acceptSingleAssignment(this);this.name.visit(b);this.expression.visit(b);this.next_.visit(b);b.endSingleAssignment(this)};
SingleAssignment.prototype.assignsTo=function(b){if(this.name instanceof Symbol)return this.name.name()===b;else{if(!(this.name instanceof StackSymbol)&&(b=this.name,!(b instanceof BoundSymbol)))throw new TypeError;return this.name.name.name()===b}};function LastAssignment(){SingleAssignment.call(this,null)}LastAssignment.prototype=new SingleAssignment(null);LastAssignment.prototype.className="LastAssignment";
LastAssignment.prototype.take=function(b){if(this.name===null)if(b instanceof Symbol||b instanceof BoundSymbol)this.name=b;else throw new ArcError("assign: can't assign to "+b);else if(this.expression===null)this.expression=b;else throw new ArcError("assign: error: unexpected "+b);};LastAssignment.prototype.toString=function(){return""+this.name+" "+this.expression};LastAssignment.prototype.addInstructions=function(b){this.addMyInstructions(b,!0)};
LastAssignment.prototype.hasClosures=function(){return this.expression instanceof InterpretedFunction?this.expression.requiresClosure():this.expression.hasClosures()};LastAssignment.prototype.inline5=function(b,c,d,f,g){var h=new LastAssignment;if(this.name instanceof BoundSymbol&&b.isSameBoundSymbol(this.name))throw new ArcError("Can't inline "+b+" -> "+c+"; assignment");h.name=this.name.inline5(b,c,d,f,g);h.expression=this.expression.inline5(b,c,d,f,g);return h};
LastAssignment.prototype.inline3=function(b,c,d){var f=new LastAssignment;if(this.name instanceof StackSymbol&&b.isSameStackSymbol(this.name))throw new ArcError("Can't inline "+b+" -> "+c+"; assignment");f.name=this.name.inline3(b,c,d);f.expression=this.expression.inline3(b,c,d);return f};LastAssignment.prototype.nest=function(b){var c=new LastAssignment;c.name=this.name.nest(b);c.expression=this.expression.nest(b);return c};
LastAssignment.prototype.replaceBoundSymbols=function(b){var c=new LastAssignment;c.name=this.name.replaceBoundSymbols(b);c.expression=this.expression.replaceBoundSymbols(b);return c};LastAssignment.prototype.visit=function(b){b.acceptLastAssignment(this);this.name.visit(b);this.expression.visit(b);b.endLastAssignment(this)};function Assignment(){ArcObject.call(this);this.assignment=null}Assignment.prototype=new ArcObject;Assignment.prototype.className="Assignment";Assignment.prototype.type=function(){return Symbol.mkSym("assignment")};
Assignment.prototype.take=function(b){this.assignment.take(b)};Assignment.prototype.addInstructions=function(b){this.assignment.addInstructions(b)};Assignment.prototype.prepare=function(b){if(b%2!==0)throw new ArcError("assign: requires even number of arguments");b=b/2-1;if(b<0)throw new ArcError("assign: nothing to assign");for(this.assignment=new LastAssignment;0<b;)this.assignment=new SingleAssignment(this.assignment),b--};
Assignment.prototype.toString=function(){return"(assign "+this.assignment+")"};Assignment.prototype.assigns=function(b){return this.assignment.assigns(b)};Assignment.prototype.hasClosures=function(){return this.assignment.hasClosures()};Assignment.prototype.inline5=function(b,c,d,f,g){var h=new Assignment;h.assignment=this.assignment.inline5(b,c,d,f,g);return h};Assignment.prototype.inline3=function(b,c,d){var f=new Assignment;f.assignment=this.assignment.inline3(b,c,d);return f};
Assignment.prototype.nest=function(b){var c=new Assignment;c.assignment=this.assignment.nest(b);return c};Assignment.prototype.visit=function(b){b.acceptAssignment(this);this.assignment.visit(b);b.endAssignment(this)};Assignment.prototype.replaceBoundSymbols=function(b){var c=new Assignment,b=this.assignment.replaceBoundSymbols(b);if(!(b instanceof SingleAssignment))throw new TypeError;c.assignment=b;return c};function Else(){ArcObject.call(this);this.ifExpression=null}Else.prototype=new ArcObject;
Else.prototype.implementsConditional=!0;Else.prototype.className="Else";Else.prototype.type=function(){return Symbol.mkSym("else-clause")};Else.prototype.add=function(b){throw new ArcError("Internal error: if clause: unexpected extra condition: "+b);};Else.prototype.take=function(b){if(this.ifExpression===null)this.ifExpression=b;else throw new ArcError("Internal error: if clause: unexpected: "+b);};Else.prototype.addInstructions=function(b){this.ifExpression.addInstructions(b)};
Else.prototype.reduce=function(){return this};Else.prototype.inspect=function(){return"#<else "+this.ifExpression+">"};Else.prototype.toString=function(){return""+this.ifExpression};Else.prototype.assigns=function(b){return this.ifExpression.assigns(b)};Else.prototype.hasClosures=function(){return this.ifExpression instanceof InterpretedFunction?this.ifExpression.requiresClosure():this.ifExpression.hasClosures()};
Else.prototype.inline5=function(b,c,d,f,g){var h=new Else;h.ifExpression=this.ifExpression.inline5(b,c,d,f,g).reduce();return h};Else.prototype.inline3=function(b,c,d){var f=new Else;f.ifExpression=this.ifExpression.inline3(b,c,d).reduce();return f};Else.prototype.nest=function(b){var c=new Else;c.ifExpression=this.ifExpression.nest(b);return c};Else.prototype.replaceBoundSymbols=function(b){var c=new Else;c.ifExpression=this.ifExpression.replaceBoundSymbols(b);return c};
Else.prototype.visit=function(b){b.acceptElse(this);this.ifExpression.visit(b);b.endElse(this)};Else.prototype.sig=function(){return"_"+Invocation.sig(this.ifExpression)};function IfClause(){ArcObject.call(this);this.first_=null}IfClause.prototype=new ArcObject;IfClause.prototype.className="IfClause";IfClause.prototype.type=function(){return IfClause.TYPE};IfClause.prototype.append=function(b){this.first_!==null?this.first_.add(b):this.first_=b};
IfClause.prototype.reduce=function(){var b=this.first_.reduce();if(!b.implementsConditional)throw new TypeError;this.first_=b;return b instanceof Else?b.ifExpression:this};IfClause.prototype.take=function(b){this.first_.take(b)};IfClause.prototype.addInstructions=function(b){this.first_.addInstructions(b)};IfClause.prototype.toString=function(){return"(if "+this.first_+")"};IfClause.prototype.assigns=function(b){return this.first_.assigns(b)};IfClause.prototype.hasClosures=function(){return this.first_.hasClosures()};
IfClause.prototype.inline5=function(b,c,d,f,g){var h=new IfClause,b=this.first_.inline5(b,c,d,f,g).reduce();if(!b.implementsConditional)throw new TypeError;h.first_=b;return h};IfClause.prototype.inline3=function(b,c,d){var f=new IfClause,b=this.first_.inline3(b,c,d).reduce();if(!b.implementsConditional)throw new TypeError;f.first_=b;return f};IfClause.prototype.nest=function(b){var c=new IfClause,b=this.first_.nest(b);if(!b.implementsConditional)throw new TypeError;c.first_=b;return c};
IfClause.prototype.replaceBoundSymbols=function(b){var c=new IfClause,b=this.first_.replaceBoundSymbols(b);if(!b.implementsConditional)throw new TypeError;c.first_=b;return c};IfClause.prototype.visit=function(b){b.acceptIfClause(this);this.first_.visit(b);b.endIfClause(this)};IfClause.prototype.isAifIf=function(){return!(this.first_ instanceof IfThen)?!1:this.first_.ifExpression.toString()==="it"};
IfClause.prototype.thenExpression=function(){var b=this.first_;if(!(b instanceof IfThen))throw new TypeError;return b.thenExpression};IfClause.prototype.elseExpression=function(){var b=this.first_;if(!(b instanceof IfThen))throw new TypeError;return b.next};IfClause.TYPE=Symbol.mkSym("if-clause");function IfThen(){ArcObject.call(this);this.next=this.thenExpression=this.ifExpression=null}IfThen.prototype=new ArcObject;IfThen.prototype.implementsConditional=!0;IfThen.prototype.className="IfThen";
IfThen.prototype.type=function(){return Symbol.mkSym("if-then-clause")};IfThen.prototype.add=function(b){this.next!==null?this.next.add(b):this.next=b};IfThen.prototype.take=function(b){this.ifExpression===null?this.ifExpression=b:this.thenExpression===null?this.thenExpression=b:this.next.take(b)};
IfThen.prototype.addInstructions=function(b){var c=this.sig(),d="rainbow.vm.instructions.cond.optimise.If"+c;try{if(d in IfThen.handlers){var f=IfThen.handlers[d];f===null?this.defaultAddInstructions(b,c):f(b,this.ifExpression,this.thenExpression,this.next)}else IfThen.loadHandler(d),this.addInstructions(b)}catch(g){if(!(g instanceof Error))throw g;throw new ArcError("Couldn't instantiate "+d+": "+g,g);}};
IfThen.loadHandler=function(b){var c=classes[b];if(c===void 0)IfThen.handlers[b]=null;else{c=c.addInstructions;if(c===void 0)throw new ArcError("couldn't find handler method 'addInstructions(List,ArcObject,ArcObject,ArcObject) on "+b);IfThen.handlers[b]=c}};IfThen.prototype.defaultAddInstructions=function(b,c){this.ifExpression.addInstructions(b);b.push(new Cond(this.thenExpression,this.next,c))};
IfThen.prototype.reduce=function(){var b=this.next.reduce();if(!b.implementsConditional)throw new TypeError;this.next=b;return this.ifExpression instanceof Nil?this.next:this.reduceToIfBound_()||this.reduceToIfStack_()?(b=new Else,b.take(this.ifExpression),b):this};
IfThen.prototype.reduceToIfBound_=function(){if(!(this.ifExpression instanceof BoundSymbol)||!(this.thenExpression instanceof BoundSymbol)||!(this.next instanceof Else))return!1;else{var b=this.next;return this.ifExpression.isSameBoundSymbol(this.thenExpression)&&b.ifExpression instanceof Nil}};
IfThen.prototype.reduceToIfStack_=function(){if(!(this.ifExpression instanceof StackSymbol)||!(this.thenExpression instanceof StackSymbol)||!(this.next instanceof Else))return!1;else{var b=this.next;return this.ifExpression.isSameStackSymbol(this.thenExpression)&&b.ifExpression instanceof Nil}};IfThen.prototype.toString=function(){return""+this.ifExpression+" "+this.thenExpression+" "+this.next};
IfThen.prototype.assigns=function(b){return this.ifExpression.assigns(b)||this.thenExpression.assigns(b)||this.next.assigns(b)};IfThen.prototype.hasClosures=function(){return this.ifExpression instanceof InterpretedFunction&&this.ifExpression.requiresClosure()?!0:this.thenExpression instanceof InterpretedFunction&&this.thenExpression.requiresClosure()?!0:this.ifExpression.hasClosures()||this.thenExpression.hasClosures()||this.next.hasClosures()};
IfThen.prototype.inline5=function(b,c,d,f,g){var h=new IfThen;h.ifExpression=this.ifExpression.inline5(b,c,d,f,g).reduce();h.thenExpression=this.thenExpression.inline5(b,c,d,f,g).reduce();b=this.next.inline5(b,c,d,f,g).reduce();if(!b.implementsConditional)throw new TypeError;h.next=b;return h};
IfThen.prototype.inline3=function(b,c,d){var f=new IfThen;f.ifExpression=this.ifExpression.inline3(b,c,d).reduce();f.thenExpression=this.thenExpression.inline3(b,c,d).reduce();b=this.next.inline3(b,c,d).reduce();if(!b.implementsConditional)throw new TypeError;f.next=b;return f};IfThen.prototype.nest=function(b){var c=new IfThen;c.ifExpression=this.ifExpression.nest(b);c.thenExpression=this.thenExpression.nest(b);b=this.next.nest(b);if(!b.implementsConditional)throw new TypeError;c.next=b;return c};
IfThen.prototype.replaceBoundSymbols=function(b){var c=new IfThen;c.ifExpression=this.ifExpression.replaceBoundSymbols(b);c.thenExpression=this.thenExpression.replaceBoundSymbols(b);b=this.next.replaceBoundSymbols(b);if(!b.implementsConditional)throw new TypeError;c.next=b;return c};IfThen.prototype.visit=function(b){b.acceptIfThen(this);this.ifExpression.visit(b);this.thenExpression.visit(b);this.next.visit(b);b.endIfThen(this)};
IfThen.prototype.sig=function(){var b="";b+="_";b+=Invocation.sig(this.ifExpression);b+="_";b+=Invocation.sig(this.thenExpression);this.next instanceof Else?(b+="_",b+=Invocation.sig(this.next.ifExpression)):b+="_other";return b};IfThen.handlers={};function Quotation(b){ArcObject.call(this);this.quoted_=b}Quotation.prototype=new ArcObject;Quotation.prototype.className="Quotation";Quotation.prototype.addInstructions=function(b){b.push(new Literal(this.quoted_))};Quotation.prototype.quoted=function(){return this.quoted_};
Quotation.prototype.type=function(){return Symbol.mkSym("quotation")};Quotation.prototype.interpret=function(){return this.quoted_};Quotation.prototype.toString=function(){return"'"+this.quoted_};function Invocation(b){ArcObject.call(this);this.parts=b;this.constructors_={}}Invocation.prototype=new ArcObject;Invocation.prototype.className="Invocation";Invocation.prototype.type=function(){return Symbol.mkSym("if-then-clause")};Invocation.prototype.toString=function(){return Decompiler.decompile(this).toString()};
Invocation.prototype.addInstructions=function(b){this.inlineDoForm_(b)||this.addOptimisedHandler_(b)||this.defaultAddInstructions(b)};
Invocation.prototype.reduce=function(){if(this.parts.longerThan(1)&&this.parts.car()instanceof InterpretedFunction){var b=this.parts.car(),c=b.parameterList();if(c.isNotPair()||!(c.car()instanceof Symbol))return this;var c=c.car(),d=this.parts.cdr().car();if(b.canInline(c,d)){try{var f=b.curry(c,d,!0)}catch(g){if(!(g instanceof Error))throw g;throw new ArcError("couldn't curry "+c+"->"+d+" for "+b+" in expression "+this+": "+g,g);}return(new Invocation(new Pair(f,this.parts.cdr().cdr()))).reduce()}}return this};
Invocation.prototype.inlineDoForm_=function(b){return this.parts.len()===1&&this.parts.car()instanceof Bind?(this.parts.car().buildInstructions(b),!0):!1};
Invocation.prototype.addOptimisedHandler_=function(b){var c="rainbow.vm.instructions.invoke.optimise.Invoke"+this.sig_();if(c in this.constructors_){var d=this.constructors_[c];if(d===null)return!1;try{return this.addOptimisedInstructions_(b,new d(this.parts)),!0}catch(f){if(!(f instanceof Error))throw f;throw new ArcError("couldn't create optimiser "+c,f);}}else{d=classes[c];if(d===void 0)return this.constructors_[c]=null,!1;this.constructors_[c]=d;return this.addOptimisedHandler_(b)}};
Invocation.prototype.addOptimisedInstructions_=function(b,c){var d=this.parts.cdr();if(!(d instanceof Pair))throw new TypeError;for(;!(d instanceof Nil);)if(this.sig(d.car())==="other"&&d.car().addInstructions(b),d=d.cdr(),!(d instanceof Pair))throw new TypeError;this.sig(this.parts.car())==="other"&&this.parts.car().addInstructions(b);b.push(c)};
Invocation.prototype.sig_=function(){for(var b="",c=this.parts;!(c instanceof Nil);)if(b+="_",b+=Invocation.sig(c.car()),c=c.cdr(),!(c instanceof Pair))throw new TypeError;return b};Invocation.sig=function(b){return b instanceof BoundSymbol?"bound":b instanceof Symbol?"free":b instanceof StackSymbol?"stack":b.literal()?"literal":b instanceof Quotation?"quote":"other"};
Invocation.prototype.defaultAddInstructions=function(b){switch(this.parts.len()){case 1:Invoke_0.addInstructions(b,this.parts.car());break;case 2:Invoke_1.addInstructions(b,this.parts.car(),this.parts.cdr().car());break;case 3:Invoke_2.addInstructions(b,this.parts.car(),this.parts.cdr().car(),this.parts.cdr().cdr().car());break;case 4:Invoke_3.addInstructions(b,this.parts.car(),this.parts.cdr().car(),this.parts.cdr().cdr().car(),this.parts.cdr().cdr().cdr().car());break;default:var c=this.parts.car(),
d=this.parts.cdr();if(!(d instanceof Pair))throw new TypeError;Invoke_N.addInstructions(b,c,d)}return!0};Invocation.prototype.assigns=function(b){for(var c=this.parts;!(c instanceof Nil);){if(c.car().assigns(b))return!0;c=c.cdr();if(!(c instanceof Pair))throw new TypeError;}return!1};
Invocation.prototype.hasClosures=function(){for(var b=this.parts;!(b instanceof Nil);){if(b.car()instanceof InterpretedFunction){if(b.car().requiresClosure())return!0}else if(b.car().hasClosures())return!0;b=b.cdr();if(!(b instanceof Pair))throw new TypeError;}return!1};
Invocation.prototype.inline5=function(b,c,d,f,g){for(var h=this.parts,i=[];!(h instanceof Nil);){try{i.push(h.car().inline5(b,c,d,f,g))}catch(j){if(!(j instanceof Error))throw j;throw new ArcError("couldn't inline "+b+"->"+c+"(unnest:"+d+";nesting:"+f+") in "+this+" : "+j,j);}h=h.cdr();if(!(h instanceof Pair))throw new TypeError;}return new Invocation(Pair.buildFrom1(i))};
Invocation.prototype.inline3=function(b,c,d){for(var f=this.parts,g=[];!(f instanceof Nil);){try{g.push(f.car().inline3(b,c,d))}catch(h){if(!(h instanceof Error))throw h;throw new ArcError("couldn't inline "+b+"->"+c+") in "+this+" : "+h,h);}f=f.cdr();if(!(f instanceof Pair))throw new TypeError;}return new Invocation(Pair.buildFrom1(g))};
Invocation.prototype.nest=function(b){for(var c=this.parts,d=[];!(c instanceof Nil);)if(d.push(c.car().nest(b)),c=c.cdr(),!(c instanceof Pair))throw new TypeError;return new Invocation(Pair.buildFrom1(d))};Invocation.prototype.replaceBoundSymbols=function(b){for(var c=this.parts,d=[];!(c instanceof Nil);)if(d.push(c.car().replaceBoundSymbols(b)),c=c.cdr(),!(c instanceof Pair))throw new TypeError;return new Invocation(Pair.buildFrom1(d))};
Invocation.prototype.visit=function(b){b.acceptInvocation(this);for(var c=this.parts;!(c instanceof Nil);)if(c.car().visit(b),c=c.cdr(),!(c instanceof Pair))throw new TypeError;b.endInvocation(this)};function QuasiQuotation(b){ArcObject.call(this);this.target_=b}QuasiQuotation.prototype=new ArcObject;QuasiQuotation.prototype.className="QuasiQuotation";QuasiQuotation.prototype.type=function(){return Symbol.mkSym("quasiquotation")};
QuasiQuotation.prototype.addInstructions=function(b){this.addInstructions2(b,this.target_)};QuasiQuotation.prototype.toString=function(){return"`"+this.target_};QuasiQuotation.prototype.unquotes=function(){var b=[];this.appendUnquotes_(b,this.target_,1);return b};
QuasiQuotation.prototype.appendUnquotes_=function(b,c,d){if(QuasiQuotation.isUnQuote(c))d===1?b.push(c.cdr().car()):this.appendUnquotes_(b,c.cdr().car(),d-1);else if(QuasiQuotation.isUnQuoteSplicing(c))d===1?b.push(c.cdr().car()):this.appendUnquotes_(b,c.cdr().car(),d-1);else if(QuasiQuotation.isQuasiQuote(c))this.appendUnquotes_(b,c.cdr().car(),d+1);else if(!c.isNotPair())for(;!c.isNotPair();)if(QuasiQuotation.isUnQuote(c)||QuasiQuotation.isQuasiQuote(c))this.appendUnquotes_(b,c,d),c=c.cdr().cdr();
else{var f=c.car(),c=c.cdr();QuasiQuotation.isUnQuoteSplicing(f)?this.appendUnquotes_(b,f,d):(QuasiQuotation.isUnQuote(f)||QuasiQuotation.isQuasiQuote(f)||QuasiQuotation.isPair_(f))&&this.appendUnquotes_(b,f,d)}};QuasiQuotation.prototype.addInstructions2=function(b,c){return this.addInstructions_(b,c,1)};
QuasiQuotation.prototype.addInstructions_=function(b,c,d){if(QuasiQuotation.isUnQuote(c))d===1?c.cdr().car().addInstructions(b):(b.push(new Literal(QuasiQuoteCompiler.UNQUOTE)),this.addInstructions_(b,c.cdr().car(),d-1),b.push(new Listify(2)));else if(QuasiQuotation.isUnQuoteSplicing(c))d===1?(c.cdr().car().addInstructions(b),b.push(new AppendAll)):(b.push(new Literal(QuasiQuoteCompiler.UNQUOTE_SPLICING)),this.addInstructions_(b,c.cdr().car(),d-1),b.push(new Listify(2)),b.push(new Append));else if(QuasiQuotation.isQuasiQuote(c))b.push(new Literal(QuasiQuoteCompiler.QUASIQUOTE)),
this.addInstructions_(b,c.cdr().car(),d+1),b.push(new Listify(2));else if(c.isNotPair())b.push(new Literal(c));else{for(b.push(new NewList);!c.isNotPair();)if(QuasiQuotation.isUnQuote(c)||QuasiQuotation.isQuasiQuote(c))this.addInstructions_(b,c,d),c=c.cdr().cdr(),b.push(new AppendDot);else{var f=c.car(),c=c.cdr();QuasiQuotation.isUnQuoteSplicing(f)?this.addInstructions_(b,f,d):(QuasiQuotation.isUnQuote(f)||QuasiQuotation.isQuasiQuote(f)||QuasiQuotation.isPair_(f)?this.addInstructions_(b,f,d):b.push(new Literal(f)),
b.push(new Append))}c instanceof Nil||(b.push(new Literal(c)),b.push(new AppendDot));b.push(new FinishList)}};QuasiQuotation.isQQPair=function(b,c){return b instanceof Pair&&b.isCar(c)&&b.cdr().cdr()instanceof Nil};QuasiQuotation.isUnQuote=function(b){return QuasiQuotation.isQQPair(b,QuasiQuoteCompiler.UNQUOTE)};QuasiQuotation.isUnQuoteSplicing=function(b){return QuasiQuotation.isQQPair(b,QuasiQuoteCompiler.UNQUOTE_SPLICING)};
QuasiQuotation.isQuasiQuote=function(b){return QuasiQuotation.isQQPair(b,QuasiQuoteCompiler.QUASIQUOTE)};QuasiQuotation.isPair_=function(b){return b instanceof Pair};QuasiQuotation.prototype.assigns=function(b){for(var c=this.unquotes(),d=0,f=c.length;d<f;d++)if(c[d].assigns(b))return!0;return!1};QuasiQuotation.prototype.hasClosures=function(){for(var b=this.unquotes(),c=0,d=b.length;c<d;c++){var f=b[c];if(f instanceof InterpretedFunction){if(f.requiresClosure())return!0}else if(f.hasClosures())return!0}return!1};
QuasiQuotation.prototype.inline5=function(b,c,d,f,g){return new QuasiQuotation(QuasiQuotation.inline5_(b,c,d,f,g,this.target_,1))};
QuasiQuotation.inline5_=function(b,c,d,f,g,h,i){if(QuasiQuotation.isUnQuote(h))return i===1?Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE,h.cdr().car().inline5(b,c,d,f,g)]):Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE,QuasiQuotation.inline5_(b,c,d,f,g,h.cdr().car(),i-1)]);else if(QuasiQuotation.isUnQuoteSplicing(h))return i===1?Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE_SPLICING,h.cdr().car().inline5(b,c,d,f,g)]):Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE_SPLICING,QuasiQuotation.inline5_(b,c,d,f,g,
h.cdr().car(),i-1)]);else if(QuasiQuotation.isQuasiQuote(h))return Pair.buildFrom1([QuasiQuoteCompiler.QUASIQUOTE,QuasiQuotation.inline5_(b,c,d,f,g,h.cdr().car(),i+1)]);else if(h.isNotPair())return h;for(var j=[],l=ArcObject.NIL;!h.isNotPair();)if(QuasiQuotation.isUnQuote(h)||QuasiQuotation.isQuasiQuote(h))l=QuasiQuotation.inline5_(b,c,d,f,g,h,i),h=h.cdr().cdr();else{var k=h.car(),h=h.cdr();QuasiQuotation.isUnQuoteSplicing(k)?j.push(QuasiQuotation.inline5_(b,c,d,f,g,k,i)):QuasiQuotation.isUnQuote(k)||
QuasiQuotation.isQuasiQuote(k)||QuasiQuotation.isPair_(k)?j.push(QuasiQuotation.inline5_(b,c,d,f,g,k,i)):j.push(k)}h instanceof Nil||(l=h);return Pair.buildFrom2(j,l)};QuasiQuotation.prototype.inline3=function(b,c,d){return new QuasiQuotation(QuasiQuotation.inline3_(b,c,d,this.target_,1))};
QuasiQuotation.inline3_=function(b,c,d,f,g){if(QuasiQuotation.isUnQuote(f))return g===1?Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE,f.cdr().car().inline3(b,c,d)]):Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE,QuasiQuotation.inline5_(b,c,d,f.cdr().car(),g-1)]);else if(QuasiQuotation.isUnQuoteSplicing(f))return g===1?Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE_SPLICING,f.cdr().car().inline3(b,c,d)]):Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE_SPLICING,QuasiQuotation.inline3_(b,c,d,f.cdr().car(),g-1)]);
else if(QuasiQuotation.isQuasiQuote(f))return Pair.buildFrom1([QuasiQuoteCompiler.QUASIQUOTE,QuasiQuotation.inline3_(b,c,d,f.cdr().car(),g+1)]);else if(f.isNotPair())return f;for(var h=[],i=ArcObject.NIL;!f.isNotPair();)if(QuasiQuotation.isUnQuote(f)||QuasiQuotation.isQuasiQuote(f))i=QuasiQuotation.inline3_(b,c,d,f,g),f=f.cdr().cdr();else{var j=f.car(),f=f.cdr();QuasiQuotation.isUnQuoteSplicing(j)?h.push(QuasiQuotation.inline3_(b,c,d,j,g)):QuasiQuotation.isUnQuote(j)||QuasiQuotation.isQuasiQuote(j)||
QuasiQuotation.isPair_(j)?h.push(QuasiQuotation.inline3_(b,c,d,j,g)):h.push(j)}f instanceof Nil||(i=f);return Pair.buildFrom2(h,i)};QuasiQuotation.prototype.nest=function(b){return new QuasiQuotation(QuasiQuotation.nest_(b,this.target_,1))};
QuasiQuotation.nest_=function(b,c,d){if(QuasiQuotation.isUnQuote(c))return d===1?Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE,c.cdr().car().nest(b)]):Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE,QuasiQuotation.nest_(b,c.cdr().car(),d-1)]);else if(QuasiQuotation.isUnQuoteSplicing(c))return d===1?Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE_SPLICING,c.cdr().car().nest(b)]):Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE_SPLICING,QuasiQuotation.nest_(b,c.cdr().car(),d-1)]);else if(QuasiQuotation.isQuasiQuote(c))return Pair.buildFrom1([QuasiQuoteCompiler.QUASIQUOTE,
QuasiQuotation.nest_(b,c.cdr().car(),d+1)]);else if(c.isNotPair())return c;for(var f=[],g=ArcObject.NIL;!c.isNotPair();)if(QuasiQuotation.isUnQuote(c)||QuasiQuotation.isQuasiQuote(c))g=QuasiQuotation.nest_(b,c,d),c=c.cdr().cdr();else{var h=c.car(),c=c.cdr();QuasiQuotation.isUnQuoteSplicing(h)||QuasiQuotation.isUnQuote(h)||QuasiQuotation.isQuasiQuote(h)||QuasiQuotation.isPair_(h)?f.push(QuasiQuotation.nest_(b,h,d)):f.push(h)}c instanceof Nil||(g=c);return Pair.buildFrom2(f,g)};
QuasiQuotation.prototype.replaceBoundSymbols=function(b){return new QuasiQuotation(QuasiQuotation.replaceBoundSymbols_(b,this.target_,1))};
QuasiQuotation.replaceBoundSymbols_=function(b,c,d){if(QuasiQuotation.isUnQuote(c))return d===1?Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE,c.cdr().car().replaceBoundSymbols(b)]):Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE,QuasiQuotation.replaceBoundSymbols_(b,c.cdr().car(),d-1)]);else if(QuasiQuotation.isUnQuoteSplicing(c))return d===1?Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE_SPLICING,c.cdr().car().replaceBoundSymbols(b)]):Pair.buildFrom1([QuasiQuoteCompiler.UNQUOTE_SPLICING,QuasiQuotation.replaceBoundSymbols_(b,
c.cdr().car(),d-1)]);else if(QuasiQuotation.isQuasiQuote(c))return Pair.buildFrom1([QuasiQuoteCompiler.QUASIQUOTE,QuasiQuotation.replaceBoundSymbols_(b,c.cdr().car(),d+1)]);else if(c.isNotPair())return c;for(var f=[],g=ArcObject.NIL;!c.isNotPair();)if(QuasiQuotation.isUnQuote(c)||QuasiQuotation.isQuasiQuote(c))g=QuasiQuotation.replaceBoundSymbols_(b,c,d),c=c.cdr().cdr();else{var h=c.car(),c=c.cdr();QuasiQuotation.isUnQuoteSplicing(h)||QuasiQuotation.isUnQuote(h)||QuasiQuotation.isQuasiQuote(h)||QuasiQuotation.isPair_(h)?
f.push(QuasiQuotation.replaceBoundSymbols_(b,h,d)):f.push(h)}c instanceof Nil||(g=c);return Pair.buildFrom2(f,g)};QuasiQuotation.prototype.visit=function(b){b.acceptQuasiQuotation(this);for(var c=this.unquotes(),d=0,f=c.length;d<f;d++)c[d].visit(b);b.endQuasiQuotation(this)};function Unquote(){}function UnquoteSplicing(){}function Visitor(){}Visitor.prototype.acceptObject=function(){};Visitor.prototype.endObject=function(){};Visitor.prototype.acceptInterpretedFunction=function(b){this.acceptObject(b)};
Visitor.prototype.acceptAssignment=function(b){this.acceptObject(b)};Visitor.prototype.acceptBoundSymbol=function(b){this.acceptObject(b)};Visitor.prototype.acceptElse=function(b){this.acceptObject(b)};Visitor.prototype.acceptIfClause=function(b){this.acceptObject(b)};Visitor.prototype.acceptIfThen=function(b){this.acceptObject(b)};Visitor.prototype.acceptInstruction=function(b){this.acceptObject(b)};Visitor.prototype.acceptInvocation=function(b){this.acceptObject(b)};
Visitor.prototype.acceptLastAssignment=function(b){this.acceptObject(b)};Visitor.prototype.acceptPair=function(b){this.acceptObject(b)};Visitor.prototype.acceptQuasiQuotation=function(b){this.acceptObject(b)};Visitor.prototype.acceptQuotation=function(b){this.acceptObject(b)};Visitor.prototype.acceptSingleAssignment=function(b){this.acceptObject(b)};Visitor.prototype.endInterpretedFunction=function(b){this.endObject(b)};Visitor.prototype.endAssignment=function(b){this.endObject(b)};
Visitor.prototype.endElse=function(b){this.endObject(b)};Visitor.prototype.endIfClause=function(b){this.endObject(b)};Visitor.prototype.endIfThen=function(b){this.endObject(b)};Visitor.prototype.endInvocation=function(b){this.endObject(b)};Visitor.prototype.endLastAssignment=function(b){this.endObject(b)};Visitor.prototype.endPair=function(b){this.endObject(b)};Visitor.prototype.endQuasiQuotation=function(b){this.endObject(b)};Visitor.prototype.endQuotation=function(b){this.endObject(b)};
Visitor.prototype.endSingleAssignment=function(b){this.endObject(b)};function FunctionOwnershipVisitor(b){Visitor.call(this);this.owners_=new Pair(b,ArcObject.NIL)}FunctionOwnershipVisitor.prototype=new Visitor;FunctionOwnershipVisitor.prototype.acceptInterpretedFunction=function(b){b.belongsTo(this.owners_.car());this.owners_=new Pair(b,this.owners_)};FunctionOwnershipVisitor.prototype.endInterpretedFunction=function(){this.owners_=this.owners_.cdr()};
function MeasureLexicalReach(){Visitor.call(this);this.stack_=[];this.referrers_=[];this.nesting_=0;this.reach_=-1}MeasureLexicalReach.prototype=new Visitor;MeasureLexicalReach.prototype.reach=function(){return this.reach_};MeasureLexicalReach.prototype.acceptInterpretedFunction=function(b){b.nests()&&this.nesting_++};MeasureLexicalReach.prototype.acceptObject=function(){};MeasureLexicalReach.prototype.endObject=function(){};
MeasureLexicalReach.prototype.endInterpretedFunction=function(b){b.nests()&&this.nesting_--};MeasureLexicalReach.prototype.acceptBoundSymbol=function(b){b=b.nesting-this.nesting_;if(this.reach_<b)this.reach_=b};function ReferenceCounter(b){Visitor.call(this);this.stack_=[];this.referrers_=[];this.target_=b}ReferenceCounter.prototype=new Visitor;ReferenceCounter.prototype.count=function(){return this.referrers_.length};
ReferenceCounter.prototype.acceptInterpretedFunction=function(b){this.stack_.unshift(b);if(b.nests())this.target_=this.target_.nest(0)};ReferenceCounter.prototype.acceptObject=function(b){this.stack_.unshift(b)};ReferenceCounter.prototype.endObject=function(){this.stack_.shift()};ReferenceCounter.prototype.endInterpretedFunction=function(b){this.stack_.shift();if(b.nests())this.target_=this.target_.unnest()};
ReferenceCounter.prototype.acceptBoundSymbol=function(b){b.isSameBoundSymbol(this.target_)&&0<this.stack_.length&&this.referrers_.push(this.stack_[0])};function FunctionProfile(){this.name=this.target=null;this.totalNanoTime=this.nanoTime=this.invocationCount=0;this.children=[];this.parent=null;this.callerCounts={};this.calleeCounts={}}FunctionProfile.prototype.addNanoTime=function(b){this.nanoTime+=b;this.totalNanoTime+=b;for(var c=this.parent;c!==null;)c.totalNanoTime+=b,c=c.parent};
FunctionProfile.prototype.toPair=function(){var b=ArcString.make(this.target.profileName());this.target instanceof InterpretedFunction&&(b=ArcString.make(this.target.localProfileName()));for(var c=Real.make(this.nanoTime/1E6),d=Real.make(this.totalNanoTime/1E6),f=Rational.make1(invocationCount),g=ArcObject.NIL,h=0,i=this.children,j=i.length;h<j;h++)g=new Pair(i[h].toPair(),g);return Pair.buildFrom1([d,c,f,b,g,this.toPair_(this.callerCounts),this.toPair_(this.calleeCounts)])};
FunctionProfile.prototype.toPair_=function(b){var c=ArcObject.NIL,d;for(d in b)c=new Pair(b[d].toPair(),c);return c};FunctionProfile.get=function(b,c){var d=c.profileName(),f=b[d];if(f===void 0&&(f=new FunctionProfile,f.target=c,f.name=d,b[d]=f,c instanceof InterpretedFunction&&(d=c.lexicalOwner(),d!==null)))d=FunctionProfile.get(b,d),d.children.push(f),f.parent=d;return f};FunctionProfile.prototype.addCaller=function(b){b!==null&&InvocationCounter.get(this.callerCounts,b).count++};
FunctionProfile.prototype.addCallee=function(b){b!==null&&InvocationCounter.get(this.calleeCounts,b).count++};function InvocationCounter(b){this.target=b;this.count=0;this.key=b.profileName()}InvocationCounter.prototype.inc=function(){this.count++};InvocationCounter.prototype.toPair=function(){var b=key;this.target instanceof InterpretedFunction&&(b=this.target.localProfileName());return new Pair(ArcString.make(b),new Pair(Rational.make1(this.count),ArcObject.NIL))};
InvocationCounter.get=function(b,c){var d=b[c.profileName()];d===void 0&&(d=new InvocationCounter(c),b[d.key]=d);return d};function ProfileData(){this.invocationProfile={};this.instructionProfile={};this.lastInvokee=null;this.now=0}function VMInterceptor(){}VMInterceptor.updateNanoTime_=function(b){var c=b.profileData.lastInvokee;c!==null&&FunctionProfile.get(b.profileData.invocationProfile,c).addNanoTime((new Date).getTime()*1E6-b.profileData.now)};VMInterceptor.prototype.check=void 0;
VMInterceptor.prototype.end=void 0;VMInterceptor.prototype.install=void 0;VMInterceptor.debug=function(b){b.show();var c=prompt("q to resume execution, f to skip to the end of this frame, any other key to step");if(c!==null)if(/^q$/i.test(c))b.setInterceptor(VMInterceptor.NULL);else if(/^f$/i.test(c))b.debug_target_frame=b.ip-1,b.setInterceptor(VMInterceptor.NEXT_FRAME)};VMInterceptor.NULL_class=function(){};VMInterceptor.NULL_class.prototype=new VMInterceptor;
VMInterceptor.NULL_class.prototype.check=function(){};VMInterceptor.NULL_class.prototype.end=function(){};VMInterceptor.NULL_class.prototype.install=function(){};VMInterceptor.NULL=new VMInterceptor.NULL_class;VMInterceptor.DEBUG_class=function(){};VMInterceptor.DEBUG_class.prototype=new VMInterceptor;VMInterceptor.DEBUG_class.prototype.check=function(b){VMInterceptor.debug(b)};VMInterceptor.DEBUG_class.prototype.end=function(b){System_out_println("VM thread finished: returning.");VMInterceptor.debug(b)};
VMInterceptor.DEBUG_class.prototype.install=function(){};VMInterceptor.DEBUG=new VMInterceptor.DEBUG_class;VMInterceptor.KILL_class=function(){};VMInterceptor.KILL_class.prototype=new VMInterceptor;VMInterceptor.KILL_class.prototype.check=function(b){b.die()};VMInterceptor.KILL_class.prototype.end=function(){};VMInterceptor.KILL_class.prototype.install=function(){};VMInterceptor.KILL=new VMInterceptor.KILL_class;VMInterceptor.NEXT_FRAME_class=function(){};
VMInterceptor.NEXT_FRAME_class.prototype=new VMInterceptor;VMInterceptor.NEXT_FRAME_class.prototype.check=function(b){b.ip<=b.debug_target_frame&&b.setInterceptor(VMInterceptor.DEBUG)};VMInterceptor.NEXT_FRAME_class.prototype.end=function(){};VMInterceptor.NEXT_FRAME_class.prototype.install=function(){};VMInterceptor.NEXT_FRAME=new VMInterceptor.NEXT_FRAME_class;VMInterceptor.PROFILE_class=function(){};VMInterceptor.PROFILE_class.prototype=new VMInterceptor;
VMInterceptor.PROFILE_class.prototype.addInstruction_=function(b,c){var d=c.profileData.instructionProfile[b.getClass().getName()];d===void 0?d=1:d++;c.profileData.instructionProfile[b.getClass().getName()]=d};
VMInterceptor.PROFILE_class.prototype.check=function(b){VMInterceptor.updateNanoTime_(b);var c=b.nextInstruction();if(c!==null){b.loadCurrentContext();this.addInstruction(c,b);if(c.implementsInvoke){var d=c.getInvokee(b);d instanceof Closure&&(d=d.fn());var f=FunctionProfile.get(b.profileData.invocationProfile,d),c=c.owner();f.addCaller(c);FunctionProfile.get(b.profileData.invocationProfile,c).addCallee(d);f.invocationCount++;b.profileData.lastInvokee=d}else b.profileData.lastInvokee=c.owner()!==
null?c.owner():ArcObject.NIL;b.profileData.now=(new Date).getTime()*1E6}};VMInterceptor.PROFILE_class.prototype.end=function(){};VMInterceptor.PROFILE_class.prototype.install=function(b){b.profileData=new ProfileData;b.profileData.now=(new Date).getTime()*1E6};VMInterceptor.PROFILE=new VMInterceptor.PROFILE_class;var AssignmentBuilder={};
AssignmentBuilder.build=function(b,c,d){var f=new Assignment;f.prepare(c.len());var g=new Literal(f);g.belongsTo(ArcString.make("AssignmentBuilder.build"));b.pushFrame(g);b.pushFrame(new AssignmentBuilder.BuildAssignment1(f,c,d))};AssignmentBuilder.BuildAssignment1=function(b,c,d){Instruction.call(this);this.assignment_=b;this.body_=c;this.lexicalBindings_=d;this.belongsTo(ArcString.make("AssignmentBuilder.build"))};AssignmentBuilder.BuildAssignment1.prototype=new Instruction;
AssignmentBuilder.BuildAssignment1.prototype.className="AssignmentBuilder.BuildAssignment1";AssignmentBuilder.BuildAssignment1.prototype.operate=function(b){if(!(this.body_ instanceof Nil)){try{this.body_.mustBePairOrNil()}catch(c){if(!(c instanceof Pair.NotPair))throw c;throw new ArcError("assign: unexpected: "+this.body_);}b.pushFrame(new AssignmentBuilder.BuildAssignment2(this.assignment_,this.body_.cdr(),this.lexicalBindings_));Compiler.compile(b,this.body_.car(),this.lexicalBindings_)}};
AssignmentBuilder.BuildAssignment2=function(b,c,d){Instruction.call(this);this.assignment_=b;this.body_=c;this.lexicalBindings_=d;this.belongsTo(ArcString.make("AssignmentBuilder.build"))};AssignmentBuilder.BuildAssignment2.prototype=new Instruction;AssignmentBuilder.BuildAssignment2.prototype.className="AssignmentBuilder.BuildAssignment2";
AssignmentBuilder.BuildAssignment2.prototype.operate=function(b){this.assignment_.take(b.popA().reduce());b.pushFrame(new AssignmentBuilder.BuildAssignment1(this.assignment_,this.body_,this.lexicalBindings_))};var Compiler={};Compiler.atstrings=ArcObject.NIL;Compiler.atStringFunction=Symbol.mkSym("at-string");
Compiler.compile=function(b,c,d){if(c instanceof Nil)b.pushA(c);else if(c instanceof ArcString&&!(Compiler.atstrings instanceof Nil))b.pushFrame(new Compiler.FinishAtString(d)),Compiler.atString_(b,c);else if(Evaluation.isSpecialSyntax(c))Compiler.compile(b,Evaluation.ssExpand(c),d);else if(c instanceof Pair)Compiler.compilePair(b,c,d);else{if(c instanceof Symbol)for(var f=0;f<d.length;f++)if(c.name()in d[f])return void b.pushA(BoundSymbol.make(c,f,d[f][c.name()]));b.pushA(c)}};
Compiler.FinishAtString=function(b){Instruction.call(this);this.lexicalBindings_=b;this.belongsTo(ArcString.make("Compiler.compile"))};Compiler.FinishAtString.prototype=new Instruction;Compiler.FinishAtString.prototype.className="Compiler.FinishAtString";Compiler.FinishAtString.prototype.operate=function(b){var c=b.popA();c instanceof ArcString?b.pushA(c):Compiler.compile(b,c,this.lexicalBindings_)};
Compiler.compilePair=function(b,c,d){var f=Compiler.getMacro_(c);if(f!==null){c=c.cdr();if(!(c instanceof Pair))throw new TypeError;b.pushFrame(new Compiler.ThenCompile(d));f.invokeAndWait(b,c)}else if(f=c.car(),Symbol.is("quote",f))b.pushA(new Quotation(c.cdr().car()));else if(f===QuasiQuoteCompiler.QUASIQUOTE)b.pushFrame(new Compiler.WrapQuasiQuotation),QuasiQuoteCompiler.compile(b,c.cdr().car(),d,1);else if(Symbol.is("fn",f)){c=c.cdr();if(!(c instanceof Pair))throw new TypeError;FunctionBodyBuilder.build(b,
c,d)}else if(Symbol.is("if",f))IfBuilder.build(b,c.cdr(),d);else if(Symbol.is("assign",f))AssignmentBuilder.build(b,c.cdr(),d);else if(Symbol.is("compose",f.xcar())){f=f.cdr();if(!(f instanceof Pair))throw new TypeError;c=c.cdr();if(!(c instanceof Pair))throw new TypeError;Compiler.compile(b,Compiler.decompose_(f,c),d)}else if(Symbol.is("complement",f.xcar())){c=c.cdr();if(!(c instanceof Pair))throw new TypeError;Compiler.compile(b,Compiler.decomplement_(f.cdr().car(),c),d)}else Evaluation.isSpecialSyntax(f)?
Compiler.compile(b,new Pair(Evaluation.ssExpand(f),c.cdr()),d):InvocationBuilder.build(b,c,d)};Compiler.ThenCompile=function(b){Instruction.call(this);this.lexicalBindings_=b;this.belongsTo(ArcString.make("Compiler.compilePair"))};Compiler.ThenCompile.prototype=new Instruction;Compiler.ThenCompile.prototype.className="Compiler.ThenCompile";Compiler.ThenCompile.prototype.operate=function(b){Compiler.compile(b,b.popA(),this.lexicalBindings_)};
Compiler.WrapQuasiQuotation=function(){Instruction.call(this);this.belongsTo(ArcString.make("Compiler.compilePair"))};Compiler.WrapQuasiQuotation.prototype=new Instruction;Compiler.WrapQuasiQuotation.prototype.className="Compiler.WrapQuasiQuotation";Compiler.WrapQuasiQuotation.prototype.operate=function(b){b.pushA(new QuasiQuotation(b.popA()))};
Compiler.decompose_=function(b,c){var d=b.car();if(b.cdr()instanceof Nil)return new Pair(d,c);var f=b.cdr();if(!(f instanceof Pair))throw new TypeError;return new Pair(d,new Pair(Compiler.decompose_(f,c),ArcObject.NIL))};Compiler.decomplement_=function(b,c){return new Pair(Symbol.mkSym("no"),new Pair(new Pair(b,c),ArcObject.NIL))};Compiler.atString_=function(b,c){if(!Compiler.atStringFunction.bound())return void b.pushA(c);Compiler.atStringFunction.value().invokeAndWait(b,new Pair(c,ArcObject.NIL))};
Compiler.getMacro_=function(b){b=b.car();return!(b instanceof Symbol)?null:!b.bound()?null:Tagged.ifTagged(b.value(),"mac")};var FunctionBodyBuilder={};FunctionBodyBuilder.build=function(b,c,d){if(d===null)throw new ReferenceError("can't have null lexical bindings!");var f={},g=c.car();g instanceof Nil||(d=[f].concat(d));b.pushFrame(new FunctionBodyBuilder.Intermediate(c,d,f));g instanceof Nil?b.pushA(new Pair(ArcObject.NIL,ArcObject.NIL)):FunctionParameterListBuilder.build(b,g,d)};
FunctionBodyBuilder.Intermediate=function(b,c,d){Instruction.call(this);this.args_=b;this.lexicalBindings_=c;this.myParams_=d;this.belongsTo(ArcString.make("FunctionBodyBuilder.build"))};FunctionBodyBuilder.Intermediate.prototype=new Instruction;FunctionBodyBuilder.Intermediate.prototype.className="FunctionBodyBuilder.Intermediate";
FunctionBodyBuilder.Intermediate.prototype.operate=function(b){var c=b.popA(),d=c.car(),c=c.cdr(),f=this.args_.cdr();if(!(f instanceof Pair))throw new TypeError;b.pushFrame(new FunctionBodyBuilder.Finish(c,this.myParams_,f,d,b.getAp()));PairExpander.expand(b,f,this.lexicalBindings_)};FunctionBodyBuilder.Finish=function(b,c,d,f,g){Instruction.call(this);this.parameterList_=b;this.myParams_=c;this.body_=d;this.complexParams_=f;this.ap_=g;this.belongsTo(ArcString.make("FunctionBodyBuilder.build"))};
FunctionBodyBuilder.Finish.prototype=new Instruction;FunctionBodyBuilder.Finish.prototype.implementsOnError=!0;FunctionBodyBuilder.Finish.prototype.className="FunctionBodyBuilder.Finish";FunctionBodyBuilder.Finish.prototype.catches=function(b){return b instanceof Error};
FunctionBodyBuilder.Finish.prototype.operate=function(b){var c=b.error();if(c!==null)throw b.clearError(),b.setAp(this.ap_),new ArcError("building function fn "+this.parameterList_+" "+this.body_+": "+c,c);b.pushA(FunctionBodyBuilder.buildFunctionBody(this.parameterList_,this.myParams_,b.popA(),this.complexParams_))};
FunctionBodyBuilder.buildFunctionBody=function(b,c,d,f){var g="rainbow.function.interpreted.optimise.Bind"+FunctionBodyBuilder.sig(b,!1),h=classes[g];if(h===void 0)return FunctionBodyBuilder.defaultFunctionBody_(b,c,d,f);try{var i=h.of(b,c,d);if(!(i instanceof ArcObject))throw new TypeError;return i}catch(j){if(!(j instanceof Error))throw j;throw new ArcError("Couldn't instantiate "+g+": "+j,j);}};
FunctionBodyBuilder.buildStackFunctionBody=function(b,c,d,f){var g=FunctionBodyBuilder.sig(b,!1);if(g==="")return FunctionBodyBuilder.buildFunctionBody(b,c,d,f);f="rainbow.function.interpreted.optimise.stack.Stack"+g;g=classes[f];if(g===void 0)throw new ArcError("no stack-based function implementation for "+b+"; couldn't find "+f);try{var h=g.of3(b,c,d);if(!(h instanceof ArcObject))throw new TypeError;return h}catch(i){if(!(i instanceof Error))throw i;throw new ArcError("Couldn't instantiate "+f+
": "+i,i);}};FunctionBodyBuilder.convertToStackParams=function(b){var c="rainbow.function.interpreted.optimise.stack.Stack"+FunctionBodyBuilder.sig(b.parameterList(),!1),d=classes[c];if(d===void 0)return b;try{var f=d.of1(b);if(!(f instanceof ArcObject))throw new TypeError;return f}catch(g){if(!(g instanceof Error))throw g;throw new ArcError("Couldn't instantiate "+c+": "+g,g);}};
FunctionBodyBuilder.defaultFunctionBody_=function(b,c,d,f){return f instanceof Nil?new SimpleArgs(b,c,d):new ComplexArgs(b,c,d)};
FunctionBodyBuilder.sig=function(b,c){if(b instanceof Nil)return"";if(b instanceof Pair)if(c)if(ComplexArgs.optional(b)){var d=b.cdr().cdr().car();return d.literal()?"_Oliteral":d instanceof BoundSymbol?"_Obound":"_Oother"}else return d=b.car(),"_D"+FunctionBodyBuilder.sig(d,!0)+FunctionBodyBuilder.sig(b.cdr(),!1)+"_d";else return FunctionBodyBuilder.sig(b.car(),!0)+FunctionBodyBuilder.sig(b.cdr(),!1);else return c?"_A":"_R"};
FunctionBodyBuilder.visit=function(b,c,d){!(c instanceof Nil)&&c instanceof Pair&&(d&&ComplexArgs.optional(c)?c.cdr().cdr().car().visit(b):(FunctionBodyBuilder.visit(b,c.car(),!0),FunctionBodyBuilder.visit(b,c.cdr(),!1)))};var FunctionParameterListBuilder={};FunctionParameterListBuilder.O=Symbol.mkSym("o");FunctionParameterListBuilder.NIL_ARG=Symbol.mkSym("#NIL#");
FunctionParameterListBuilder.build=function(b,c,d){FunctionParameterListBuilder.index(c,d[0],[0],!1);FunctionParameterListBuilder.buildParams_(b,c,d)};FunctionParameterListBuilder.buildParams_=function(b,c,d){var f={value:ArcObject.NIL},g=[];b.pushFrame(new FunctionParameterListBuilder.ReturnParams(g,f));b.pushFrame(new FunctionParameterListBuilder.BuildParams1(g,f,c,d))};FunctionParameterListBuilder.ReturnParams=function(b,c){Instruction.call(this);this.result_=b;this.complexParams_=c;this.belongsTo(ArcString.make("FunctionParameterListBuilder.buildParams_"))};
FunctionParameterListBuilder.ReturnParams.prototype=new Instruction;FunctionParameterListBuilder.ReturnParams.prototype.className="FunctionParameterListBuilder.ReturnParams";FunctionParameterListBuilder.ReturnParams.prototype.operate=function(b){this.result_.length===0?b.pushA(FunctionParameterListBuilder.returnParams_(this.complexParams_.value,b.popA())):b.pushA(FunctionParameterListBuilder.returnParams_(this.complexParams_.value,Pair.buildFrom2(this.result_,b.popA())))};
FunctionParameterListBuilder.BuildParams1=function(b,c,d,f){Instruction.call(this);this.result_=b;this.complexParams_=c;this.parameters_=d;this.lexicalBindings_=f;this.belongsTo(ArcString.make("FunctionParameterListBuilder.buildParams_"))};FunctionParameterListBuilder.BuildParams1.prototype=new Instruction;FunctionParameterListBuilder.BuildParams1.prototype.className="FunctionParameterListBuilder.BuildParams1";
FunctionParameterListBuilder.BuildParams1.prototype.operate=function(b){if(this.parameters_.isNotPair()){var c=new Literal(this.parameters_);c.belongsTo(this);b.pushFrame(c)}else{var c=this.parameters_.car(),d=this.parameters_.cdr();if(c instanceof Pair)if(c instanceof Nil)this.result_.push(FunctionParameterListBuilder.NIL_ARG),b.pushFrame(new FunctionParameterListBuilder.BuildParams1(this.result_,this.complexParams_,d,this.lexicalBindings_));else if(this.complexParams_.value=ArcObject.T,ComplexArgs.optional(c)){var f=
c.cdr().car();b.pushFrame(new FunctionParameterListBuilder.BuildParams2a(this.result_,this.complexParams_,d,this.lexicalBindings_,f));Compiler.compile(b,c.cdr().cdr().car(),this.lexicalBindings_)}else b.pushFrame(new FunctionParameterListBuilder.BuildParams2b(this.result_,this.complexParams_,d,this.lexicalBindings_)),FunctionParameterListBuilder.buildParams_(b,c,this.lexicalBindings_);else this.result_.push(c),b.pushFrame(new FunctionParameterListBuilder.BuildParams1(this.result_,this.complexParams_,
d,this.lexicalBindings_))}};FunctionParameterListBuilder.BuildParams2a=function(b,c,d,f,g){Instruction.call(this);this.result_=b;this.complexParams_=c;this.parameters_=d;this.lexicalBindings_=f;this.optionalParamName_=g;this.belongsTo(ArcString.make("FunctionParameterListBuilder.buildParams_"))};FunctionParameterListBuilder.BuildParams2a.prototype=new Instruction;FunctionParameterListBuilder.BuildParams2a.prototype.className="FunctionParameterListBuilder.BuildParams2a";
FunctionParameterListBuilder.BuildParams2a.prototype.operate=function(b){this.result_.push(Pair.buildFrom1([FunctionParameterListBuilder.O,this.optionalParamName_,b.popA()]));b.pushFrame(new FunctionParameterListBuilder.BuildParams1(this.result_,this.complexParams_,this.parameters_,this.lexicalBindings_))};FunctionParameterListBuilder.BuildParams2b=function(b,c,d,f){Instruction.call(this);this.result_=b;this.complexParams_=c;this.parameters_=d;this.lexicalBindings_=f;this.belongsTo(ArcString.make("FunctionParameterListBuilder.buildParams_"))};
FunctionParameterListBuilder.BuildParams2b.prototype=new Instruction;FunctionParameterListBuilder.BuildParams2b.prototype.className="FunctionParameterListBuilder.BuildParams2b";FunctionParameterListBuilder.BuildParams2b.prototype.operate=function(b){this.result_.push(b.popA().cdr());b.pushFrame(new FunctionParameterListBuilder.BuildParams1(this.result_,this.complexParams_,this.parameters_,this.lexicalBindings_))};
FunctionParameterListBuilder.isComplex=function(b){for(;!b.isNotPair();){if(b.car()instanceof Pair)return ArcObject.T;b=b.cdr()}return ArcObject.NIL};FunctionParameterListBuilder.returnParams_=function(b,c){return new Pair(b,c)};
FunctionParameterListBuilder.index=function(b,c,d,f){if(!(b instanceof Nil))if(b instanceof Pair)f&&ComplexArgs.optional(b)?FunctionParameterListBuilder.index(b.cdr().car(),c,d,!0):(f=b.car(),f instanceof Nil?(c[FunctionParameterListBuilder.NIL_ARG.name()]=d[0],d[0]++):FunctionParameterListBuilder.index(f,c,d,!0),FunctionParameterListBuilder.index(b.cdr(),c,d,!1));else{if(!(b instanceof Symbol))throw new TypeError;c[b.name()]=d[0];d[0]++}};
FunctionParameterListBuilder.curryStack=function(b,c,d,f){for(var g=ArcObject.NIL,h=[];!b.isNotPair();){var i=FunctionParameterListBuilder.curryStackParam_(c,d,f,b.car());i!==null&&h.push(i);b=b.cdr()}b instanceof Symbol&&(c=FunctionParameterListBuilder.curryStackParam_(c,d,f,b),c!==null&&(g=c));try{return Pair.buildFrom2(h,g)}catch(j){if(!(j instanceof Error))throw j;throw new ArcError("couldn't curry params "+b+", got list "+h+" and last "+g);}};
FunctionParameterListBuilder.curryBound=function(b,c,d,f){for(var g=ArcObject.NIL,h=[];!b.isNotPair();){var i=FunctionParameterListBuilder.curryBoundParam_(c,d,f,b.car());i!==null&&h.push(i);b=b.cdr()}b instanceof Symbol&&(c=FunctionParameterListBuilder.curryBoundParam_(c,d,f,b),c!==null&&(g=c));try{return Pair.buildFrom2(h,g)}catch(j){if(!(j instanceof Error))throw j;throw new ArcError("couldn't curry params "+b+", got list "+h+" and last "+g);}};
FunctionParameterListBuilder.curryStackParam_=function(b,c,d,f){var g=null;f instanceof Symbol&&!f.isSame(b.name)?g=f:ComplexArgs.optional(f)&&!f.cdr().car().isSame(b.name)?g=Pair.buildFrom1([FunctionParameterListBuilder.O,f.cdr().car(),f.cdr().cdr().car().inline3(b,c,d)]):!ComplexArgs.optional(f)&&f instanceof Pair&&(g=f);return g};
FunctionParameterListBuilder.curryBoundParam_=function(b,c,d,f){var g=null;f instanceof Symbol&&!f.isSame(b.name)?g=f:ComplexArgs.optional(f)&&!f.cdr().car().isSame(b.name)?g=Pair.buildFrom1([FunctionParameterListBuilder.O,f.cdr().car(),f.cdr().cdr().car().inline5(b,c,!1,0,d)]):!ComplexArgs.optional(f)&&f instanceof Pair&&(g=f);return g};var IfBuilder={};
IfBuilder.build=function(b,c,d){for(var f=c,g=new IfClause;0<c.len();)switch(c.len()){case 0:break;case 1:g.append(new Else);c=c.cdr();break;case 2:g.append(new IfThen);c=c.cdr();if(!(c instanceof Pair))throw new TypeError;c.setCdr(new Pair(ArcObject.NIL,ArcObject.NIL));c=c.cdr();break;default:g.append(new IfThen),c=c.cdr().cdr()}c=f;b.pushFrame(new IfBuilder.Reduce(g));b.pushFrame(new IfBuilder.BuildIf1(g,c,d))};IfBuilder.Reduce=function(b){Instruction.call(this);this.clause_=b;this.belongsTo(ArcString.make("IfBuilder.build"))};
IfBuilder.Reduce.prototype=new Instruction;IfBuilder.Reduce.prototype.className="IfBuilder.Reduce";IfBuilder.Reduce.prototype.operate=function(b){b.pushA(this.clause_.reduce())};IfBuilder.BuildIf1=function(b,c,d){Instruction.call(this);this.clause_=b;this.body_=c;this.lexicalBindings_=d;this.belongsTo(ArcString.make("IfBuilder.build"))};IfBuilder.BuildIf1.prototype=new Instruction;IfBuilder.BuildIf1.prototype.className="IfBuilder.BuildIf1";
IfBuilder.BuildIf1.prototype.operate=function(b){if(!(this.body_ instanceof Nil)){try{this.body_.mustBePairOrNil()}catch(c){if(!(c instanceof Pair.NotPair))throw c;throw new ArcError("if: unexpected: "+this.body_);}b.pushFrame(new IfBuilder.BuildIf2(this.clause_,this.body_.cdr(),this.lexicalBindings_));Compiler.compile(b,this.body_.car(),this.lexicalBindings_)}};IfBuilder.BuildIf2=function(b,c,d){Instruction.call(this);this.clause_=b;this.body_=c;this.lexicalBindings_=d;this.belongsTo(ArcString.make("AssignmentBuilder.build"))};
IfBuilder.BuildIf2.prototype=new Instruction;IfBuilder.BuildIf2.prototype.className="IfBuilder.BuildIf2";IfBuilder.BuildIf2.prototype.operate=function(b){this.clause_.take(b.popA().reduce());b.pushFrame(new IfBuilder.BuildIf1(this.clause_,this.body_,this.lexicalBindings_))};var InvocationBuilder={};InvocationBuilder.build=function(b,c,d){b.pushFrame(new InvocationBuilder.BuildInvocation(c,d,c,[]))};
InvocationBuilder.BuildInvocation=function(b,c,d,f){Instruction.call(this);this.body_=b;this.lexicalBindings_=c;this.original_=d;this.list_=f;this.belongsTo(ArcString.make("InvocationBuilder.build"))};InvocationBuilder.BuildInvocation.prototype=new Instruction;InvocationBuilder.BuildInvocation.prototype.className="InvocationBuilder.BuildInvocation";
InvocationBuilder.BuildInvocation.prototype.operate=function(b){if(this.body_ instanceof Nil)b.pushA((new Invocation(Pair.buildFrom1(this.list_))).reduce());else{try{this.body_.mustBePairOrNil()}catch(c){if(!(c instanceof Pair.NotPair))throw c;throw new ArcError("can't compile "+this.original_+"; not a proper list");}b.pushFrame(new InvocationBuilder.BuildInvocation(this.body_.cdr(),this.lexicalBindings_,this.original_,this.list_));b.pushFrame(new InvocationBuilder.ReducePush(this.list_));Compiler.compile(b,
this.body_.car(),this.lexicalBindings_)}};InvocationBuilder.ReducePush=function(b){Instruction.call(this);this.list_=b;this.belongsTo(ArcString.make("InvocationBuilder.build"))};InvocationBuilder.ReducePush.prototype=new Instruction;InvocationBuilder.ReducePush.prototype.className="InvocationBuilder.ReducePush";InvocationBuilder.ReducePush.prototype.operate=function(b){this.list_.push(b.popA().reduce())};var PairExpander={};
PairExpander.expand=function(b,c,d){b.pushFrame(new PairExpander.ExpandPair(c,d,[]))};PairExpander.ExpandPair=function(b,c,d){Instruction.call(this);this.body_=b;this.lexicalBindings_=c;this.result_=d;this.belongsTo(ArcString.make("PairExpander.expand"))};PairExpander.ExpandPair.prototype=new Instruction;PairExpander.ExpandPair.prototype.className="PairExpander.ExpandPair";
PairExpander.ExpandPair.prototype.operate=function(b){if(this.body_ instanceof Nil||!(this.body_ instanceof Pair))b.pushFrame(new PairExpander.FinishPair(this.result_)),Compiler.compile(b,this.body_,this.lexicalBindings_);else{b.pushFrame(new PairExpander.ExpandPair(this.body_.cdr(),this.lexicalBindings_,this.result_));var c=this.body_.car();b.pushFrame(new PairExpander.ReducePush(this.result_));Compiler.compile(b,c,this.lexicalBindings_)}};
PairExpander.ReducePush=function(b){Instruction.call(this);this.list_=b;this.belongsTo(ArcString.make("PairExpander.expand"))};PairExpander.ReducePush.prototype=new Instruction;PairExpander.ReducePush.prototype.className="PairExpander.ReducePush";PairExpander.ReducePush.prototype.operate=function(b){this.list_.push(b.popA().reduce())};PairExpander.FinishPair=function(b){Instruction.call(this);this.result_=b;this.belongsTo(ArcString.make("PairExpander.expand"))};PairExpander.FinishPair.prototype=new Instruction;
PairExpander.FinishPair.prototype.className="PairExpander.FinishPair";PairExpander.FinishPair.prototype.operate=function(b){var c=Pair.buildFrom2(this.result_,b.popA().reduce());if(!(c instanceof Pair))throw new TypeError;b.pushA(c)};var QuasiQuoteCompiler={};QuasiQuoteCompiler.QUASIQUOTE=Symbol.mkSym("quasiquote");QuasiQuoteCompiler.UNQUOTE=Symbol.mkSym("unquote");QuasiQuoteCompiler.UNQUOTE_SPLICING=Symbol.mkSym("unquote-splicing");
QuasiQuoteCompiler.compile=function(b,c,d,f){c.isNotPair()?b.pushA(c):QuasiQuotation.isUnQuote(c)?QuasiQuoteCompiler.compileUnquote_(b,QuasiQuoteCompiler.UNQUOTE,c,f,d):QuasiQuotation.isUnQuoteSplicing(c)?QuasiQuoteCompiler.compileUnquote_(b,QuasiQuoteCompiler.UNQUOTE_SPLICING,c,f,d):QuasiQuotation.isQuasiQuote(c)?(b.pushFrame(new QuasiQuoteCompiler.Prefix(QuasiQuoteCompiler.QUASIQUOTE)),QuasiQuoteCompiler.compile(b,c.cdr().car(),d,f+1)):b.pushFrame(new QuasiQuoteCompiler.CompileQuasiQuote([],c,d,
f))};QuasiQuoteCompiler.CompileQuasiQuote=function(b,c,d,f){Instruction.call(this);this.result_=b;this.expression_=c;this.lexicalBindings_=d;this.nesting_=f;this.belongsTo(ArcString.make("QuasiQuoteCompiler.compile"))};QuasiQuoteCompiler.CompileQuasiQuote.prototype=new Instruction;QuasiQuoteCompiler.CompileQuasiQuote.prototype.className="QuasiQuoteCompiler.CompileQuasiQuote";
QuasiQuoteCompiler.CompileQuasiQuote.prototype.operate=function(b){if(this.expression_.isNotPair())b.pushFrame(new QuasiQuoteCompiler.FinishQuasiQuote(this.result_)),QuasiQuoteCompiler.compile(b,this.expression_,this.lexicalBindings_,this.nesting_);else{var c=this.expression_.car();b.pushFrame(new QuasiQuoteCompiler.CompileQuasiQuote(this.result_,this.expression_.cdr(),this.lexicalBindings_,this.nesting_));c.isNotPair()?this.result_.push(c):(b.pushFrame(new QuasiQuoteCompiler.Push(this.result_)),
QuasiQuoteCompiler.compile(b,c,this.lexicalBindings_,this.nesting_))}};QuasiQuoteCompiler.FinishQuasiQuote=function(b){Instruction.call(this);this.result_=b;this.belongsTo(ArcString.make("QuasiQuoteCompiler.compile"))};QuasiQuoteCompiler.FinishQuasiQuote.prototype=new Instruction;QuasiQuoteCompiler.FinishQuasiQuote.prototype.className="QuasiQuoteCompiler.FinishQuasiQuote";QuasiQuoteCompiler.FinishQuasiQuote.prototype.operate=function(b){b.pushA(Pair.buildFrom2(this.result_,b.popA()))};
QuasiQuoteCompiler.Push=function(b){Instruction.call(this);this.result_=b;this.belongsTo(ArcString.make("QuasiQuoteCompiler.compile"))};QuasiQuoteCompiler.Push.prototype=new Instruction;QuasiQuoteCompiler.Push.prototype.className="QuasiQuoteCompiler.Push";QuasiQuoteCompiler.Push.prototype.operate=function(b){this.result_.push(b.popA())};
QuasiQuoteCompiler.compileUnquote_=function(b,c,d,f,g){d=d.cdr().car();b.pushFrame(new QuasiQuoteCompiler.Prefix(c));f===1?Compiler.compile(b,d,g):QuasiQuoteCompiler.compile(b,d,g,f-1)};QuasiQuoteCompiler.Prefix=function(b){Instruction.call(this);this.prefix_=b;this.belongsTo(ArcString.make("QuasiQuoteCompiler.compile"))};QuasiQuoteCompiler.Prefix.prototype=new Instruction;QuasiQuoteCompiler.Prefix.prototype.className="QuasiQuoteCompiler.Prefix";
QuasiQuoteCompiler.Prefix.prototype.operate=function(b){b.pushA(Pair.buildFrom1([this.prefix_,b.popA()]))};function Argv(b){this.args_=b.slice();this.parsed_={}}Argv.prototype.terminal=function(b){var c=[],d=args.indexOf(b);-1<d&&(c=c.concat(args.slice(d+1)),args=args.slice(0,d));return this.parsed[b]=c};Argv.prototype.multi=function(b){for(var c=!1,d=[],f=0,g=this.args.length;f<g;f++){var h=this.args[f];h===b?c=!0:/^-/.test(h)?c=!1:c&&d.push(h)}return this.parsed[b]=d};
Argv.prototype.present=function(b){for(var c=0;c<this.args.length;c++)if(this.args[c]===b)return!0;return!1};var Decompiler={};Decompiler.LET=Symbol.mkSym("let");Decompiler.SELF=Symbol.mkSym("self");Decompiler.IT=Symbol.mkSym("it");Decompiler.AFN=Symbol.mkSym("afn");Decompiler.DO=Symbol.mkSym("do");Decompiler.WITH=Symbol.mkSym("with");Decompiler.AIF=Symbol.mkSym("aif");
Decompiler.decompile=function(b){return b.parts.car()instanceof InterpretedFunction?Decompiler.decompile_(Decompiler.withLetDo_(b.parts)):b.parts};Decompiler.decompile_=function(b){return b.car()===Decompiler.LET?Decompiler.decompileLet_(b.cdr()):b};
Decompiler.decompileLet_=function(b){if(b.car()===Decompiler.IT){var c=b.cdr().car(),d=b.cdr().cdr();if(d.cdr()instanceof Nil&&d.car()instanceof IfClause&&(d=d.car(),d.isAifIf()))return Decompiler.makeAif_(d,c)}else if(b.car()===Decompiler.SELF&&b.cdr().car()instanceof Nil&&(d=b.cdr().cdr(),d.car()instanceof Assignment&&d.cdr()instanceof Nil&&(c=d.car(),c.assignment.assignsTo("self")&&c.assignment.expression instanceof InterpretedFunction&&c.assignment instanceof LastAssignment)))return Decompiler.makeAfn(c.assignment.expression);
return new Pair(Decompiler.LET,b)};Decompiler.makeAfn_=function(b){return Pair.buildFrom1([Decompiler.AFN,b.parameterList()].concat(b.body))};Decompiler.withLetDo_=function(b){var c=b.car(),d=b.cdr(),f=c.parameterList();return d.len()===f.len()?d.len()===0?Decompiler.makeDo_(c):d.len()===1?Decompiler.makeLet_(c,d,f):Decompiler.makeWith_(c,d,f):b};Decompiler.makeDo_=function(b){return Pair.buildFrom1([Decompiler.DO].concat(b.body))};
Decompiler.makeWith_=function(b,c,d){for(var f=[];!(d instanceof Nil);)f.push(d.car()),f.push(c.car()),d=d.cdr(),c=c.cdr();return Pair.buildFrom1([Decompiler.WITH,Pair.buildFrom1(f)].concat(b.body))};Decompiler.makeLet_=function(b,c,d){return Pair.buildFrom1([Decompiler.LET,d.car(),c.car()].concat(b.body))};Decompiler.makeAif_=function(b,c){return Pair.buildFrom1([Decompiler.AIF,c,b.thenExpression(),b.elseExpression()])};function Builtin(){ArcObject.call(this)}Builtin.prototype=new ArcObject;
Builtin.prototype.className="Builtin";Builtin.of=function(b,c,d){return(new Builtin).init(b,c,d)};Builtin.prototype.init=function(b){this.name_=b;Symbol.mkSym(b).setValue(this);return this};Builtin.prototype.invokePair=function(b){throw new ArcError("Builtin:invoke(args):provide implementation! "+this.name()+" args "+b);};Builtin.prototype.invoke=function(b,c){b.pushA(this.invokePair(c))};Builtin.prototype.compareTo=function(){return 0};Builtin.prototype.type=function(){return Builtin.TYPE};
Builtin.checkMaxArgCount=function(b,c,d){if(d<b.len())throw System_out_println(c+" got args "+b+" was expecting expecting at most "+d),new ArcError(c.toLowerCase()+" expects at most "+d+" arguments: given "+b);};Builtin.checkMinArgCount=function(b,c,d){if(b.size()<d)throw new ArcError(c.toLowerCase()+" expects at least "+d+" arguments: given "+b);};Builtin.checkExactArgsCount=function(b,c,d){if(b.len()!==c)throw new ArcError(d.toLowerCase()+" expects "+c+" arguments: given "+b);};
Builtin.prototype.toString=function(){return"[builtin:"+(this.name_===null||this.name_.length===0?this.className:this.name_)+"]"};Builtin.prototype.profileName=function(){return this.toString()};Builtin.prototype.name=function(){return this.name_===""?this.className.toLowerCase():this.name_};Builtin.TYPE=Symbol.mkSym("fn");function Closure(b,c){ArcObject.call(this);this.expression_=b;this.lc_=c}Closure.prototype=new ArcObject;Closure.prototype.className="Closure";
Closure.prototype.invokef0=function(b){this.expression_.invokeN0(b,this.lc_)};Closure.prototype.invokef1=function(b,c){this.expression_.invokeN1(b,this.lc_,c)};Closure.prototype.invokef2=function(b,c,d){this.expression_.invokeN2(b,this.lc_,c,d)};Closure.prototype.invoke=function(b,c){this.expression_.invoke3(b,this.lc_,c)};Closure.prototype.type=function(){return Builtin.TYPE};Closure.prototype.toString=function(){return this.expression_.toString()};Closure.prototype.profileName=function(){return this.expression_.profileName()};
Closure.prototype.fn=function(){return this.expression_};var Evaluation={isSpecialSyntax:function(b){return b instanceof Symbol&&SSyntax.isSpecial(b)},ssExpand:function(b){return SSExpand.expand(Symbol.cast(b,"ssexpand"))},UnknownSytax:function(b){ArcError.call(this,"Unknown syntax "+b)}};Evaluation.UnknownSytax.prototype=new ArcError(void 0);Evaluation.UnknownSytax.prototype.className="Evaluation.UnknownSytax";Evaluation.isListListQuoted=function(b){return/[.!]/.test(b)};
Evaluation.isComposeComplement=function(b){return Evaluation.isCompose_(b)||Evaluation.isComplement_(b)};Evaluation.isAndf=function(b){return b.length===0?!1:b.charCodeAt(0)===SSExpand.ANDF_INTRASYM_CHAR?Evaluation.isAndf(b.substring(1)):b.charAt(b.length-1)===SSExpand.ANDF_INTRASYM_CHAR?Evaluation.isAndf(b.substring(0,b.length-1)):b.indexOf(SSExpand.ANDF_INTRASYM)!==-1};Evaluation.isComplement_=function(b){return/^~/.test(b)};Evaluation.isCompose_=function(b){return/:/.test(b)};
function InterpretedFunction(){ArcObject.call(this)}InterpretedFunction.prototype=new ArcObject;InterpretedFunction.prototype.Cons_=InterpretedFunction;InterpretedFunction.prototype.className="InterpretedFunction";InterpretedFunction.of=function(b,c,d){return(new InterpretedFunction).init(b,c,d)};
InterpretedFunction.prototype.init=function(b,c,d){this.name=ArcObject.NIL;this.parameterList_=b;this.lexicalBindings=c;this.body=d.toArray();this.localProfileName_=this.profileName_=this.curried=this.lexicalOwner_=this.instructions_=null;this.buildInstructionList_();return this};InterpretedFunction.prototype.unassigned=function(b){if(this.name===b)this.name=ArcObject.NIL};
InterpretedFunction.prototype.assigned=function(b){this.name=b;for(var b=new FunctionOwnershipVisitor(this),c=0,d=this.body.length;c<d;c++)this.body[c].visit(b)};InterpretedFunction.prototype.assignedName=function(){return name};
InterpretedFunction.prototype.profileName=function(){if(this.profileName_!==null)return this.profileName_;this.name instanceof Nil?(this.profileName_=this.toString(),this.lexicalOwner_!==null&&(this.profileName_+=" in "+this.lexicalOwner_.profileName())):this.profileName_=this.assignedName().toString();return this.profileName_};
InterpretedFunction.prototype.localProfileName=function(){return this.localProfileName_!==null?this.localProfileName_:this.localProfileName_=this.name instanceof Nil?this.toString():this.assignedName().toString()};InterpretedFunction.prototype.ownerHierarchy=function(){var b=ArcString.make(this.localProfileName());return this.lexicalOwner_!==null?new Pair(b,this.lexicalOwner_.ownerHierarchy()):new Pair(b,ArcObject.NIL)};
InterpretedFunction.prototype.lexicalDepth=function(){return this.lexicalOwner_===null?1:1+this.lexicalOwner_.lexicalDepth()};InterpretedFunction.prototype.reduce=function(){return Console.stackfunctions&&this.canIGoOnTheStack_()&&!(this.parameterList_ instanceof Nil)?FunctionBodyBuilder.convertToStackParams(this):this};InterpretedFunction.prototype.canIGoOnTheStack_=function(){return!this.hasClosures()};
InterpretedFunction.prototype.buildInstructionList_=function(){var b=[];this.buildInstructions(b);this.instructions_=Pair.buildFrom1(b);this.claimInstructions_(this)};InterpretedFunction.prototype.belongsTo=function(b){this.lexicalOwner_=b};InterpretedFunction.prototype.lexicalOwner=function(){return this.lexicalOwner_};InterpretedFunction.Visitor_claimInstructions_=function(b){Visitor.call(this);this.owner_=b};InterpretedFunction.Visitor_claimInstructions_.prototype=new Visitor;
InterpretedFunction.Visitor_claimInstructions_.prototype.acceptInstruction=function(b){b.belongsTo(this.owner_)};InterpretedFunction.prototype.claimInstructions_=function(b){this.instructions_.visit(new InterpretedFunction.Visitor_claimInstructions_(b))};InterpretedFunction.prototype.buildInstructions=function(b){if(this.body.length===0)b.push(new Literal(ArcObject.NIL));else for(var c=0;c<this.body.length;c++){var d=c===this.body.length-1;this.body[c].addInstructions(b);d||b.push(new PopArg("intermediate-fn-expression"))}};
InterpretedFunction.prototype.canInline=function(b,c){return this.body.length===1&&this.inlineableArg_(b,c)&&!this.assigns(0)&&!this.hasClosures()};InterpretedFunction.prototype.inlineableArg_=function(b,c){var d=this.lexicalBindings[b.name()],d=BoundSymbol.make(b,0,d);return c.literal()||c instanceof Quotation||c instanceof Symbol||c instanceof BoundSymbol||this.countReferences_(d)<=1};
InterpretedFunction.prototype.countReferences_=function(b){for(var b=new ReferenceCounter(b),c=0,d=this.body.length;c<d;c++)this.body[c].visit(b);return b.count()};InterpretedFunction.prototype.maybeNest_=function(b){return this.parameterList_ instanceof Nil?b:b.nest(0)};InterpretedFunction.prototype.hasClosures=function(){for(var b=0,c=this.body.length;b<c;b++){var d=this.body[b];if(d instanceof InterpretedFunction){if(d.requiresClosure())return!0}else if(d.hasClosures())return!0}return!1};
InterpretedFunction.prototype.assigned_=function(b){for(var c=0,d=this.body.length;c<d;c++)if(this.body[c].assigns(b))return!0;return!1};InterpretedFunction.prototype.nests=function(){return!(this.parameterList_ instanceof Nil)};InterpretedFunction.prototype.assigns=function(b){return this.parameterList_ instanceof Nil?this.assigned_(b):this.assigned_(b+1)};InterpretedFunction.prototype.invokef0=function(b){return this.invokeN0(b,null)};
InterpretedFunction.prototype.invokeN0=function(b,c){return this.invoke3(b,c,ArcObject.NIL)};InterpretedFunction.prototype.invokef1=function(b,c){return this.invokeN1(b,null,c)};InterpretedFunction.prototype.invokeN1=function(b,c,d){return this.invoke3(b,c,new Pair(d,ArcObject.NIL))};InterpretedFunction.prototype.invokef2=function(b,c,d){return this.invokeN2(b,null,c,d)};InterpretedFunction.prototype.invokeN2=function(b,c,d,f){return this.invoke3(b,c,new Pair(d,new Pair(f,ArcObject.NIL)))};
InterpretedFunction.prototype.invokef3=function(b,c,d,f){return this.invokeN3(b,null,c,d,f)};InterpretedFunction.prototype.invokeN3=function(b,c,d,f,g){return this.invoke3(b,c,new Pair(d,new Pair(f,new Pair(g,ArcObject.NIL))))};InterpretedFunction.prototype.invoke=function(b,c){return this.invoke3(b,null,c)};InterpretedFunction.prototype.invoke3=function(){throw new ArcError("error: invoke(vm, lc, args) not implemented in "+this.className+"; "+this);};InterpretedFunction.prototype.instructions=function(){return this.instructions_};
InterpretedFunction.prototype.addInstructions=function(b){this.requiresClosure()?b.push(new Close_Instruction(this)):b.push(new Literal(this))};InterpretedFunction.prototype.literal=function(){return!this.requiresClosure()};InterpretedFunction.prototype.requiresClosure=function(){var b=new MeasureLexicalReach;this.visit(b);return-1<b.reach()};
InterpretedFunction.prototype.visit=function(b){b.acceptInterpretedFunction(this);FunctionBodyBuilder.visit(b,this.parameterList_,!1);for(var c=0,d=this.body.length;c<d;c++)this.body[c].visit(b);b.endInterpretedFunction(this);this.curried!==null&&this.curried.visit(b)};
InterpretedFunction.prototype.isIdFn=function(){if(this.parameterList_.len()===1&&this.parameterList_.car()instanceof Symbol&&this.body.length===1&&this.body[0]instanceof BoundSymbol){var b=this.parameterList_.car(),c=this.body[0],b=BoundSymbol.make(b,0,0);return c.isSameBoundSymbol(b)}return!1};InterpretedFunction.prototype.compareTo=function(b){throw new ArcError("Can't compare "+this+" to "+b);};
InterpretedFunction.prototype.toString=function(){if(this.isBracketFn_())if(this.body[0]instanceof Nil)return"[]";else{var b=this.body[0].toString();return"["+b.substring(1,b.length-1)+"]"}return Pair.buildFrom1([Symbol.mkSym("fn"),this.parameterList()].concat(this.body)).toString()};
InterpretedFunction.prototype.isBracketFn_=function(){return this.parameterList_ instanceof Pair&&this.parameterList_.car()===Symbol.mkSym("_")&&this.parameterList_.cdr()instanceof Nil&&this.body.length===1&&!(this.body[0]instanceof LiteralObject)};InterpretedFunction.prototype.parameterList=function(){return this.parameterList_};InterpretedFunction.prototype.type=function(){return Builtin.TYPE};InterpretedFunction.prototype.nth=function(b){return this.body[b]};
InterpretedFunction.prototype.last=function(){return this.body[this.body.length-1]};InterpretedFunction.prototype.length=function(){return this.body.length};InterpretedFunction.prototype.requireNil=function(b,c){try{b.cdr().mustBeNil()}catch(d){if(!(d instanceof Pair.NotPair))throw d;this.throwArgMismatchError(c)}};InterpretedFunction.prototype.requireNotNil=function(b,c){b instanceof Nil&&this.throwArgMismatchError(c)};
InterpretedFunction.prototype.throwArgMismatchError=function(b){throw new ArcError("args "+b+" doesn't match signature for "+this);};
InterpretedFunction.prototype.curry=function(b,c,d){var f=this.lexicalBindings[b.name()];if(f===void 0)throw new ReferenceError;var g=BoundSymbol.make(b,0,f),b=FunctionParameterListBuilder.curryBound(this.parameterList_,g,c,f),h={};FunctionParameterListBuilder.index(b,h,[0],!1);var i=b instanceof Nil;!i&&d&&(c=c.nest(0));for(var d=[],j=0;j<this.body.length;j++)d.push(this.body[j].inline5(g,c,i,0,f).reduce());c=Pair.buildFrom1(d);f=FunctionParameterListBuilder.isComplex(b);return FunctionBodyBuilder.buildFunctionBody(b,
h,c,f)};InterpretedFunction.prototype.inline5=function(b,c,d,f,g){for(var b=this.maybeNest_(b),d=this.cloneThis_(),h=[],i=0;i<this.body.length;i++)h.push(this.body[i].inline5(b,c,!1,f+1,g).reduce());b=Pair.buildFrom1(h);d.body=b.toArray();d.buildInstructionList_();return d};
InterpretedFunction.prototype.inline3=function(b,c,d){if(!(this.parameterList_ instanceof Nil))return this;for(var f=this.cloneThis_(),g=[],h=0;h<this.body.length;h++)g.push(this.body[h].inline3(b,c,d).reduce());b=Pair.buildFrom1(g);f.body=b.toArray();f.buildInstructionList_();return f};
InterpretedFunction.prototype.nest=function(b){this.parameterList_ instanceof Nil||b++;for(var c=this.cloneThis_(),d=[],f=0;f<this.body.length;f++)d.push(this.body[f].nest(b));b=Pair.buildFrom1(d);c.body=b.toArray();c.buildInstructionList_();return c};InterpretedFunction.prototype.cloneThis_=function(){var b=new this.Cons_,c;for(c in this)this.hasOwnProperty(c)&&(b[c]=this[c]);return b};
InterpretedFunction.prototype.checkArgsLength=function(b,c){if(!c.hasLen(b))throw new ArcError("error: "+this+" expects "+b+" args, got "+c);};InterpretedFunction.prototype.isAifBody=function(){return this.body.length===1&&this.body[0]instanceof IfClause&&this.body[0].isAifIf()};function SimpleArgs(b,c,d){InterpretedFunction.call(this);this.init(b,c,d)}SimpleArgs.prototype=new InterpretedFunction;SimpleArgs.prototype.Cons_=SimpleArgs;SimpleArgs.prototype.className="SimpleArgs";
SimpleArgs.prototype.invoke3=function(b,c,d){var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);SimpleArgs.simple_(c,this.parameterList_,d);b.pushInvocation2(c,this.instructions_)};SimpleArgs.simple_=function(b,c,d){for(;!(c instanceof Nil);)if(c instanceof Symbol){b.add(d);break}else b.add(d.car()),d=d.cdr(),c=c.cdr()};function ComplexArgs(b,c,d){InterpretedFunction.call(this);this.init(b,c,d)}ComplexArgs.prototype=new InterpretedFunction;ComplexArgs.prototype.Cons_=ComplexArgs;
ComplexArgs.prototype.className="ComplexArgs";ComplexArgs.prototype.invoke3=function(b,c,d){var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);b.pushFrame(new ComplexArgs.Run(c,this.instructions_,this));this.complex_(b,c,this.parameterList_,d)};ComplexArgs.Run=function(b,c,d){Instruction.call(this);this.lc_=b;this.instructions_=c;this.belongsTo(d)};ComplexArgs.Run.prototype=new Instruction;ComplexArgs.Run.prototype.className="ComplexArgs.Run";
ComplexArgs.Run.prototype.operate=function(b){b.pushInvocation2(this.lc_,this.instructions_)};ComplexArgs.prototype.complex_=function(b,c,d,f){b.pushFrame(new ComplexArgs.BuildComplex(c,d,f,this))};ComplexArgs.BuildComplex=function(b,c,d,f){Instruction.call(this);this.lc_=b;this.parameters_=c;this.args_=d;this.belongsTo(f)};ComplexArgs.BuildComplex.prototype=new Instruction;ComplexArgs.BuildComplex.prototype.className="ComplexArgs.BuildComplex";
ComplexArgs.BuildComplex.prototype.operate=function(b){if(this.parameters_.isNotPair())this.parameters_ instanceof Symbol&&this.lc_.add(this.args_);else{var c=this.parameters_.car(),d=this.args_.car();b.pushFrame(new ComplexArgs.BuildComplex(this.lc_,this.parameters_.cdr(),this.args_.cdr(),this.owner()));if(c instanceof Symbol)this.lc_.add(d);else if(ComplexArgs.optional(c))c=ComplexArgs.optionalParam_(c),this.args_ instanceof Nil?(b.pushFrame(new ComplexArgs.AddToLc(this.lc_,this)),ComplexArgs.evalOptional_(b,
this.lc_,c)):this.lc_.add(d);else{try{d.mustBePairOrNil()}catch(f){if(!(f instanceof Pair.NotPair))throw f;throw new ArcError("Expected list argument for destructuring parameter "+c+", got "+d);}this.owner().complex_(b,this.lc_,c,d)}this.parameters_=this.parameters_.cdr();this.args_=this.args_.cdr()}};ComplexArgs.AddToLc=function(b,c){Instruction.call(this);this.lc_=b;this.belongsTo(c)};ComplexArgs.AddToLc.prototype=new Instruction;ComplexArgs.AddToLc.prototype.className="ComplexArgs.AddToLc";
ComplexArgs.AddToLc.prototype.operate=function(b){this.lc_.add(b.popA())};ComplexArgs.evalOptional_=function(b,c,d){var f=[];d.cdr().car().addInstructions(f);b.pushInvocation2(c,Pair.buildFrom1(f))};ComplexArgs.optional=function(b){return!(b instanceof Pair)?!1:b.car()===ComplexArgs.o_};ComplexArgs.optionalParam_=function(b){b=b.cdr();if(!(b instanceof Pair))throw new TypeError;return b};ComplexArgs.o_=Symbol.mkSym("o");function StackFunctionSupport(){InterpretedFunction.call(this)}
StackFunctionSupport.prototype=new InterpretedFunction;StackFunctionSupport.prototype.Cons_=StackFunctionSupport;StackFunctionSupport.prototype.className="StackFunctionSupport";StackFunctionSupport.of=function(b,c,d){return(new StackFunctionSupport).initStackFunctionSupport(b,c,d)};StackFunctionSupport.prototype.initStackFunctionSupport=function(b,c,d){return this.init(b,c,d)};StackFunctionSupport.prototype.canInline=function(b,c){return this.inlineableArg_(b,c)&&!this.assigns(0)};
StackFunctionSupport.prototype.inlineableArg_=function(b,c){var d=this.lexicalBindings[b.name()],d=new StackSymbol(b,d);return c.literal()||c instanceof Quotation||c instanceof Symbol||this.body.length===1&&this.body[0]instanceof StackSymbol&&d.isSameStackSymbol(this.body[0])};StackFunctionSupport.prototype.nests=function(){return!1};
StackFunctionSupport.prototype.curry=function(b,c){var d=this.lexicalBindings[b.name()],f=new StackSymbol(b,d),g=FunctionParameterListBuilder.curryStack(this.parameterList_,f,c,d),h={};FunctionParameterListBuilder.index(g,h,[0],!1);for(var i=[],j=0;j<this.body.length;j++)i.push(this.body[j].inline3(f,c,d).reduce());d=Pair.buildFrom1(i);f=FunctionParameterListBuilder.isComplex(g);return FunctionBodyBuilder.buildStackFunctionBody(g,h,d,f)};
StackFunctionSupport.convertBody=function(b,c){for(var d=Array(~~c.length),f=0;f<c.length;f++)d[f]=StackFunctionSupport.convertItem(b,c[f]);return Pair.buildFrom1(d)};StackFunctionSupport.convertItem=function(b,c){return c.replaceBoundSymbols(b)};function Bind(){InterpretedFunction.call(this)}classes["rainbow.function.interpreted.optimise.Bind"]=Bind;Bind.prototype=new InterpretedFunction;Bind.prototype.Cons_=Bind;Bind.prototype.className="Bind";Bind.of=function(b,c,d){return(new Bind).init(b,c,d)};
Bind.prototype.invokeN0=function(b,c){b.pushInvocation2(c,this.instructions_)};Bind.prototype.invoke3=function(b,c,d){try{d.mustBeNil()}catch(f){if(!(f instanceof ArcObject.NotNil))throw f;throw new ArcError("expected 0 args, got "+d);}b.pushInvocation2(c,this.instructions_)};function Bind_A(){InterpretedFunction.call(this)}classes["rainbow.function.interpreted.optimise.Bind_A"]=Bind_A;Bind_A.prototype=new InterpretedFunction;Bind_A.prototype.Cons_=Bind_A;Bind_A.prototype.className="Bind_A";
Bind_A.of=function(b,c,d){return(new Bind_A).init(b,c,d)};Bind_A.prototype.invokeN0=function(){throw new ArcError("function "+this+" expects 1 arg, got none");};Bind_A.prototype.invokeN1=function(b,c,d){var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);c.add(d);b.pushInvocation2(c,this.instructions_)};
Bind_A.prototype.invoke3=function(b,c,d){d instanceof Nil&&this.invokeN0(b,c);try{d.cdr().mustBeNil()}catch(f){if(!(f instanceof ArcObject.NotNil))throw f;throw new ArcError("expected 1 arg, got "+d+" calling "+this);}this.invokeN1(b,c,d.car())};function Bind_A_A(){InterpretedFunction.call(this)}classes["rainbow.function.interpreted.optimise.Bind_A_A"]=Bind_A_A;Bind_A_A.prototype=new InterpretedFunction;Bind_A_A.prototype.Cons_=Bind_A_A;Bind_A_A.prototype.className="Bind_A_A";
Bind_A_A.of=function(b,c,d){return(new Bind_A_A).init(b,c,d)};Bind_A_A.prototype.invokeN0=function(){throw new ArcError("error: expected 2 args, got none");};Bind_A_A.prototype.invokeN1=function(b,c,d){throw new ArcError("error: expected 2 args, got 1: "+d);};Bind_A_A.prototype.invokeN2=function(b,c,d,f){var g=0,h;for(h in this.lexicalBindings)g++;c=new LexicalClosure(g,c);c.add(d);c.add(f);b.pushInvocation2(c,this.instructions_)};
Bind_A_A.prototype.invoke3=function(b,c,d){try{d.cdr().cdr().mustBeNil()}catch(f){if(!(f instanceof ArcObject.NotNil))throw f;throw new ArcError("expected 2 args, got "+d);}this.invokeN2(b,c,d.car(),d.cdr().car())};function Bind_A_A_A(){InterpretedFunction.call(this)}classes["rainbow.function.interpreted.optimise.Bind_A_A_A"]=Bind_A_A_A;Bind_A_A_A.prototype=new InterpretedFunction;Bind_A_A_A.prototype.Cons_=Bind_A_A_A;Bind_A_A_A.prototype.className="Bind_A_A_A";
Bind_A_A_A.of=function(b,c,d){return(new Bind_A_A_A).init(b,c,d)};Bind_A_A_A.prototype.invokeN3=function(b,c,d,f,g){var h=0,i;for(i in this.lexicalBindings)h++;c=new LexicalClosure(h,c);c.add(d);c.add(f);c.add(g);b.pushInvocation2(c,this.instructions_)};Bind_A_A_A.prototype.invoke3=function(b,c,d){this.requireNil(d.cdr().cdr().cdr(),d);this.invokeN3(b,c,d.car(),d.cdr().car(),d.cdr().cdr().car())};function Bind_A_A_R(){InterpretedFunction.call(this)}
classes["rainbow.function.interpreted.optimise.Bind_A_A_R"]=Bind_A_A_R;Bind_A_A_R.prototype=new InterpretedFunction;Bind_A_A_R.prototype.Cons_=Bind_A_A_R;Bind_A_A_R.prototype.className="Bind_A_A_R";Bind_A_A_R.of=function(b,c,d){return(new Bind_A_A_R).init(b,c,d)};Bind_A_A_R.prototype.invokeN0=function(){throw new ArcError("error: expected at least 2 arg, got none");};Bind_A_A_R.prototype.invokeN1=function(b,c,d){throw new ArcError("error: expected at least 2 args, got one: "+d);};
Bind_A_A_R.prototype.invoke3=function(b,c,d){var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);c.add(d.car());c.add(d.cdr().car());c.add(d.cdr().cdr());b.pushInvocation2(c,this.instructions_)};function Bind_A_Obound(){InterpretedFunction.call(this)}classes["rainbow.function.interpreted.optimise.Bind_A_Obound"]=Bind_A_Obound;Bind_A_Obound.prototype=new InterpretedFunction;Bind_A_Obound.prototype.Cons_=Bind_A_Obound;Bind_A_Obound.prototype.className="Bind_A_Obound";
Bind_A_Obound.of=function(b,c,d){c=(new Bind_A_Obound).init(b,c,d);d=b.cdr().car().cdr().cdr().car();if(!(d instanceof BoundSymbol))throw new TypeError;c.optExpr_=d;b=b.cdr().car().cdr().car();if(!(b instanceof Symbol))throw new TypeError;if(c.canInline(b,c.optExpr_))try{var f=c.curry(b,c.optExpr_,!1);if(!(f instanceof InterpretedFunction))throw new TypeError;c.curried=f}catch(g){if(!(g instanceof Error))throw g;printStackTrace(g)}return c};
Bind_A_Obound.prototype.invokeN1=function(b,c,d){if(this.curried!==null)this.curried.invokeN1(b,c,d);else{var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);c.add(d);c.add(this.optExpr_.interpret(c));b.pushInvocation2(c,this.instructions_)}};Bind_A_Obound.prototype.invokeN2=function(b,c,d,f){var g=0,h;for(h in this.lexicalBindings)g++;c=new LexicalClosure(g,c);c.add(d);c.add(f);b.pushInvocation2(c,this.instructions_)};
Bind_A_Obound.prototype.invoke3=function(b,c,d){this.requireNotNil(d,d);var f=d.car(),g=d.cdr();g instanceof Nil?this.invokeN1(b,c,f):(this.requireNil(g.cdr(),d),this.invokeN2(b,c,f,g.car()))};function Bind_A_Oliteral(){InterpretedFunction.call(this)}classes["rainbow.function.interpreted.optimise.Bind_A_Oliteral"]=Bind_A_Oliteral;Bind_A_Oliteral.prototype=new InterpretedFunction;Bind_A_Oliteral.prototype.Cons_=Bind_A_Oliteral;Bind_A_Oliteral.prototype.className="Bind_A_Oliteral";
Bind_A_Oliteral.of=function(b,c,d){c=(new Bind_A_Oliteral).init(b,c,d);c.optExpr_=b.cdr().car().cdr().cdr().car();b=b.cdr().car().cdr().car();if(!(b instanceof Symbol))throw new TypeError;if(c.canInline(b,c.optExpr_))try{var f=c.curry(b,c.optExpr_,!1);if(!(f instanceof InterpretedFunction))throw new TypeError;c.curried=f}catch(g){if(!(g instanceof Error))throw g;printStackTrace(g)}return c};
Bind_A_Oliteral.prototype.invokeN1=function(b,c,d){if(this.curried!==null)this.curried.invokeN1(b,c,d);else{var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);c.add(d);c.add(this.optExpr_);b.pushInvocation2(c,this.instructions_)}};Bind_A_Oliteral.prototype.invokeN2=function(b,c,d,f){var g=0,h;for(h in this.lexicalBindings)g++;c=new LexicalClosure(g,c);c.add(d);c.add(f);b.pushInvocation2(c,this.instructions_)};
Bind_A_Oliteral.prototype.invoke3=function(b,c,d){this.requireNotNil(d,d);var f=d.car(),g=d.cdr();g instanceof Nil?this.invokeN1(b,c,f):(this.requireNil(g.cdr(),d),this.invokeN2(b,c,f,g.car()))};function Bind_A_Oother(){InterpretedFunction.call(this)}classes["rainbow.function.interpreted.optimise.Bind_A_Oother"]=Bind_A_Oother;Bind_A_Oother.prototype=new InterpretedFunction;Bind_A_Oother.prototype.Cons_=Bind_A_Oother;Bind_A_Oother.prototype.className="Bind_A_Oother";
Bind_A_Oother.of=function(b,c,d){c=(new Bind_A_Oother).init(b,c,d);d=[];b.cdr().car().cdr().cdr().car().addInstructions(d);c.optInstructions_=Pair.buildFrom1(d);return c};Bind_A_Oother.prototype.invokeN1=function(b,c,d){var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);c.add(d);b.pushFrame(new BindAndRun(c,this.instructions_,this));b.pushInvocation2(c,this.optInstructions_)};
Bind_A_Oother.prototype.invokeN2=function(b,c,d,f){var g=0,h;for(h in this.lexicalBindings)g++;c=new LexicalClosure(g,c);c.add(d);c.add(f);b.pushInvocation2(c,this.instructions_)};Bind_A_Oother.prototype.invoke3=function(b,c,d){this.requireNotNil(d,d);var f=d.car(),g=d.cdr();g instanceof Nil?this.invokeN1(b,c,f):(this.requireNil(g.cdr(),d),this.invokeN2(b,c,f,g.car()))};function Bind_A_R(){InterpretedFunction.call(this)}classes["rainbow.function.interpreted.optimise.Bind_A_R"]=Bind_A_R;
Bind_A_R.prototype=new InterpretedFunction;Bind_A_R.prototype.Cons_=Bind_A_R;Bind_A_R.prototype.className="Bind_A_R";Bind_A_R.of=function(b,c,d){return(new Bind_A_R).init(b,c,d)};Bind_A_R.prototype.invokeN0=function(){throw new ArcError("error: expected at least 1 arg, got none");};Bind_A_R.prototype.invoke3=function(b,c,d){var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);c.add(d.car());c.add(d.cdr());b.pushInvocation2(c,this.instructions_)};
function Bind_D_A_A_A_d(){InterpretedFunction.call(this)}classes["rainbow.function.interpreted.optimise.Bind_D_A_A_A_d"]=Bind_D_A_A_A_d;Bind_D_A_A_A_d.prototype=new InterpretedFunction;Bind_D_A_A_A_d.prototype.Cons_=Bind_D_A_A_A_d;Bind_D_A_A_A_d.prototype.className="Bind_D_A_A_A_d";Bind_D_A_A_A_d.of=function(b,c,d){return(new Bind_D_A_A_A_d).init(b,c,d)};
Bind_D_A_A_A_d.prototype.invokeN1=function(b,c,d){var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);if(!(d instanceof Pair))throw new TypeError;c.add(d.car());d=d.cdr();if(!(d instanceof Pair))throw new TypeError;c.add(d.car());d=d.cdr();if(!(d instanceof Pair))throw new TypeError;c.add(d.car());b.pushInvocation2(c,this.instructions_)};
Bind_D_A_A_A_d.prototype.invoke3=function(b,c,d){try{d.cdr().mustBeNil()}catch(f){if(!(f instanceof ArcObject.NotNil))throw f;throw new ArcError("expected 1 arg, got extra "+d.cdr()+" calling "+this);}this.invokeN1(b,c,d.car())};function Bind_D_A_A_d(){InterpretedFunction.call(this)}classes["rainbow.function.interpreted.optimise.Bind_D_A_A_d"]=Bind_D_A_A_d;Bind_D_A_A_d.prototype=new InterpretedFunction;Bind_D_A_A_d.prototype.Cons_=Bind_D_A_A_d;Bind_D_A_A_d.prototype.className="Bind_D_A_A_d";
Bind_D_A_A_d.of=function(b,c,d){return(new Bind_D_A_A_d).init(b,c,d)};Bind_D_A_A_d.prototype.invokeN1=function(b,c,d){var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);if(!(d instanceof Pair))throw new TypeError;c.add(d.car());d=d.cdr();if(!(d instanceof Pair))throw new TypeError;c.add(d.car());b.pushInvocation2(c,this.instructions_)};Bind_D_A_A_d.prototype.invoke3=function(b,c,d){this.requireNil(d.cdr(),d);this.invokeN1(b,c,d.car())};
function Bind_Obound(){InterpretedFunction.call(this)}classes["rainbow.function.interpreted.optimise.Bind_Obound"]=Bind_Obound;Bind_Obound.prototype=new InterpretedFunction;Bind_Obound.prototype.Cons_=Bind_Obound;Bind_Obound.prototype.className="Bind_Obound";Bind_Obound.of=function(b,c,d){c=(new Bind_Obound).init(b,c,d);b=b.car();if(!(b instanceof Pair))throw new TypeError;b=b.cdr().cdr().car();if(!(b instanceof BoundSymbol))throw new TypeError;c.optionalExpression_=b;return c};
Bind_Obound.prototype.invokeN0=function(b,c){var d=0,f;for(f in this.lexicalBindings)d++;c=new LexicalClosure(d,c);c.add(this.optionalExpression_.interpret(c));b.pushInvocation2(c,this.instructions_)};Bind_Obound.prototype.invokeN1=function(b,c,d){var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);c.add(d);b.pushInvocation2(c,this.instructions_)};
Bind_Obound.prototype.invoke3=function(b,c,d){if(d instanceof Nil)this.invokeN0(b,c);else{try{d.cdr().mustBeNil()}catch(f){if(!(f instanceof ArcObject.NotNil))throw f;throw new ArcError("expected 0 or 1 args, got extra "+d.cdr()+" calling "+this);}this.invokeN1(b,c,d.car())}};function Bind_Oliteral(){InterpretedFunction.call(this)}classes["rainbow.function.interpreted.optimise.Bind_Oliteral"]=Bind_Oliteral;Bind_Oliteral.prototype=new InterpretedFunction;Bind_Oliteral.prototype.Cons_=Bind_Oliteral;
Bind_Oliteral.prototype.className="Bind_Oliteral";Bind_Oliteral.of=function(b,c,d){c=(new Bind_Oliteral).init(b,c,d);c.optExpr_=b.car().cdr().cdr().car();b=b.car().cdr().car();if(!(b instanceof Symbol))throw new TypeError;if(c.canInline(b,c.optExpr_)){b=c.curry(b,c.optExpr_,!1);if(!(b instanceof InterpretedFunction))throw new TypeError;c.curried=b}return c};
Bind_Oliteral.prototype.invokeN0=function(b,c){if(this.curried!==null)this.curried.invokeN0(b,c);else{var d=0,f;for(f in this.lexicalBindings)d++;c=new LexicalClosure(d,c);c.add(this.optExpr_);b.pushInvocation2(c,this.instructions_)}};Bind_Oliteral.prototype.invokeN1=function(b,c,d){var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);c.add(d);b.pushInvocation2(c,this.instructions_)};
Bind_Oliteral.prototype.invoke3=function(b,c,d){if(d instanceof Nil)this.invokeN0(b,c);else{try{d.cdr().mustBeNil()}catch(f){if(!(f instanceof ArcObject.NotNil))throw f;throw new ArcError("expected 0 or 1 args, got extra "+d.cdr()+" calling "+this);}this.invokeN1(b,c,d.car())}};function Bind_Oother(){InterpretedFunction.call(this)}classes["rainbow.function.interpreted.optimise.Bind_Oother"]=Bind_Oother;Bind_Oother.prototype=new InterpretedFunction;Bind_Oother.prototype.Cons_=Bind_Oother;
Bind_Oother.prototype.className="Bind_Oother";Bind_Oother.of=function(b,c,d){var f=(new Bind_Oother).init(b,c,d);f.init(b,c,d);f.optExpr_=b.car().cdr().cdr().car();b=[];f.optExpr_.addInstructions(b);f.optInstructions_=Pair.buildFrom1(b);return f};Bind_Oother.prototype.invokeN0=function(b,c){var d=0,f;for(f in this.lexicalBindings)d++;c=new LexicalClosure(d,c);b.pushFrame(new BindAndRun(c,this.instructions_,this));b.pushInvocation2(c,this.optInstructions_)};
Bind_Oother.prototype.invokeN1=function(b,c,d){var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);c.add(d);b.pushInvocation2(c,this.instructions_)};Bind_Oother.prototype.invoke3=function(b,c,d){if(d instanceof Nil)this.invokeN0(b,c);else{try{d.cdr().mustBeNil()}catch(f){if(!(f instanceof ArcObject.NotNil))throw f;throw new ArcError("expected 0 or 1 args, got extra "+d.cdr()+" calling "+this);}this.invokeN1(b,c,d.car())}};function Bind_R(){InterpretedFunction.call(this)}
classes["rainbow.function.interpreted.optimise.Bind_R"]=Bind_R;Bind_R.prototype=new InterpretedFunction;Bind_R.prototype.Cons_=Bind_R;Bind_R.prototype.className="Bind_R";Bind_R.of=function(b,c,d){return(new Bind_R).init(b,c,d)};Bind_R.prototype.invoke3=function(b,c,d){var f=0,g;for(g in this.lexicalBindings)f++;c=new LexicalClosure(f,c);c.add(d);b.pushInvocation2(c,this.instructions_)};function Stack_A(){StackFunctionSupport.call(this)}
classes["rainbow.function.interpreted.optimise.stack.Stack_A"]=Stack_A;Stack_A.prototype=new StackFunctionSupport;Stack_A.prototype.Cons_=Stack_A;Stack_A.prototype.className="Stack_A";Stack_A.of1=function(b){return Stack_A.of3(b.parameterList(),b.lexicalBindings,StackFunctionSupport.convertBody(b.lexicalBindings,b.body))};Stack_A.of3=function(b,c,d){return(new Stack_A).initStackFunctionSupport(b,c,d)};Stack_A.prototype.invokef1=function(b,c){b.pushInvocation3(null,this.instructions_,[c])};
Stack_A.prototype.invokeN1=function(b,c,d){b.pushInvocation3(c,this.instructions_,[d])};Stack_A.prototype.invoke=function(b,c){this.checkArgsLength(1,c);this.invokef1(b,c.car())};Stack_A.prototype.invoke3=function(b,c,d){this.checkArgsLength(1,d);this.invokeN1(b,c,d.car())};function Stack_A_A(){StackFunctionSupport.call(this)}classes["rainbow.function.interpreted.optimise.stack.Stack_A_A"]=Stack_A_A;Stack_A_A.prototype=new StackFunctionSupport;Stack_A_A.prototype.Cons_=Stack_A_A;
Stack_A_A.prototype.className="Stack_A_A";Stack_A_A.of1=function(b){return Stack_A_A.of3(b.parameterList(),b.lexicalBindings,StackFunctionSupport.convertBody(b.lexicalBindings,b.body))};Stack_A_A.of3=function(b,c,d){return(new Stack_A_A).initStackFunctionSupport(b,c,d)};Stack_A_A.prototype.invokef2=function(b,c,d){b.pushInvocation3(null,this.instructions_,[c,d])};Stack_A_A.prototype.invokeN2=function(b,c,d,f){b.pushInvocation3(c,this.instructions_,[d,f])};
Stack_A_A.prototype.invoke=function(b,c){this.checkArgsLength(2,c);this.invokef2(b,c.car(),c.cdr().car())};Stack_A_A.prototype.invoke3=function(b,c,d){this.checkArgsLength(2,d);this.invokeN2(b,c,d.car(),d.cdr().car())};function Stack_A_A_A(){StackFunctionSupport.call(this)}classes["rainbow.function.interpreted.optimise.stack.Stack_A_A_A"]=Stack_A_A_A;Stack_A_A_A.prototype=new StackFunctionSupport;Stack_A_A_A.prototype.Cons_=Stack_A_A_A;Stack_A_A_A.prototype.className="Stack_A_A_A";
Stack_A_A_A.of1=function(b){return Stack_A_A_A.of3(b.parameterList(),b.lexicalBindings,StackFunctionSupport.convertBody(b.lexicalBindings,b.body))};Stack_A_A_A.of3=function(b,c,d){return(new Stack_A_A_A).initStackFunctionSupport(b,c,d)};Stack_A_A_A.prototype.invokef3=function(b,c,d,f){b.pushInvocation3(null,this.instructions_,[c,d,f])};Stack_A_A_A.prototype.invokeN3=function(b,c,d,f,g){b.pushInvocation3(c,this.instructions_,[d,f,g])};
Stack_A_A_A.prototype.invoke=function(b,c){this.checkArgsLength(3,c);this.invokef3(b,c.car(),c.cdr().car(),c.cdr().cdr().car())};Stack_A_A_A.prototype.invoke3=function(b,c,d){this.checkArgsLength(3,d);this.invokeN3(b,c,d.car(),d.cdr().car(),d.cdr().cdr().car())};function Stack_A_A_A_A(){StackFunctionSupport.call(this)}classes["rainbow.function.interpreted.optimise.stack.Stack_A_A_A_A"]=Stack_A_A_A_A;Stack_A_A_A_A.prototype=new StackFunctionSupport;Stack_A_A_A_A.prototype.Cons_=Stack_A_A_A_A;
Stack_A_A_A_A.prototype.className="Stack_A_A_A_A";Stack_A_A_A_A.of1=function(b){return Stack_A_A_A_A.of3(b.parameterList(),b.lexicalBindings,StackFunctionSupport.convertBody(b.lexicalBindings,b.body))};Stack_A_A_A_A.of3=function(b,c,d){return(new Stack_A_A_A_A).initStackFunctionSupport(b,c,d)};Stack_A_A_A_A.prototype.invokef4=function(b,c,d,f,g){b.pushInvocation3(null,this.instructions_,[c,d,f,g])};
Stack_A_A_A_A.prototype.invokeN4=function(b,c,d,f,g,h){b.pushInvocation3(c,this.instructions_,[d,f,g,h])};Stack_A_A_A_A.prototype.invoke=function(b,c){this.checkArgsLength(4,c);this.invokef4(b,c.car(),c.cdr().car(),c.cdr().cdr().car(),c.cdr().cdr().cdr().car())};Stack_A_A_A_A.prototype.invoke3=function(b,c,d){this.checkArgsLength(4,d);this.invokeN4(b,c,d.car(),d.cdr().car(),d.cdr().cdr().car(),d.cdr().cdr().cdr().car())};function Stack_A_A_R(){StackFunctionSupport.call(this)}
classes["rainbow.function.interpreted.optimise.stack.Stack_A_A_R"]=Stack_A_A_R;Stack_A_A_R.prototype=new StackFunctionSupport;Stack_A_A_R.prototype.Cons_=Stack_A_A_R;Stack_A_A_R.prototype.className="Stack_A_A_R";Stack_A_A_R.of1=function(b){return Stack_A_A_R.of3(b.parameterList(),b.lexicalBindings,StackFunctionSupport.convertBody(b.lexicalBindings,b.body))};Stack_A_A_R.of3=function(b,c,d){return(new Stack_A_A_R).initStackFunctionSupport(b,c,d)};
Stack_A_A_R.prototype.invoke3=function(b,c,d){b.pushInvocation3(c,this.instructions_,[d.car(),d.cdr().car(),d.cdr().cdr()])};function Stack_A_R(){StackFunctionSupport.call(this)}classes["rainbow.function.interpreted.optimise.stack.Stack_A_R"]=Stack_A_R;Stack_A_R.prototype=new StackFunctionSupport;Stack_A_R.prototype.Cons_=Stack_A_R;Stack_A_R.prototype.className="Stack_A_R";
Stack_A_R.of1=function(b){return Stack_A_R.of3(b.parameterList(),b.lexicalBindings,StackFunctionSupport.convertBody(b.lexicalBindings,b.body))};Stack_A_R.of3=function(b,c,d){return(new Stack_A_R).initStackFunctionSupport(b,c,d)};Stack_A_R.prototype.invoke3=function(b,c,d){b.pushInvocation3(c,this.instructions_,[d.car(),d.cdr()])};function Stack_R(){StackFunctionSupport.call(this)}classes["rainbow.function.interpreted.optimise.stack.Stack_R"]=Stack_R;Stack_R.prototype=new StackFunctionSupport;
Stack_R.prototype.Cons_=Stack_R;Stack_R.prototype.className="Stack_R";Stack_R.of1=function(b){return Stack_R.of3(b.parameterList(),b.lexicalBindings,StackFunctionSupport.convertBody(b.lexicalBindings,b.body))};Stack_R.of3=function(b,c,d){return(new Stack_R).initStackFunctionSupport(b,c,d)};Stack_R.prototype.invoke3=function(b,c,d){b.pushInvocation3(c,this.instructions_,[d])};function Stack_D_A_A_A_A_d(){StackFunctionSupport.call(this)}
classes["rainbow.function.interpreted.optimise.stack.Stack_D_A_A_A_A_d"]=Stack_D_A_A_A_A_d;Stack_D_A_A_A_A_d.prototype=new StackFunctionSupport;Stack_D_A_A_A_A_d.prototype.Cons_=Stack_D_A_A_A_A_d;Stack_D_A_A_A_A_d.prototype.className="Stack_D_A_A_A_A_d";Stack_D_A_A_A_A_d.of1=function(b){return Stack_D_A_A_A_A_d.of3(b.parameterList(),b.lexicalBindings,StackFunctionSupport.convertBody(b.lexicalBindings,b.body))};
Stack_D_A_A_A_A_d.of3=function(b,c,d){return(new Stack_D_A_A_A_A_d).initStackFunctionSupport(b,c,d)};Stack_D_A_A_A_A_d.prototype.invokef1=function(b,c){b.pushInvocation3(null,this.instructions_,[c.car(),c.cdr().car(),c.cdr().cdr().car(),c.cdr().cdr().cdr().car()])};Stack_D_A_A_A_A_d.prototype.invokeN1=function(b,c,d){b.pushInvocation3(c,this.instructions_,[d.car(),d.cdr().car(),d.cdr().cdr().car(),d.cdr().cdr().cdr().car()])};
Stack_D_A_A_A_A_d.prototype.invoke=function(b,c){this.checkArgsLength(1,c);this.invokef1(b,c.car())};Stack_D_A_A_A_A_d.prototype.invoke3=function(b,c,d){this.checkArgsLength(1,d);this.invokeN1(b,c,d.car())};function Stack_D_A_A_d(){StackFunctionSupport.call(this)}classes["rainbow.function.interpreted.optimise.stack.Stack_D_A_A_d"]=Stack_D_A_A_d;Stack_D_A_A_d.prototype=new StackFunctionSupport;Stack_D_A_A_d.prototype.Cons_=Stack_D_A_A_d;Stack_D_A_A_d.prototype.className="Stack_D_A_A_d";
Stack_D_A_A_d.of1=function(b){return Stack_D_A_A_d.of3(b.parameterList(),b.lexicalBindings,StackFunctionSupport.convertBody(b.lexicalBindings,b.body))};Stack_D_A_A_d.of3=function(b,c,d){return(new Stack_D_A_A_d).initStackFunctionSupport(b,c,d)};Stack_D_A_A_d.prototype.invokef1=function(b,c){b.pushInvocation3(null,this.instructions_,[c.car(),c.cdr().car()])};Stack_D_A_A_d.prototype.invokeN1=function(b,c,d){b.pushInvocation3(c,this.instructions_,[d.car(),d.cdr().car()])};
Stack_D_A_A_d.prototype.invoke=function(b,c){this.checkArgsLength(1,c);this.invokef1(b,c.car())};Stack_D_A_A_d.prototype.invoke3=function(b,c,d){this.checkArgsLength(1,d);this.invokeN1(b,c,d.car())};function Stack_A_Oliteral(){StackFunctionSupport.call(this)}classes["rainbow.function.interpreted.optimise.stack.Stack_A_Oliteral"]=Stack_A_Oliteral;Stack_A_Oliteral.prototype=new StackFunctionSupport;Stack_A_Oliteral.prototype.Cons_=Stack_A_Oliteral;Stack_A_Oliteral.prototype.className="Stack_A_Oliteral";
Stack_A_Oliteral.of1=function(b){b=(new Stack_A_Oliteral).initStackFunctionSupport(b.parameterList(),b.lexicalBindings,StackFunctionSupport.convertBody(b.lexicalBindings,b.body));b.optExpr_=b.parameterList_.cdr().car().cdr().cdr().car();var c=b.parameterList_.cdr().car().cdr().car();if(!(c instanceof Symbol))throw new TypeError;if(b.canInline(c,b.optExpr_)){c=b.curry(c,b.optExpr_,!1);if(!(c instanceof InterpretedFunction))throw new TypeError;b.curried=c}return b};
Stack_A_Oliteral.of3=function(b,c,d){c=(new Stack_A_Oliteral).initStackFunctionSupport(b,c,d);c.optExpr_=b.car().cdr().cdr().car();return c};Stack_A_Oliteral.prototype.invokef1=function(b,c){this.curried!==null?this.curried.invokef1(b,c):b.pushInvocation3(null,this.instructions_,[c,this.optExpr_])};Stack_A_Oliteral.prototype.invokef2=function(b,c,d){b.pushInvocation3(null,this.instructions_,[c,d])};
Stack_A_Oliteral.prototype.invokeN1=function(b,c,d){this.curried!==null?this.curried.invokeN1(b,c,d):b.pushInvocation3(c,this.instructions_,[d,this.optExpr_])};Stack_A_Oliteral.prototype.invokeN2=function(b,c,d,f){b.pushInvocation3(c,this.instructions_,[d,f])};Stack_A_Oliteral.prototype.invoke=function(b,c){if(c instanceof Nil)this.throwArgMismatchError(c);else{var d=c.car();c.cdr()instanceof Nil?this.invokef1(b,d):this.invokef2(b,d,c.cdr().car())}};
Stack_A_Oliteral.prototype.invoke3=function(b,c,d){if(d instanceof Nil)this.throwArgMismatchError(d);else{var f=d.car();d.cdr()instanceof Nil?this.invokeN1(b,c,f):this.invokeN(b,c,f,d.cdr().car())}};function Stack_Oliteral(){StackFunctionSupport.call(this)}classes["rainbow.function.interpreted.optimise.stack.Stack_Oliteral"]=Stack_Oliteral;Stack_Oliteral.prototype=new StackFunctionSupport;Stack_Oliteral.prototype.Cons_=Stack_Oliteral;Stack_Oliteral.prototype.className="Stack_Oliteral";
Stack_Oliteral.of1=function(b){b=(new Stack_Oliteral).initStackFunctionSupport(b.parameterList(),b.lexicalBindings,StackFunctionSupport.convertBody(b.lexicalBindings,b.body));b.optExpr_=b.parameterList_.car().cdr().cdr().car();var c=b.parameterList_.car().cdr().car();if(!(c instanceof Symbol))throw new TypeError;if(b.canInline(c,b.optExpr_)){c=b.curry(c,b.optExpr_,!1);if(!(c instanceof InterpretedFunction))throw new TypeError;b.curried=c}return b};
Stack_Oliteral.of3=function(b,c,d){c=(new Stack_Oliteral).initStackFunctionSupport(b,c,d);c.optExpr_=b.car().cdr().cdr().car();return c};Stack_Oliteral.prototype.invokef0=function(b){this.curried!==null?this.curried.invokef1(b):b.pushInvocation3(null,this.instructions_,[this.optExpr_])};Stack_Oliteral.prototype.invokef1=function(b,c){b.pushInvocation3(null,this.instructions_,[c])};
Stack_Oliteral.prototype.invokeN0=function(b,c){this.curried!==null?this.curried.invokeN1(b,c):b.pushInvocation3(c,this.instructions_,[this.optExpr_])};Stack_Oliteral.prototype.invokeN1=function(b,c,d){b.pushInvocation3(c,this.instructions_,[d])};Stack_Oliteral.prototype.invoke=function(b,c){c instanceof Nil?this.invokef0(b):(this.checkArgsLength(1,c),this.invokef1(b,c.car()))};
Stack_Oliteral.prototype.invoke3=function(b,c,d){d instanceof Nil?this.invokeN0(b):(this.checkArgsLength(1,d),this.invokeN1(b,c,d.car()))};function Macex(){Builtin.call(this);this.init("macex")}Macex.prototype=new Builtin;Macex.prototype.className="Macex";
Macex.prototype.invoke=function(b,c){if(c instanceof Nil)b.pushA(ArcObject.NIL);else{var d=c.car();if(d instanceof Pair){var f=d.car();if(f instanceof Symbol)if(f.bound())if(f=f.value(),f=Tagged.ifTagged(f,"mac"),f===null)b.pushA(d);else{d=d.cdr();if(!(d instanceof Pair))throw new TypeError;b.pushFrame(new Macex.Again(this));f.invokeAndWait(b,d)}else b.pushA(d);else b.pushA(d)}else b.pushA(d)}};Macex.Again=function(b){Instruction.call(this);this.belongsTo(b)};Macex.Again.prototype=new Instruction;
Macex.Again.prototype.className="Macex.Again";Macex.Again.prototype.operate=function(b){this.owner().invoke(b,new Pair(b.popA(),ArcObject.NIL))};function Uniq(){Builtin.call(this);this.init("uniq")}Uniq.prototype=new Builtin;Uniq.prototype.className="Uniq";Uniq.prototype.invokef1=function(b){b.pushA(Symbol.mkSym("gs"+ ++Uniq.count_))};
Uniq.prototype.invokePair=function(b){try{b.mustBeNil()}catch(c){if(!(c instanceof ArcObject.NotNil))throw new ArcError("uniq: expects no args, got "+b);}return Symbol.mkSym("gs"+ ++Uniq.count_)};Uniq.count_=0;function Details(){Builtin.call(this);this.init("details")}Details.prototype=new Builtin;Details.prototype.className="Details";Details.prototype.invokePair=function(b){return ArcException.cast(b.car(),this).message()};function Err(){Builtin.call(this);this.init("err")}Err.prototype=new Builtin;
Err.prototype.className="Err";Err.prototype.invokePair=function(b){throw new ArcError(ArcString.cast(b.car(),this).value());};function OnErr(){Builtin.call(this);this.init("on-err")}OnErr.prototype=new Builtin;OnErr.prototype.className="OnErr";OnErr.prototype.invokePair=function(b){var c=new Catch(b.car(),vm.getAp());c.belongsTo(this);vm.pushFrame(c);b.cdr().car().invoke(vm,ArcObject.NIL)};function Protect(){Builtin.call(this);this.init("protect");this.v_=new Protect.Anon_v_(this)}
Protect.prototype=new Builtin;Protect.prototype.className="Protect";Protect.Anon_v_=function(b){this.this_Protect_=b};Protect.Anon_v_.prototype=new Visitor;Protect.Anon_v_.prototype.acceptInstruction=function(b){b.belongsTo(this.this_Protect_)};Protect.prototype.invoke=function(b,c){var d=new Pair(new FinallyInvoke(c.cdr().car()),new Pair(new PopArg("clear up 'protect/after' return value"),ArcObject.NIL));d.visit(this.v_);b.pushInvocation2(null,d);c.car().invoke(b,ArcObject.NIL)};
function Apply(){Builtin.call(this);this.init("apply")}Apply.prototype=new Builtin;Apply.prototype.className="Apply";Apply.prototype.invokef0=function(){throw new ArcError("apply: expects at least 2 args, got none");};Apply.prototype.invokef1=function(b,c){throw new ArcError("apply: expects at least 2 args, got "+c);};Apply.prototype.invokef2=function(b,c,d){if(!(d instanceof Pair))throw new TypeError;c.invoke(b,d)};Apply.prototype.invokef3=function(b,c,d,f){c.invoke(b,new Pair(d,f))};
Apply.prototype.invoke=function(b,c){var d=c.car(),f=c.cdr();if(!(f instanceof Pair))throw new TypeError;d.invoke(b,this.constructApplyArgs_(f))};Apply.prototype.constructApplyArgs_=function(b){return b.cdr()instanceof Nil?Pair.cast(b.car(),this):new Pair(b.car(),this.constructApplyArgs_(Pair.cast(b.cdr(),this)))};function Eval(){Builtin.call(this);this.init("eval")}Eval.prototype=new Builtin;Eval.prototype.className="Eval";
Eval.prototype.invoke=function(b,c){b.pushFrame(new Eval.ReduceAndExecute(this));Compiler.compile(b,c.car(),[])};Eval.ReduceAndExecute=function(b){Instruction.call(this);this.belongsTo(b)};Eval.ReduceAndExecute.prototype=new Instruction;Eval.ReduceAndExecute.prototype.className="Eval.ReduceAndExecute";Eval.ReduceAndExecute.prototype.operate=function(b){var c=[];b.popA().reduce().addInstructions(c);b.pushInvocation2(null,Pair.buildFrom1(c))};
function SSExpand(){Builtin.call(this);this.init("ssexpand")}SSExpand.prototype=new Builtin;SSExpand.prototype.className="SSExpand";SSExpand.prototype.invokePair=function(b){return SSExpand.expand(Symbol.cast(b.car(),this))};
SSExpand.expand=function(b){b=b.name();if(Evaluation.isComposeComplement(b))return SSExpand.expandCompose_(b);else if(Evaluation.isAndf(b))return SSExpand.expandAndf_(b);else if(Evaluation.isListListQuoted(b))return SSExpand.expandExpression_(b);else throw new ArcError("Unknown syntax "+b);};SSExpand.expandAndf_=function(b){for(var c=[Symbol.mkSym("andf")],d=0,b=SSExpand.andToks_(b).length;d<b;d++){var f=Symbol.make(s);if(!(f instanceof Symbol))throw new TypeError;c.add(SSExpand.readValueObject_(f))}return Pair.buildFrom1(c)};
SSExpand.andToks_=function(b){return b.length===0?[""]:b.charCodeAt(0)===SSExpand.ANDF_INTRASYM_CHAR?(b=SSExpand.andToks_(b.substring(1)),b[0]=SSExpand.ANDF_INTRASYM+b[0],b):b.charCodeAt(b.length-1)===SSExpand.ANDF_INTRASYM_CHAR?(b=SSExpand.andToks_(b.substring(0,b.length-1)),b[b.length-1]+=SSExpand.ANDF_INTRASYM,b):b.split(SSExpand.ANDF_INTRASYM)};
SSExpand.expandToks_=function(b,c){var d=SSExpand.readValueObject_(b[c++]),f=null;if(c<b.length&&(f=b[c++],!(f instanceof Symbol)))throw new TypeError;d=f===Symbol.BANG?Pair.buildFrom1([Symbol.mkSym("quote"),d]):d;return c<b.length?Pair.buildFrom1([SSExpand.expandToks_(b,c),d]):f!==null?Pair.buildFrom1([Symbol.mkSym("get"),d]):d};
SSExpand.readValueString_=function(b){try{return ArcParser.readFirstObjectFromString(b)}catch(c){if(!(c instanceof ParseException))throw c;throw new ArcError("Couldn't read value of symbol: "+b,c);}};SSExpand.readValueObject_=function(b){if(b instanceof Nil)return b;if(!(b instanceof Symbol))throw new TypeError;return SSExpand.readValueString_(b.name())};
SSExpand.expandExpression_=function(b){for(var c=b.replace(/#/g,"#h").replace(/%/g,"#p").replace(/([.!])/g,"%$1%").split(/%+/),d=[],f=!1,g=0,h=c.length;g<h;g++)if(c[g]!==""){var i=Symbol.make(c[g].replace(/#p/g,"%").replace(/#h/g,"#"));if(SSExpand.isSpecialListSyntax_(i))if(f)throw new ArcError("Bad syntax "+b);else f=!0;else f=!1;d.unshift(i)}f&&d.unshift(Symbol.mkSym("#<eof>"));return SSExpand.expandToks_(d,0)};SSExpand.isSpecialListSyntax_=function(b){return b===Symbol.DOT||b===Symbol.BANG};
SSExpand.expandCompose_=function(b){b=b.split(":");if(b.length===1)return SSExpand.possiblyComplement_(b[0]);for(var c=[Symbol.mkSym("compose")],d=0,f=b.length;d<f;d++)c.push(SSExpand.possiblyComplement_(b[d]));return Pair.buildFrom2(c,ArcObject.NIL)};SSExpand.possiblyComplement_=function(b){return/^~/.test(b)?Pair.buildFrom1([Symbol.mkSym("complement"),SSExpand.readValueString_(b.substring(1))]):SSExpand.readValueString_(b)};SSExpand.ANDF_INTRASYM="&";SSExpand.ANDF_INTRASYM_CHAR="&".charCodeAt(0);
function SSyntax(){Builtin.call(this);this.init("ssyntax")}SSyntax.prototype=new Builtin;SSyntax.prototype.className="SSyntax";SSyntax.prototype.invokePair=function(b){return b.car()instanceof Symbol&&SSyntax.isSpecial(b.car())?ArcObject.T:ArcObject.NIL};SSyntax.isSpecial=function(b){return Evaluation.isComposeComplement(b.name())||Evaluation.isAndf(b.name())||Evaluation.isListListQuoted(b.name())};function JavaDebug(){Builtin.call(this);this.init("java-debug")}JavaDebug.prototype=new Builtin;
JavaDebug.prototype.className="JavaDebug";JavaDebug.prototype.invokePair=function(b){return b.car()};function Car(){Builtin.call(this);this.init("car")}Car.prototype=new Builtin;Car.prototype.className="Car";Car.prototype.invokef1=function(b,c){b.pushA(c.car())};Car.prototype.invokePair=function(b){Builtin.checkExactArgsCount(b,1,this.className);return b.car().car()};function Cdr(){Builtin.call(this);this.init("cdr")}Cdr.prototype=new Builtin;Cdr.prototype.className="Cdr";
Cdr.prototype.invokef1=function(b,c){b.pushA(c.cdr())};Cdr.prototype.invokePair=function(b){Builtin.checkExactArgsCount(b,1,this.className);return b.car().cdr()};function Cons(){Builtin.call(this);this.init("cons")}Cons.prototype=new Builtin;Cons.prototype.className="Cons";Cons.prototype.invokef2=function(b,c,d){b.pushA(new Pair(c,d))};Cons.prototype.invokePair=function(b){Builtin.checkExactArgsCount(b,2,this.className);return new Pair(b.car(),b.cdr().car())};
function Len(){Builtin.call(this);this.init("len")}Len.prototype=new Builtin;Len.prototype.className="Len";Len.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,1);return new Rational(b.car().len(),1)};function NewString(){Builtin.call(this);this.init("newstring")}NewString.prototype=new Builtin;NewString.prototype.className="NewString";
NewString.prototype.invokePair=function(b){var c=b.car();if(!(c instanceof ArcNumber))throw new TypeError;var d=ArcCharacter.NULL;if(!(b.cdr()instanceof Nil)&&(d=b.cdr().car(),!(d instanceof ArcCharacter)))throw new TypeError;for(var b=[],f=0;f<c.toInt();f++)b.push(d.value());return ArcString.make(b.join(""))};function Scar(){Builtin.call(this);this.init("scar")}Scar.prototype=new Builtin;Scar.prototype.className="Scar";Scar.prototype.invokef2=function(b,c,d){vm.pushA(c.scar(d))};
Scar.prototype.invokePair=function(b){return b.car().scar(b.cdr().car())};function Scdr(){Builtin.call(this);this.init("scdr")}Scdr.prototype=new Builtin;Scdr.prototype.className="Scdr";Scdr.prototype.invokePair=function(b){var c=b.car();if(!(c instanceof Pair))throw new TypeError;b=b.cdr().car();c.setCdr(b);return b};function Acos(){Builtin.call(this);this.init("acos")}Acos.prototype=new Builtin;Acos.prototype.className="Acos";
Acos.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,1);b=Math.acos(ArcNumber.cast(b.car(),this).toDouble());return new Real(b)};function Add(){Builtin.call(this);this.init("+")}Add.prototype=new Builtin;Add.prototype.className="Add";Add.prototype.invokef0=function(b){b.pushA(Rational.ZERO)};Add.prototype.invokef1=function(b,c){b.pushA(c)};Add.prototype.invokef2=function(b,c,d){b.pushA(c.add(d))};Add.prototype.invokef3=function(b,c,d,f){b.pushA(c.add(d).add(f))};
Add.prototype.invokePair=function(b){if(b instanceof Nil)return Rational.ZERO;for(var c=b.car(),b=b.cdr();!(b instanceof Nil);)c=c.add(b.car()),b=b.cdr();return c};Add.sum=function(b){return Maths.precision(b).sum(b)};function Asin(){Builtin.call(this);this.init("asin")}Asin.prototype=new Builtin;Asin.prototype.className="Asin";Asin.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,1);b=Math.asin(ArcNumber.cast(b.car(),this).toDouble());return new Real(b)};
function Atan(){Builtin.call(this);this.init("atan")}Atan.prototype=new Builtin;Atan.prototype.className="Atan";Atan.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,1);b=Math.atan(ArcNumber.cast(b.car(),this).toDouble());return new Real(b)};function ComplexParts(){Builtin.call(this);this.init("complex-parts")}ComplexParts.prototype=new Builtin;ComplexParts.prototype.className="ComplexParts";
ComplexParts.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,1);b=Complex.cast(b.car(),this);return Pair.buildFrom1([b.realPart(),b.imaginaryPart()])};function Cosine(){Builtin.call(this);this.init("cos")}Cosine.prototype=new Builtin;Cosine.prototype.className="Cosine";Cosine.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,1);b=Math.cos(ArcNumber.cast(b.car(),this).toDouble());return new Real(b)};
function Divide(){Builtin.call(this);this.init("/")}Divide.prototype=new Builtin;Divide.prototype.className="Divide";Divide.prototype.invokePair=function(b){if(b instanceof Nil)throw new ArcError("Function `/` expected at least 1 arg");return Maths.precision(b).divide(b)};function Expt(){Builtin.call(this);this.init("expt")}Expt.prototype=new Builtin;Expt.prototype.className="Expt";
Expt.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,2);var c=b.car();if(!(c instanceof ArcNumber))throw new TypeError;b=b.cdr().car();if(!(b instanceof ArcNumber))throw new TypeError;return c instanceof Complex?c.expt(b):b instanceof Complex?(new Complex(c.toDouble(),0)).expt(b):(c=c.toDouble(),b=b.toDouble(),new Real(Math.pow(c,b)))};function Logarithm(){Builtin.call(this);this.init("log")}Logarithm.prototype=new Builtin;Logarithm.prototype.className="Logarithm";
Logarithm.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,1);b=ArcNumber.cast(b.car(),this);return b instanceof Complex?b.log():new Real(Math.log(b.toDouble()))};function MakeComplex(){Builtin.call(this);this.init("make-complex")}MakeComplex.prototype=new Builtin;MakeComplex.prototype.className="MakeComplex";
MakeComplex.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,2);var c=ArcNumber.cast(b.car(),this),b=ArcNumber.cast(b.cdr().car(),this);return new Complex(c.toDouble(),b.toDouble())};var Maths={random:{}};Maths.random.nextDouble=function(){return Math.rand()};Maths.random.nextLong=function(){for(;;){var b=Math.floor(Math.rand()*9007199254740992);if(b<9007199254740992)return b}};
Maths.precision=function(b){if(b instanceof Nil)return Maths.rationalOps_;else if(b.car()instanceof Real)return Maths.doubleOps_;else if(b.car()instanceof Complex)return complexOps;else{if(!(b.cdr()instanceof Pair))throw new TypeError;return Maths.precision(b.cdr())}};Maths.MathsOps=function(){};Maths.MathsOps.prototype.sum=void 0;Maths.MathsOps.prototype.multiply=void 0;Maths.MathsOps.prototype.divide=void 0;Maths.Anon_doubleOps_=function(){Maths.MathsOps.call(this)};
Maths.Anon_doubleOps_.prototype=new Maths.MathsOps;Maths.Anon_doubleOps_.prototype.sum=function(b){return Real.make(this.sumNumbers_(b))};Maths.Anon_doubleOps_.prototype.sumNumbers_=function(b){if(b instanceof Nil)return 0;var c=b.car();if(!(c instanceof ArcNumber))throw new TypeError;c=c.toDouble();b=b.cdr();if(!(b instanceof Pair))throw new TypeError;return c+this.sumNumbers_(b)};Maths.Anon_doubleOps_.prototype.multiply=function(b){return Real.make(this.multiplyDouble_(b))};
Maths.Anon_doubleOps_.prototype.divide=function(b){var c=b.cdr(),d=b.car();if(!(d instanceof ArcNumber))throw new TypeError;c=c instanceof Nil?1/d.toDouble():d.toDouble();b=b.cdr();if(!(b instanceof Pair))throw new TypeError;return Real.make(c/this.multiplyDouble_(b))};
Maths.Anon_doubleOps_.prototype.multiplyDouble_=function(b){if(b instanceof Nil)return 1;var c=b.car();if(!(c instanceof ArcNumber))throw new TypeError;c=c.toDouble();b=b.cdr();if(!(b instanceof Pair))throw new TypeError;b=this.multiplyDouble_(b);return c*b};Maths.doubleOps_=new Maths.Anon_doubleOps_;Maths.Anon_complexOps_=function(){Maths.MathsOps.call(this)};Maths.Anon_complexOps_.prototype=new Maths.MathsOps;
Maths.Anon_complexOps_.prototype.sum=function(b){if(b instanceof Nil)return Complex.ZERO;var c=Complex.make(b.car()),b=b.cdr();if(!(b instanceof Pair))throw new TypeError;return c.plusComplex(this.sum(b))};Maths.Anon_complexOps_.prototype.multiply=function(b){if(b instanceof Nil)return new Complex(1,0);var c=Complex.make(b.car()),b=b.cdr();if(!(b instanceof Pair))throw new TypeError;return c.timesComplex(this.multiply(b))};
Maths.Anon_complexOps_.prototype.divide=function(b){var c=Complex.make(b.car()),b=b.cdr();if(!(b instanceof Pair))throw new TypeError;return c.timesComplex(this.multiply(b).inverse())};Maths.complexOps_=new Maths.Anon_complexOps_;Maths.Anon_rationalOps_=function(){Maths.MathsOps.call(this)};Maths.Anon_rationalOps_.prototype=new Maths.MathsOps;
Maths.Anon_rationalOps_.prototype.sum=function(b){if(b instanceof Nil)return Rational.ZERO;else{var c=b.car();if(!(c instanceof Rational))throw new TypeError;b=b.cdr();if(!(b instanceof Pair))throw new TypeError;return c.plus(this.sum(b))}};Maths.Anon_rationalOps_.prototype.multiply=function(b){if(b instanceof Nil)return Rational.ONE;var c=b.car();if(!(c instanceof Rational))throw new TypeError;b=b.cdr();if(!(b instanceof Pair))throw new TypeError;return c.times(this.multiply(b))};
Maths.Anon_rationalOps_.prototype.divide=function(b){var c=b.cdr(),d=b.car();if(!(d instanceof Rational))throw new TypeError;c=c instanceof Nil?d.invert():d;b=b.cdr();if(!(b instanceof Pair))throw new TypeError;return c.times(this.multiply(b).invert())};Maths.rationalOps_=new Maths.Anon_rationalOps_;function Mod(){Builtin.call(this);this.init("mod")}Mod.prototype=new Builtin;Mod.prototype.className="Mod";
Mod.prototype.invokef2=function(b,c,d){if(!(c instanceof ArcNumber))throw new TypeError;if(!(d instanceof ArcNumber))throw new TypeError;b.pushA(c.mod(d))};Mod.prototype.invoke=function(b,c){Builtin.checkMaxArgCount(c,this.className,2);this.invokef2(b,c.car(),c.cdr().car())};function Multiply(){Builtin.call(this);this.init("*")}Multiply.prototype=new Builtin;Multiply.prototype.className="Multiply";Multiply.prototype.invokef0=function(b){b.pushA(Rational.ONE)};
Multiply.prototype.invokef1=function(b,c){b.pushA(c)};Multiply.prototype.invokef2=function(b,c,d){b.pushA(c.multiply(d))};Multiply.prototype.invokef3=function(b,c,d,f){b.pushA(c.multiply(d).multiply(f))};Multiply.prototype.invokePair=function(b){if(b instanceof Nil)return Rational.ONE;for(var c=b.car(),b=b.cdr();!(b instanceof Nil);)c=c.multiply(b.car()),b=b.cdr();return c};function PolarCoordinates(){Builtin.call(this);this.init("polar-coordinates")}PolarCoordinates.prototype=new Builtin;
PolarCoordinates.prototype.className="PolarCoordinates";PolarCoordinates.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,1);b=Complex.cast(b.car(),this);return Pair.buildFrom1([new Real(b.radius()),new Real(b.theta())])};function Quotient(){Builtin.call(this);this.init("quotient")}Quotient.prototype=new Builtin;Quotient.prototype.className="Quotient";
Quotient.prototype.invokePair=function(b){Builtin.checkExactArgsCount(b,2,this.className);var c=Rational.cast(b.car(),this),d=Rational.cast(b.cdr().car(),this);if(!c.isInteger()||!d.isInteger())throw new ArcError("Type error: "+this+" : expected integer, got "+b);b=c.toInt()/d.toInt();return Rational.make1(b<0?Math.ceil(b):Math.floor(b))};function Rand(){Builtin.call(this);this.init("rand")}Rand.prototype=new Builtin;Rand.prototype.className="Rand";
Rand.prototype.invokePair=function(b){if(b instanceof Nil)return new Real(Maths.random.nextDouble());else{var c=b.car();if(!(c instanceof ArcNumber))throw new TypeError;if(!c.isInteger())throw new ArcError("rand: requires one exact integer argument, got "+b);return new Rational(Math.abs(Maths.random.nextLong()%c.toInt()),1)}};function Sine(){Builtin.call(this);this.init("sin")}Sine.prototype=new Builtin;Sine.prototype.className="Sine";
Sine.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,1);b=Math.sin(ArcNumber.cast(b.car(),this).toDouble());return new Real(b)};function Sqrt(){Builtin.call(this);this.init("sqrt")}Sqrt.prototype=new Builtin;Sqrt.prototype.className="Sqrt";Sqrt.prototype.invokef1=function(b,c){b.pushA(c.sqrt())};Sqrt.prototype.invoke=function(b,c){Builtin.checkExactArgsCount(c,1,this.className);this.invokef1(b,c.car())};function Subtract(){Builtin.call(this);this.init("-")}
Subtract.prototype=new Builtin;Subtract.prototype.className="Subtract";Subtract.prototype.invokef1=function(){throw new ArcError("- : expected at least 1 arg");};Subtract.prototype.invokef1=function(b,c){if(!(c instanceof ArcNumber))throw new TypeError;b.pushA(c.negate())};Subtract.prototype.invokef2=function(b,c,d){if(!(d instanceof ArcNumber))throw new TypeError;b.pushA(c.add(d.negate()))};
Subtract.prototype.invokePair=function(b){if(b instanceof Nil)throw new ArcError("Function `-` expected at least 1 arg");var c=b.car();if(!(c instanceof ArcNumber))throw new TypeError;c=c.negate();b=b.cdr();if(!(b instanceof Pair))throw new TypeError;return b instanceof Nil?c:Add.sum(new Pair(c,b)).negate()};function Tangent(){Builtin.call(this);this.init("tan")}Tangent.prototype=new Builtin;Tangent.prototype.className="Tangent";
Tangent.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,1);b=Math.tan(ArcNumber.cast(b.car(),this).toDouble());return new Real(b)};function Trunc(){Builtin.call(this);this.init("trunc")}Trunc.prototype=new Builtin;Trunc.prototype.className="Trunc";Trunc.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,1);b=b.car();if(!(b instanceof ArcNumber))throw new TypeError;b=b.toDouble();return new Rational(Math.floor(b),1)};
function Bound(){Builtin.call(this);this.init("bound")}Bound.prototype=new Builtin;Bound.prototype.className="Bound";Bound.prototype.invokef0=function(){throw new ArcError("bound: requires 1 arg");};Bound.prototype.invokef1=function(b,c){if(!(c instanceof Symbol))throw new TypeError;b.pushA(Truth.valueOf(c.bound()))};Bound.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,1);b=Symbol.cast(b.car(),this);return Truth.valueOf(b.bound())};
function Exact(){Builtin.call(this);this.init("exact")}Exact.prototype=new Builtin;Exact.prototype.className="Exact";Exact.prototype.invokePair=function(b){b=ArcNumber.cast(b.car(),this);return Truth.valueOf(b instanceof Rational&&b.isInteger())};function GreaterThan(){Builtin.call(this);this.init(">")}GreaterThan.prototype=new Builtin;GreaterThan.prototype.className="GreaterThan";GreaterThan.prototype.invokef0=function(b){b.pushA(ArcObject.T)};GreaterThan.prototype.invokef1=function(b){b.pushA(ArcObject.T)};
GreaterThan.prototype.invokef2=function(b,c,d){b.pushA(c.compareTo(d)<=0?ArcObject.NIL:ArcObject.T)};GreaterThan.prototype.invokePair=function(b){if(b.len()<2)return ArcObject.T;var c=b.car(),b=b.cdr();if(!(b instanceof Pair))throw new TypeError;for(;!(b instanceof Nil);){var d=b.car();if(c.compareTo(d)<=0)return ArcObject.NIL;c=d;b=b.cdr();if(!(b instanceof Pair))throw new TypeError;}return ArcObject.T};function Is(){Builtin.call(this);this.init("is")}Is.prototype=new Builtin;
Is.prototype.className="Is";Is.prototype.invokef0=function(b){b.pushA(ArcObject.T)};Is.prototype.invokef1=function(b){b.pushA(ArcObject.T)};Is.prototype.invokef2=function(b,c,d){b.pushA(Truth.valueOf(c.isSame(d)))};Is.prototype.invokePair=function(b){return this.checkIs_(b.car(),b.cdr())};Is.prototype.checkIs_=function(b,c){return c instanceof Nil?ArcObject.T:!b.isSame(c.car())?ArcObject.NIL:this.checkIs_(b,c.cdr())};function LessThan(){Builtin.call(this);this.init("<")}LessThan.prototype=new Builtin;
LessThan.prototype.className="LessThan";LessThan.prototype.invokef0=function(b){b.pushA(ArcObject.T)};LessThan.prototype.invokef1=function(b){b.pushA(ArcObject.T)};LessThan.prototype.invokef2=function(b,c,d){b.pushA(c.compareTo(d)<0?ArcObject.T:ArcObject.NIL)};
LessThan.prototype.invokePair=function(b){var c=b.car(),b=b.cdr();if(!(b instanceof Pair))throw new TypeError;for(;!(b instanceof Nil);){var d=b.car();if(c.compareTo(d)>=0)return ArcObject.NIL;c=d;b=b.cdr();if(!(b instanceof Pair))throw new TypeError;}return ArcObject.T};function RainbowDebug(){Builtin.call(this);this.init("rainbow-debug")}RainbowDebug.prototype=new Builtin;RainbowDebug.prototype.className="RainbowDebug";
RainbowDebug.prototype.invoke=function(b){b.setInterceptor(VMInterceptor.DEBUG);b.pushA(Symbol.mkSym(this.name_))};function RainbowProfile(){Builtin.call(this);this.init("rainbow-profile")}RainbowProfile.prototype=new Builtin;RainbowProfile.prototype.className="RainbowProfile";RainbowProfile.prototype.invokef0=function(b){this.profile(b);b.pushA(ArcObject.NIL)};RainbowProfile.prototype.invokef1=function(b,c){if(!(c instanceof VM))throw new TypeError;this.profile(c);b.pushA(ArcObject.NIL)};
RainbowProfile.prototype.profile=function(b){b.setInterceptor(VMInterceptor.PROFILE)};function RainbowProfileReport(){Builtin.call(this);this.init("rainbow-profile-report")}RainbowProfileReport.prototype=new Builtin;RainbowProfileReport.prototype.className="RainbowProfileReport";RainbowProfileReport.prototype.invokef0=function(b){b.pushA(this.report(b))};RainbowProfileReport.prototype.invokef1=function(b,c){if(!(c instanceof VM))throw new TypeError;b.pushA(this.report(b))};
RainbowProfileReport.prototype.createReport_=function(b){var c=new Hash;c.sref(this.createInvocationReport_(b.profileData.invocationProfile),Symbol.mkSym("invocation-profile"));c.sref(this.createInstructionReport_(b.profileData.instructionProfile),Symbol.mkSym("instruction-profile"));return c};
RainbowProfileReport.prototype.createInstructionReport_=function(b){var c=ArcObject.NIL;if(b!==null){var d=[],f;for(f in b)d.push({k:f,v:b[f]});d.sort(function(b,c){var d=b.v.compareTo(c.v);d===0&&(d=c.k.localeCompare(b.k));return d});b=0;for(f=d.length;b<f;b++)var g=d[b],g=new Pair(Rational.make1(g.v),ArcString.make(g.k)),c=new Pair(g,c)}return c};
RainbowProfileReport.prototype.createInvocationReport_=function(b){var c=ArcObject.NIL;if(b!==null){var d=[],f;for(f in b){var g=b[f];g.parent===null&&d.push(g)}d.sort(function(b,c){var d=b.totalNanoTime<c.totalNanoTime?-1:b.totalNanoTime===c.totalNanoTime?0:1;d===0&&(d=b.nanoTime<c.nanoTime?-1:b.nanoTime===c.nanoTime?0:1);d===0&&(d=b.name.localeCompare(c.name));if(d===0)throw new ArcError("can't compare "+b.name+" with "+c.name);return d});b=0;for(f=d.length;b<f;b++)c=new Pair(d[b].toPair(),c)}return c};
function CurrentGcMilliseconds(){Builtin.call(this);this.init("current-gc-milliseconds")}CurrentGcMilliseconds.prototype=new Builtin;CurrentGcMilliseconds.prototype.className="CurrentGcMilliseconds";CurrentGcMilliseconds.prototype.invoke=function(){return Rational.make1(1)};function CurrentProcessMilliseconds(){Builtin.call(this);this.init("current-process-milliseconds")}CurrentProcessMilliseconds.prototype=new Builtin;CurrentProcessMilliseconds.prototype.className="CurrentProcessMilliseconds";
CurrentProcessMilliseconds.prototype.invoke=function(){return Rational.make1(1)};function Declare(){Builtin.call(this);this.init("declare")}Declare.prototype=new Builtin;Declare.prototype.className="Declare";Declare.prototype.invokef2=function(b,c,d){c===Declare.atstrings?(c=Compiler.atstrings,Compiler.atstrings=d,b.pushA(c)):b.pushA(ArcObject.NIL)};Declare.prototype.invoke=function(b,c){this.invokef2(b,c.car(),c.cdr().car())};Declare.atstrings=Symbol.mkSym("atstrings");
function MSec(){Builtin.call(this);this.init("msec")}MSec.prototype=new Builtin;MSec.prototype.className="MSec";MSec.prototype.invokePair=function(){return Rational.make1((new Date).getTime())};function Seconds(){Builtin.call(this);this.init("seconds")}Seconds.prototype=new Builtin;Seconds.prototype.className="Seconds";Seconds.prototype.invokePair=function(){var b=(new Date).getTime()/1E3;return Rational.make1(b<0?Math.ceil(b):Math.floor(b))};
function MapTable(){Builtin.call(this);this.init("maptable")}MapTable.prototype=new Builtin;MapTable.prototype.className="MapTable";MapTable.prototype.invokef2=function(b,c,d){b.pushA(d);if(!(d instanceof Hash))throw new TypeError;b.pushA(d.toList());c=new TableMapper(c);c.belongsTo(this);b.pushFrame(c)};MapTable.prototype.invoke=function(b,c){Builtin.checkExactArgsCount(c,2,this.className);this.invokef2(b,c.car(),c.cdr().car())};function Sref(){Builtin.call(this);this.init("sref")}
Sref.prototype=new Builtin;Sref.prototype.className="Sref";Sref.prototype.invokef3=function(b,c,d,f){b.pushA(c.sref(d,f))};Sref.prototype.invoke=function(b,c){Builtin.checkExactArgsCount(c,3,this.className);this.invokef3(b,c.car(),c.cdr().car(),c.cdr().cdr().car())};function Table(){Builtin.call(this);this.init("table")}Table.prototype=new Builtin;Table.prototype.className="Table";
Table.prototype.invoke=function(b,c){var d=new Hash;b.pushA(d);if(!(c instanceof Nil)){var f=new PopArg("table-initialiser");f.belongsTo(this);b.pushFrame(f);c.car().invoke(b,Pair.buildFrom1([d]))}};function AtomicInvoke(){Builtin.call(this);this.init("atomic-invoke")}AtomicInvoke.prototype=new Builtin;AtomicInvoke.prototype.className="AtomicInvoke";
AtomicInvoke.prototype.invokef1=function(b,c){for(;b!==AtomicInvoke.owner_&&AtomicInvoke.owner_!==null;);AtomicInvoke.owner_=b;AtomicInvoke.entryCount_++;var d=new AtomicInvoke.ReleaseLock;d.belongsTo(this);b.pushFrame(d);c.invoke(b,ArcObject.NIL)};AtomicInvoke.prototype.invoke=function(b,c){this.invokef1(b,c.car())};AtomicInvoke.ReleaseLock=function(){Instruction.call(this)};AtomicInvoke.ReleaseLock.prototype=new Instruction;AtomicInvoke.ReleaseLock.prototype.className="AtomicInvoke.ReleaseLock";
AtomicInvoke.ReleaseLock.prototype.operate=function(){AtomicInvoke.entryCount_--;if(AtomicInvoke.entryCount_===0)AtomicInvoke.owner_=null};AtomicInvoke.owner_=null;AtomicInvoke.entryCount_=0;function BreakThread(){Builtin.call(this);this.init("break-thread")}BreakThread.prototype=new Builtin;BreakThread.prototype.className="BreakThread";BreakThread.prototype.invokePair=function(b){b=b.car();if(!(b instanceof VM))throw new TypeError;b.setInterceptor(VMInterceptor.KILL);return ArcObject.NIL};
function CCC(){Builtin.call(this);this.init("ccc")}CCC.prototype=new Builtin;CCC.prototype.className="CCC";CCC.prototype.invokef1=function(b,c){if(c instanceof Nil)throw new ArcError("Can't ccc nil!");var d=new CCC.ContinuationWrapper(b);c.invokef1(b,d)};CCC.prototype.invoke=function(b,c){Builtin.checkMaxArgCount(c,this.className,1);this.invokef1(b,c.car())};CCC.TriggerCopyVM_=function(b){Instruction.call(this);this.cc_=b};CCC.TriggerCopyVM_.prototype=new Instruction;
CCC.TriggerCopyVM_.prototype.className="CCC.TriggerCopyVM_";CCC.TriggerCopyVM_.prototype.operate=function(){this.cc_.setCopyRequired()};CCC.TriggerCopyVM_.prototype.toString=function(){return"#<require-vm-copy #"+this.cc_.vm_.threadId+">"};CCC.ContinuationWrapper=function(b){ArcObject.call(this);this.vm_=b;this.copyRequired_=!1};CCC.ContinuationWrapper.prototype=new ArcObject;CCC.ContinuationWrapper.prototype.className="CCC.ContinuationWrapper";
CCC.ContinuationWrapper.prototype.applyFinallies_=function(b,c){for(var d=c[0].length-1;0<=d;d--){var f=c[1][d];if(!(f instanceof LexicalClosure))throw new TypeError;if(!(c[0][d]instanceof Pair))throw new TypeError;b.pushInvocation2(f,instructions)}};CCC.ContinuationWrapper.prototype.invokef1=function(b,c){var d=b.lastCommonAncestor(this.vm_),d=b.gatherFinallies(d);this.vm_.copyTo(b);b.pushA(c);this.applyFinallies_(b,d)};
CCC.ContinuationWrapper.prototype.faster_but_broken_invokef1=function(b,c){if(this.copyRequired_){var d=b.lastCommonAncestor(this.vm_),d=b.gatherFinallies(d);this.vm_.copyTo(b)}else d=b.gatherFinallies(this.vm.ip),b.ap=this.vm.ap,b.ip=this.vm.ip,b.currentLc=this.vm.currentLc,b.currentParams=this.vm.currentParams,b.error_=this.vm.error_,b.dead_=this.vm.dead_,b.ipThreshold=this.vm.ipThreshold;b.pushA(c);this.applyFinallies_(b,d)};
CCC.ContinuationWrapper.prototype.invoke=function(b,c){this.invokef1(b,c.car())};CCC.ContinuationWrapper.prototype.type=function(){return Builtin.TYPE};CCC.ContinuationWrapper.prototype.setCopyRequired=function(){this.copyRequired_=!0};CCC.ContinuationWrapper.prototype.toString=function(){return"#<continuation ip:"+this.vm_.ip+";ap:"+this.vm_.ap+";VM#"+this.vm_.threadId+">"};function CurrentThread(){Builtin.call(this);this.init("current-thread")}CurrentThread.prototype=new Builtin;
CurrentThread.prototype.className="CurrentThread";CurrentThread.prototype.invoke=function(b){b.pushA(b)};function Dead(){Builtin.call(this);this.init("dead")}Dead.prototype=new Builtin;Dead.prototype.className="Dead";Dead.prototype.invoke=function(b,c){var d=c.car();if(!(d instanceof VM))throw new TypeError;return Truth.valueOf(d.dead())};function KillThread(){Builtin.call(this);this.init("kill-thread")}KillThread.prototype=new Builtin;KillThread.prototype.className="KillThread";
KillThread.prototype.invoke=function(b,c){var d=c.car();if(!(d instanceof VM))throw new TypeError;d.setInterceptor(VMInterceptor.KILL);return ArcObject.NIL};function NewThreadLocal(){Builtin.call(this);this.init("thread-local")}NewThreadLocal.prototype=new Builtin;NewThreadLocal.prototype.className="NewThreadLocal";NewThreadLocal.prototype.invokePair=function(){return new ArcThreadLocal};function ThreadLocalGet(){Builtin.call(this);this.init("thread-local-ref")}ThreadLocalGet.prototype=new Builtin;
ThreadLocalGet.prototype.className="ThreadLocalGet";ThreadLocalGet.prototype.invokePair=function(b){return ArcThreadLocal.cast(b.car(),this).get()};function ThreadLocalSet(){Builtin.call(this);this.init("thread-local-set")}ThreadLocalSet.prototype=new Builtin;ThreadLocalSet.prototype.className="ThreadLocalSet";ThreadLocalSet.prototype.invokePair=function(b){var c=ArcThreadLocal.cast(b.car(),this),b=b.cdr().car();c.set(b);return b};function Annotate(){Builtin.call(this);this.init("annotate")}
Annotate.prototype=new Builtin;Annotate.prototype.className="Annotate";Annotate.prototype.invokePair=function(b){var c=b.car(),b=b.cdr().car();return c===b.type()?b:new Tagged(c,b)};function Coerce(){Builtin.call(this);this.init("coerce");Typing.init()}Coerce.prototype=new Builtin;Coerce.prototype.className="Coerce";
Coerce.prototype.invokef2=function(b,c,d){var f=c.type();if(f===d)b.pushA(c);else try{if(!(d instanceof Symbol))throw new TypeError;if(!(f instanceof Symbol))throw new TypeError;d.getCoercion(f).invokef1(b,c)}catch(g){if(g instanceof Typing.CantCoerce)throw new ArcError("Can't coerce "+c+" to "+d);throw new ArcError("Can't coerce "+c+" ( a "+c.type()+" ) to "+d,g);}};
Coerce.prototype.invokef3=function(b,c,d,f){var g=c.type();if(g===d)b.pushA(c);else try{if(!(d instanceof Symbol))throw new TypeError;if(!(g instanceof Symbol))throw new TypeError;d.getCoercion(g).invokef2(b,c,f)}catch(h){if(h instanceof Typing.CantCoerce)throw new ArcError("Can't coerce "+c+" to "+d);throw new ArcError("Can't coerce "+c+" ( a "+c.type()+" ) to "+d,h);}};
Coerce.prototype.invoke=function(b,c){if(c.hasLen(2))this.invokef2(b,c.car(),c.cdr().car());else if(c.hasLen(3))this.invokef3(b,c.car(),c.cdr().car(),c.cdr().cdr().car());else throw new ArcError("coerce expects 2 or 3 args, got "+c);};function Rep(){Builtin.call(this);this.init("rep")}Rep.prototype=new Builtin;Rep.prototype.className="Rep";Rep.prototype.invokePair=function(b){var c=b.car();return c instanceof Tagged?Tagged.cast(b.car(),this).getRep():c};
function Type(){Builtin.call(this);this.init("type")}Type.prototype=new Builtin;Type.prototype.className="Type";Type.prototype.invokef1=function(b,c){b.pushA(c.type())};Type.prototype.invokePair=function(b){Builtin.checkMaxArgCount(b,this.className,1);return b.car().type()};var Typing={};Typing.STRING=Symbol.mkSym("string");Typing.SYM=Symbol.mkSym("sym");Typing.INT=Symbol.mkSym("int");Typing.NUM=Symbol.mkSym("num");Typing.CONS=Symbol.mkSym("cons");Typing.CHAR=Symbol.mkSym("char");
Typing.init=function(){Typing.CONS.addCoercion(Typing.STRING,new Typing.Coercion("string-cons",function(b){if(!(b instanceof ArcString))throw new TypeError;for(var b=b.value(),c=[],d=0;d<b.length;d++)c.push(ArcCharacter.makeFromCharCode(b.charCodeAt(d)));return Pair.buildFrom1(c)}));Typing.STRING.addCoercion(Typing.CONS,new Typing.Coercion("cons-string",function(b){if(!(b instanceof Pair))throw new TypeError;for(var c=[];!(b instanceof Nil);)if(c.push(b.car().disp()),b=b.cdr(),!(b instanceof Pair))throw new TypeError;
return ArcString.make(c.join(""))}));Typing.STRING.addCoercion(Typing.INT,new Typing.Coercion("int-string",function(b){return this.coerce2(b,Rational.TEN)},function(b,c){if(!(c instanceof ArcNumber))throw new TypeError;if(!(b instanceof ArcNumber))throw new TypeError;return b instanceof Complex?Typing.stringifyComplex_(b):b instanceof Real&&c.toInt()!==10?Typing.cantCoerce_():b instanceof Rational?Typing.stringifyRational_(b,c):Typing.stringifyReal_(b,c)}));Typing.STRING.addCoercion(Typing.NUM,new Typing.Coercion("num-string",
function(b){return this.coerce2(b,Rational.TEN)},function(b,c){if(!(c instanceof ArcNumber))throw new TypeError;if(!(b instanceof ArcNumber))throw new TypeError;return b instanceof Complex?Typing.stringifyComplex_(b):b instanceof Real&&c.toInt()!==10?Typing.cantCoerce_():b instanceof Rational?Typing.stringifyRational_(b,c):Typing.stringifyReal_(b,c)}));Typing.SYM.addCoercion(Typing.STRING,new Typing.Coercion("string-sym",function(b){if(!(b instanceof ArcString))throw new TypeError;return Symbol.make(b.value())}));
Typing.STRING.addCoercion(Typing.SYM,new Typing.Coercion("sym-string",function(b){if(b instanceof Nil)return ArcString.make("");b=b.disp();return ArcString.make(b)}));Typing.INT.addCoercion(Typing.CHAR,new Typing.Coercion("char-int",function(b){if(!(b instanceof ArcCharacter))throw new TypeError;b=b.value();return Rational.make1(b)},function(b){return this.coerce1(b)}));Typing.INT.addCoercion(Typing.NUM,new Typing.Coercion("num-int",function(b){if(!(b instanceof ArcNumber))throw new TypeError;return b.round()},
function(b){return this.coerce1(b)}));Typing.NUM.addCoercion(Typing.INT,new Typing.Coercion("int-num",function(b){return b}));Typing.CHAR.addCoercion(Typing.INT,new Typing.Coercion("int-char",function(b){if(!(b instanceof ArcNumber))throw new TypeError;b.isInteger()||Typing.cantCoerce_();return ArcCharacter.makeFromCharCode(b.toInt())}));Typing.STRING.addCoercion(Typing.CHAR,new Typing.Coercion("char-string",function(b){if(!(b instanceof ArcCharacter))throw new TypeError;b=b.value();return ArcString.make(String.fromCharCode(b))}));
Typing.SYM.addCoercion(Typing.CHAR,new Typing.Coercion("char-sym",function(b){if(!(b instanceof ArcCharacter))throw new TypeError;b=b.value();return Symbol.make(String.fromCharCode(b))}));Typing.NUM.addCoercion(Typing.STRING,new Typing.Coercion("string-num",function(b){return this.coerce2(b,Rational.TEN)},function(b,c){if(!(c instanceof ArcNumber))throw new TypeError;if(!(b instanceof ArcString))throw new TypeError;var d=b.value().toLowerCase();return d==="+inf.0"?Real.positiveInfinity():d==="-inf.0"?
Real.negativeInfinity():d==="+nan.0"?Real.nan():/i$/i.test(d)?Typing.coerceComplex_(d):/\./.test(d)||c.toInt()<15&&/.e./.test(d)?Typing.coerceDouble_(d,c.toInt()):/\//.test(d)?Typing.coerceFraction_(d,c.toInt()):Typing.coerceInt_(d,c.toInt())}));Typing.INT.addCoercion(Typing.STRING,new Typing.Coercion("string-int",function(b){return this.coerce2(b,Rational.TEN)},function(b,c){if(!(c instanceof ArcNumber))throw new TypeError;if(!(b instanceof ArcString))throw new TypeError;var d=b.value().toLowerCase();
if(d==="+inf.0"||d==="-inf.0"||d==="+nan.0"||/i$/i.test(d))throw new Typing.CantCoerce;else if(/\./.test(d)||c.toInt()<15&&/.e./i.test(d)){d=Typing.coerceDouble_(d,c.toInt());if(!(d instanceof Real))throw new TypeError;return d.roundJava()}else if(/\//.test(d)){d=Typing.coerceFraction_(d,c.toInt());if(!(d instanceof Rational))throw new TypeError;return d.roundJava()}else return Typing.coerceInt_(d,c.toInt())}))};Typing.stringifyComplex_=function(b){return ArcString.make(b.toString())};
Typing.stringifyRational_=function(b,c){return b.stringify(c)};Typing.stringifyReal_=function(b,c){if(c.toInt()===10)return ArcString.make(b.toString());else{var d=b.toInt().toString(~~c.toInt());return ArcString.make(""+d+".0")}};Typing.coerceComplex_=function(b){try{return Complex.parse(b)}catch(c){if(!(c instanceof ParseException))throw c;throw new Typing.CantCoerce;}};Typing.coerceInt_=function(b,c){var d=parseInt(b,~~c);return Rational.make1(d)};
Typing.coerceFraction_=function(b,c){var d=b.split(/\//g);if(2<d.length)throw new Typing.CantCoerce;var f=parseInt(d[0],~~c),d=parseInt(d[1],~~c);return Rational.make2(f,d)};
Typing.coerceDouble_=function(b,c){var d=!1;/^-/.test(b)&&(d=!0,b=b.substring(1));b=b.toUpperCase();/E/.test(b)||(b+="E0");if(/\./.test(b))/^\./.test(b)&&(b="0"+b);else var f=b.split(/E/g),b=f[0]+".0E"+f[1];var f=b.split(/\./g),g=parseInt(f[0],~~c),f=f[1].split(/E/g);/^\+/.test(f[1])&&(f[1]=f[1].substring(1));var h=parseInt(f[0],~~c)/Math.pow(c,f[0].length),f=Math.pow(c,parseInt(f[1],~~c)),g=(g+h)*f;d&&(g=-g);return Real.make(g)};
Typing.Coercion=function(b,c,d){ArcObject.call(this);this.name_=b;if(c!==void 0)this.coerce1=c;if(d!==void 0)this.coerce2=d};Typing.Coercion.prototype=new ArcObject;Typing.Coercion.prototype.className="Typing.Coercion";Typing.Coercion.prototype.type=function(){return Symbol.mkSym("fn")};Typing.Coercion.prototype.coerce1=function(){throw new ArcError("not implemented: "+name+".coerce 1 arg");};
Typing.Coercion.prototype.coerce2=function(){throw new ArcError("not implemented: "+name+".coerce 2 args");};Typing.Coercion.prototype.invokef1=function(b,c){b.pushA(this.coerce1(c))};Typing.Coercion.prototype.invokef2=function(b,c,d){b.pushA(this.coerce2(c,d))};Typing.cantCoerce_=function(){throw new Typing.CantCoerce;};Typing.CantCoerce=function(){};Typing.CantCoerce.prototype=Error();
var Environment={init:function(){new MSec;new Seconds;new CurrentProcessMilliseconds;new CurrentGcMilliseconds;new Declare;Symbol.mkSym("pi").setValue(new Real(Math.PI));Symbol.mkSym("e").setValue(new Real(Math.E));new Trunc;new Expt;new Rand;new Sqrt;new Quotient;new Mod;new Add;new Subtract;new Multiply;new Divide;new Sine;new Cosine;new Tangent;new Asin;new Acos;new Atan;new Logarithm;new ComplexParts;new MakeComplex;new PolarCoordinates;new Type;new Annotate;new Rep;new Coerce;new JavaDebug;new NewThread;
new KillThread;new BreakThread;new Dead;new AtomicInvoke;new CCC;new NewThreadLocal;new ThreadLocalGet;new ThreadLocalSet;new Uniq;new Macex;new Protect;new Err;new OnErr;new Details;new NewString;new Car;new Cdr;new Scar;new Scdr;new Cons;new Len;new Bound;new LessThan;new GreaterThan;new Exact;new Is;new Apply;new Eval;new SSExpand;new SSyntax;new Table;new MapTable;new Sref;new Hash;new CallWStdIn;new CallWStdOut;new StdIn;new StdOut;new StdErr;new Disp;new Write;new Sread;new WriteB;new WriteC;
new ReadB;new ReadC;new FlushOut;new Close_Builtin;new ForceClose;new InString;new OutString;new Inside;new RainbowDebug;new RainbowProfile;new RainbowProfileReport}};function Input(b){LiteralObject.call(this);this.original_=b}Input.prototype=new LiteralObject;Input.prototype.className="Input";
Input.prototype.readByteAsync=function(b,c){return this.original_.readByteAsync(function(c,f){return c?b(new ArcError("Cannot read byte from "+this,c)):f===null?b(null,ArcObject.NIL):b(null,Rational.make1(f))},c)};Input.prototype.readCharacterAsync=function(b,c){return this.original_.readCharCodeAsync(function(c,f){return c?b(new ArcError("reading character: "+c)):f===null?b(null,ArcObject.NIL):b(null,ArcCharacter.makeFromCharCode(f))},c)};
Input.prototype.peekCharacterAsync=function(b,c){return this.original_.peekCharCodeAsync(function(c,f){return c?b(c):f===null?b(null,ArcObject.NIL):b(null,ArcCharacter.makeFromCharCode(f))},c)};Input.prototype.readObjectAsync=function(b,c,d){return ArcParser.readObjectAsync(this.original_,function(d,g){return d?c(new ArcError("Can't parse input: "+d,d)):g===null?c(null,b):c(null,g)},d)};Input.prototype.type=function(){return Input.TYPE};Input.prototype.unwrap=function(){return this.original_};
Input.prototype.close=function(){this.closed_=!0;this.original_.close()};Input.prototype.getName=function(){return"<input>"};Input.cast=function(b,c){try{if(!(b instanceof Input))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected input-port, got "+b);}};Input.TYPE=Symbol.mkSym("input");function Output(b){LiteralObject.call(this);this.out_=b}Output.prototype=new LiteralObject;Output.prototype.className="Output";
Output.prototype.write=function(b){this.out_.writeString(""+b)};Output.prototype.type=function(){return Output.TYPE};Output.prototype.unwrap=function(){return this.out_};Output.prototype.writeRational=function(b){if(!b.isInteger())throw new ArcError("write byte: expected byte, got "+b);this.writeByte(b.toInt())};Output.prototype.writeChar=function(b){this.out_.writeString(String.fromCharCode(b.value()))};Output.prototype.close=function(){this.out_.close()};Output.prototype.writeByte=function(b){this.out_.writeByte(b)};
Output.cast=function(b,c){try{if(!(b instanceof Output))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected output-port, got "+b);}};Output.prototype.flush=function(){this.out_.flush()};Output.TYPE=Symbol.mkSym("output");
function StringInputPort(b){function c(){if(b.length<=g)return!1;var c=b.charCodeAt(g++);f.push(c>>>8&255,c&255);return!0}function d(){return f.length!==0||c()?f.shift():null}var f=[],g=0;Input.call(this,{readByteAsync:function(b){b(null,d());return!0},readCharCodeAsync:function(b){var c=d(),f=d();b(null,f===null?null:c<<8|f);return!0},peekCharCodeAsync:function(b){b(null,2<=f.length||c()?f[0]<<8|f[1]:null);return!0},close:function(){}})}StringInputPort.prototype=new Input(void 0);
StringInputPort.prototype.className="StringInputPort";
function StringOutputPort(){var b=this;b.parts_=[];b.leftoverByte_=null;Output.call(this,{writeString:function(c){if(b.leftoverByte_===null)b.parts_.push(c);else for(var d=0,f=c.length;d<f;d++){var g=c.charCodeAt(d);b.parts_.push(String.fromCharCode(b.leftoverByte_<<8|g>>>8&255));b.leftoverByte_=g&255}},writeByte:function(c){b.leftoverByte_===null?b.leftoverByte_=c:(b.parts_.push(String.fromCharCode(b.leftoverByte_<<8|c)),b.leftoverByte_=null)},close:function(){},flush:function(){}})}
StringOutputPort.prototype=new Output(void 0);StringOutputPort.prototype.className="StringOutputPort";StringOutputPort.prototype.value=function(){var b=this.parts_.join("");this.parts_=[b];return ArcString.make(b)};StringOutputPort.prototype.toString=function(){return"#<string-output-port>"};
StringOutputPort.cast=function(b,c){try{if(!(b instanceof StringOutputPort))throw new TypeError;return b}catch(d){if(!(d instanceof TypeError))throw d;throw new ArcError("Wrong argument type: "+c+" expected a StringOutputPort, got "+b);}};var IO={Anon_STD_OUT_:function(){Output.call(this,System_out)}};IO.Anon_STD_OUT_.prototype=new Output(void 0);IO.Anon_STD_OUT_.prototype.className="IO.Anon_STD_OUT_";IO.Anon_STD_OUT_.prototype.close=function(){};IO.Anon_STD_OUT_.prototype.toString=function(){return"IO.STD_OUT"};
IO.STD_OUT=new IO.Anon_STD_OUT_;IO.Anon_STD_ERR_=function(){Output.call(this,System_err)};IO.Anon_STD_ERR_.prototype=new Output(void 0);IO.Anon_STD_ERR_.prototype.className="IO.Anon_STD_ERR_";IO.Anon_STD_ERR_.prototype.close=function(){};IO.Anon_STD_ERR_.prototype.toString=function(){return"IO.STD_ERR"};IO.STD_ERR=new IO.Anon_STD_ERR_;IO.Anon_STD_IN_=function(){Input.call(this,System_in)};IO.Anon_STD_IN_.prototype=new Input(void 0);IO.Anon_STD_IN_.prototype.className="IO.Anon_STD_IN_";
IO.Anon_STD_IN_.prototype.close=function(){};IO.Anon_STD_IN_.prototype.toString=function(){return"IO.STD_IN"};IO.STD_IN=new IO.Anon_STD_IN_;IO.stdIn_={value:IO.STD_IN};IO.stdOut_={value:IO.STD_OUT};IO.stdIn=function(){return IO.stdIn_.value};IO.stdOut=function(){return IO.stdOut_.value};
IO.close=function(b){if(b instanceof Input)b.close();else if(b instanceof Output)b.close();else if(b instanceof ArcSocket)b.close();else if(b instanceof JavaObject)b.close();else throw new ArcError("close: expected Input or Output object; got "+b);};IO.chooseOutputPort=function(b,c){return b instanceof Nil?IO.stdOut():Output.cast(b,c)};IO.chooseInputPort=function(b,c){return b instanceof Nil?IO.stdIn():Input.cast(b,c)};
IO.closeAll=function(b){for(;!(b instanceof Nil);)if(IO.close(b.car()),b=b.cdr(),!(b instanceof Pair))throw new TypeError;return ArcObject.NIL};function Close_Builtin(){Builtin.call(this);this.init("close")}Close_Builtin.prototype=new Builtin;Close_Builtin.prototype.className="Close_Builtin";Close_Builtin.prototype.invokePair=function(b){return IO.closeAll(b)};function Disp(){Builtin.call(this);this.init("disp")}Disp.prototype=new Builtin;Disp.prototype.className="Disp";
Disp.prototype.invokef1=function(b,c){this.disp_(IO.stdOut(),c);b.pushA(ArcObject.NIL)};Disp.prototype.invokePair=function(b){this.disp_(IO.chooseOutputPort(b.cdr().car(),this),b.car());return ArcObject.NIL};Disp.prototype.disp_=function(b,c){b.write(c.disp())};function FlushOut(){Builtin.call(this);this.init("flushout")}FlushOut.prototype=new Builtin;FlushOut.prototype.className="FlushOut";FlushOut.prototype.invokePair=function(){IO.stdOut().flush();return ArcObject.T};
function ForceClose(){Builtin.call(this);this.init("force-close")}ForceClose.prototype=new Builtin;ForceClose.prototype.className="ForceClose";ForceClose.prototype.invokePair=function(b){return IO.closeAll(b)};function StdErr(){Builtin.call(this);this.init("stderr")}StdErr.prototype=new Builtin;StdErr.prototype.className="StdErr";StdErr.prototype.invokePair=function(){return IO.STD_ERR};function StdIn(){Builtin.call(this);this.init("stderr")}StdIn.prototype=new Builtin;StdIn.prototype.className="StdIn";
StdIn.prototype.invokePair=function(b){Builtin.checkExactArgsCount(b,0,this.className);return IO.stdIn()};function StdOut(){Builtin.call(this);this.init("stdout")}StdOut.prototype=new Builtin;StdOut.prototype.className="StdOut";StdOut.prototype.invokePair=function(){return IO.stdOut()};function Write(){Builtin.call(this);this.init("write")}Write.prototype=new Builtin;Write.prototype.className="Write";Write.prototype.invokePair=function(b){IO.chooseOutputPort(b.cdr().car(),this).write(b.car());return ArcObject.NIL};
function WriteB(){Builtin.call(this);this.init("writeb")}WriteB.prototype=new Builtin;WriteB.prototype.className="WriteB";WriteB.prototype.invokePair=function(b){IO.chooseOutputPort(b.cdr().car(),this).writeRational(Rational.cast(b.car(),this));return ArcObject.NIL};function WriteC(){Builtin.call(this);this.init("writec")}WriteC.prototype=new Builtin;WriteC.prototype.className="WriteC";
WriteC.prototype.invokePair=function(b){IO.chooseOutputPort(b.cdr().car(),this).writeChar(ArcCharacter.cast(b.car(),this));return b.car()};function InString(){Builtin.call(this);this.init("instring")}InString.prototype=new Builtin;InString.prototype.className="InString";InString.prototype.invokePair=function(b){return new StringInputPort(ArcString.cast(b.car(),this).value())};function Inside(){Builtin.call(this);this.init("inside")}Inside.prototype=new Builtin;Inside.prototype.className="Inside";
Inside.prototype.invokePair=function(b){return StringOutputPort.cast(b.car(),this).value()};function OutString(){Builtin.call(this);this.init("outstring")}OutString.prototype=new Builtin;OutString.prototype.className="OutString";OutString.prototype.invokePair=function(){return new StringOutputPort};function CallWStdIn(){Builtin.call(this);this.init("call-w/stdin")}CallWStdIn.prototype=new Builtin;CallWStdIn.prototype.className="CallWStdIn";
CallWStdIn.prototype.invoke=function(b,c){var d=new SetThreadLocal(IO.stdIn_,IO.stdIn());d.belongsTo(this);b.pushFrame(d);IO.stdIn_.value=Input.cast(c.car(),this);c.cdr().car().invoke(b,ArcObject.NIL)};function CallWStdOut(){Builtin.call(this);this.init("call-w/stdout")}CallWStdOut.prototype=new Builtin;CallWStdOut.prototype.className="CallWStdOut";
CallWStdOut.prototype.invoke=function(b,c){var d=new SetThreadLocal(IO.stdOut_,IO.stdOut());d.belongsTo(this);b.pushFrame(d);IO.stdOut_.value=Output.cast(c.car(),this);c.cdr().car().invoke(b,ArcObject.NIL)};function ReadB(){Builtin.call(this);this.init("readb")}ReadB.prototype=new Builtin;ReadB.prototype.className="ReadB";ReadB.prototype.invokef1=function(b,c){b.pushFrame(new ReadB.Go(IO.chooseInputPort(c,this),this))};
ReadB.prototype.invoke=function(b,c){b.pushFrame(new ReadB.Go(IO.chooseInputPort(c.car(),this),this))};ReadB.Go=function(b){Instruction.call(this);this.port_=b;this.belongsTo(parent);this.hasError_=this.ready_=!1;this.result_=void 0};ReadB.Go.prototype=new Instruction;ReadB.Go.prototype.implementsAsync=!0;ReadB.Go.prototype.className="ReadB.Go";ReadB.Go.prototype.operateAsync=function(b,c,d){return this.port_.readByteAsync(function(d,g){if(d)return void c(d);b.pushA(g);c(null)},d)};
ReadB.Go.prototype.operate=function(){throw Error();};function ReadC(){Builtin.call(this);this.init("readc")}ReadC.prototype=new Builtin;ReadC.prototype.className="ReadC";ReadC.prototype.invokef1=function(b,c){b.pushFrame(new ReadC.Go(IO.chooseInputPort(c,this),this))};ReadC.prototype.invoke=function(b,c){b.pushFrame(new ReadC.Go(IO.chooseInputPort(c.car(),this),this))};ReadC.Go=function(b){Instruction.call(this);this.port_=b;this.belongsTo(parent);this.hasError_=this.ready_=!1;this.result_=void 0};
ReadC.Go.prototype=new Instruction;ReadC.Go.prototype.implementsAsync=!0;ReadC.Go.prototype.className="ReadC.Go";ReadC.Go.prototype.operateAsync=function(b,c,d){return this.port_.readCharacterAsync(function(d,g){if(d)return void c(d);b.pushA(g);c(null)},d)};ReadC.Go.prototype.operate=function(){throw Error();};function Sread(){Builtin.call(this);this.init("sread")}Sread.prototype=new Builtin;Sread.prototype.className="Sread";
Sread.prototype.invoke=function(b,c){b.pushFrame(new Sread.Go(Input.cast(c.car(),this),c.cdr().car()))};Sread.Go=function(b,c){Instruction.call(this);this.port_=b;this.eof_=c;this.belongsTo(parent);this.hasError_=this.ready_=!1;this.result_=void 0};Sread.Go.prototype=new Instruction;Sread.Go.prototype.implementsAsync=!0;Sread.Go.prototype.className="Sread.Go";
Sread.Go.prototype.operateAsync=function(b,c,d){return this.port_.readObjectAsync(this.eof_,function(d,g){if(d)return void c(d);b.pushA(g);c(null)},d)};Sread.Go.prototype.operate=function(){throw Error();};var Console={};Console.o=ArcObject.NIL;Console.debugJava=!1;Console.stackfunctions=!0;
Console.mainAsync=function(b,c,d){var f=(new Date).getTime(),g=Console.parseAll_(b.args||[]);if(b.nosf)Console.stackfunctions=!1;Environment.init();var h=new VM;Symbol.mkSym("*argv*").setValue(Pair.buildFrom1(g));Symbol.mkSym("call*").setValue(new Hash);Symbol.mkSym("sig").setValue(new Hash);var i=!0;Console.interpretAllAsync_(h,b.e||[],function(g){if(g)return void c(g);b.q?c():(g=(new Date).getTime(),System_out_println("repl in "+(g-f)+"ms"),Console.replAsync_(h,c,d)||(i=!1))},d)||(i=!1);return i};
Console.parseAll_=function(b){for(var c=[],d=0,f=b.length;d<f;d++){var g=b[d];if(Object.prototype.toString.call(g)!=="[object String]")throw new TypeError;c.push(ArcParser.readFirstObjectFromString(""+g))}return c};
Console.interpretAllAsync_=function(b,c,d,f){function g(c,h){if(c)return void d(c);if(h===null)return void d();Console.interpretAsync_(b,h,function(b){if(b)return void d(b);ArcParser.readObjectAsync(k,g,f)||(q=!1)},f)||(q=!1)}for(var h=[],i=0,j=c.length;i<j;i++){var l=c[i];if(Object.prototype.toString.call(l)!=="[object String]")throw new TypeError;h.push(l+" ")}var k=(new StringInputPort(h.join(""))).unwrap(),q=!0;ArcParser.readObjectAsync(k,g,f)||(q=!1);return q};
Console.replAsync_=function(b,c,d){System_out_print("arc> ");for(var f=!0,g=!1;!g;)if(ArcParser.readObjectAsync(System_in,function(h,i){if(h){if(!(h instanceof ParseException))return void c(h);printStackTrace(h);f||Console.replAsync_(b,c,d)}else i===null?(g=!0,f||c()):Console.interpretAsync_(b,i,function(g){if(g)return void c(g);f||Console.replAsync_(b,c,d)},d)||(f=!1)},d)||(f=!1),!f)return!1;c();return!0};
Console.interpretAsync_=function(b,c,d,f){return Console.compileAndEvalAsync_(b,c,function(b,c){if(b){if(!(b instanceof ArcError))return void d(b);System_out_println("Message    : "+b.getMessage());System_out_print("Java stack : ");printStackTrace(b,System_out)}else System_out_println(c);d()},f)};Console.Anon_mkVisitor_=function(b){Visitor.call(this);this.owner_=b};Console.Anon_mkVisitor_.prototype=new Visitor;Console.Anon_mkVisitor_.prototype.className="Console.Anon_mkVisitor_";
Console.Anon_mkVisitor_.prototype.acceptInstruction=function(b){b.belongsTo(this.owner_)};Console.mkVisitor_=function(b){return new Console.Anon_mkVisitor_(b)};Console.compileAndEvalAsync_=function(b,c,d,f){b.pushFrame(new Console.CompileAndEval(c));return b.threadAsync(d,f)};Console.CompileAndEval=function(b){Instruction.call(this);this.expression_=b;this.belongsTo(ArcString.make("Console.compileAndEvalAsync_"))};Console.CompileAndEval.prototype=new Instruction;
Console.CompileAndEval.prototype.className="Console.CompileAndEval";Console.CompileAndEval.prototype.operate=function(b){b.pushFrame(new Console.AndEval);Compiler.compile(b,this.expression_,[])};Console.AndEval=function(){Instruction.call(this);this.belongsTo(ArcString.make("Console.compileAndEvalAsync_"))};Console.AndEval.prototype=new Instruction;Console.AndEval.prototype.className="Console.AndEval";
Console.AndEval.prototype.operate=function(b){var c=b.popA().reduce(),d=[];c.addInstructions(d);d=Pair.buildFrom1(d);d.visit(Console.mkVisitor_(c));b.pushInvocation2(null,d)};function NewThread(){Builtin.call(this);this.init("new-thread")}NewThread.prototype=new Builtin;NewThread.prototype.className="NewThread";NewThread.prototype.invokePair=function(){throw new ArcError("Rainbow.js doesn't support new-thread.");};
function BindAndRun(b,c,d){Instruction.call(this);this.lc_=b;this.instructions_=c;this.belongsTo(d)}BindAndRun.prototype=new Instruction;BindAndRun.prototype.className="BindAndRun";BindAndRun.prototype.operate=function(b){this.lc_.add(b.popA());b.pushInvocation2(this.lc_,this.instructions_)};function handle(b,c,d){b.addEventListener?b.addEventListener(c,d,!1):b.attachEvent("on"+c,d)}function keyCode(b){return b.which||b.keyCode}function preventDefault(b){b.preventDefault?b.preventDefault():b.returnValue=!1}
handle(window,"load",function(){function b(){var b=l.value+"\n";l.value="";consoleIn.o.writeString(b)}function c(b){if(b.readStringAvailable!==void 0)return b.readStringAvailable();for(var c=[],d=!0;d;)b.readCharCodeAsync(function(b,f){if(b)throw b;f!==null?d=!1:c.push(String.fromCharCode(f))},!0)||(d=!1);return c.join("")}function d(b){j.appendChild(document.createTextNode(b));q||(q=!0,setTimeout(function(){q=!1;j.scrollTop=j.scrollHeight},0))}function f(b){if(b)throw b;b=c(consoleIn.i);b!==""&&
(d(b),rainbowStdin.o.writeString(b),consoleIn.i.peekCharCodeAsync(f))}function g(b){if(b)throw b;b=c(rainbowStdout.i);b!==""&&(d(b),rainbowStdout.i.peekCharCodeAsync(g))}function h(b){if(b)throw b;b=c(rainbowStderr.i);b!==""&&(d(b),rainbowStderr.i.peekCharCodeAsync(h))}var i=document.getElementById("repl"),j=document.createElement("pre");j.className="scrollback";j.appendChild(document.createTextNode(""));i.appendChild(j);var l=document.createElement("textarea");l.className="prompt";handle(l,"keydown",
function(b){keyCode(b)===13&&preventDefault(b)});handle(l,"keyup",function(c){keyCode(c)===13&&b()});i.appendChild(l);var k=document.createElement("button");k.className="eval";k.appendChild(document.createTextNode("Eval"));handle(k,"click",function(){b()});i.appendChild(k);var q=!1;consoleIn.i.peekCharCodeAsync(f);rainbowStdout.i.peekCharCodeAsync(g);rainbowStderr.i.peekCharCodeAsync(h);Console.mainAsync({},function(){})});
